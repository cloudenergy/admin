<style>.OperateItem {
        margin-right: 8px;
        font-size: 12px;
    }
    
    .sm-editable input.form-control {
        width: 100px;
    }
    
    .sensorItem {
        margin-top: 14px;
    }
    
    .expandable:hover {
        cursor: pointer;
        background-color: #eee;
    }
    
    .table>tbody>tr>td {
        vertical-align: middle;
    }
    
    .table>tbody>tr>td td,
    .table>thead>tr .table th {
        border-top: none;
        vertical-align: middle;
    }
    
    .table thead th.nopadding,
    .table tbody td.nopadding {
        padding: 0px;
    }
    
    .table thead th.nopadding .table,
    .table tbody td.nopadding .table {
        margin-bottom: 0px;
    }
    
    .row-content {
        padding-left: 250px;
    }
    
    .row-content .sider-tree {
        margin-left: -250px;
    }</style><script type="text/ng-template" id="importSensor.html"><div class="container-fluid">
        <div align="center" style="padding: 30; border-bottom: 1px solid #E5E5E5; min-height: 16; ">
            <h3>导入传感器</h3>
        </div>
        <div align="center">
            <form action="{{actionURL}}" method="post" ng-upload="OnUploadComplete(content)" class="m20">
                <input type="file" name="sensors" class="col-md-6" />
                <input type="submit" value="上传" class="btn btn-primary" ng-disabled="$isUploading" />
                <input type="hidden" name="projectid" value="{{project}}" />
                <input type="hidden" name="buildingid" value="{{building}}" />
                <input type="hidden" name="customerid" value="{{customer}}" />
            </form>
            <div class="text-left m20">
                <a target="_blank" href="files/仪表导入模板.xlsx" class="text-primary bold">默认模板下载</a>
            </div>
        </div>
        <div style="margin-top: 15px; padding: 0px 20px 20px; text-align: center;">
            <button class="btn btn-primary" ng-click="ok()" ng-disabled="$isUploading">确定</button>
            <button class="btn btn-warning" ng-click="cancel()" ng-disabled="$isUploading">取消</button>
        </div>
    </div></script><script type="text/ng-template" id="sensorAttribute.html"><div class="container-fluid">
        <div align="center" style="padding: 30; border-bottom: 1px solid #E5E5E5; min-height: 16; ">
            <h3>传感器属性</h3>
        </div>
        <div class="row sensorItem">
            <div class="col-lg-2"></div>
            <div class="col-lg-3" align="right">传感器驱动：</div>
            <div class="col-lg-4">
                <select class="form-control" ng-options="drivercompany.id as drivercompany.id for drivercompany in DriverCompany" ng-model="drivercompanySelected">
                </select>
            </div>
            <div class="col-lg-2"></div>
        </div>
        <div class="row sensorItem">
            <div class="col-lg-2"></div>
            <div class="col-lg-3" align="right"></div>
            <div class="col-lg-4">
                <select class="form-control" ng-options="drivername.id as drivername.id for drivername in DriverName" ng-model="driverNameSelected"></select>
            </div>
            <div class="col-lg-2"></div>
        </div>
        <div class="row sensorItem">
            <div class="col-lg-2"></div>
            <div class="col-lg-3" align="right"></div>
            <div class="col-lg-4">
                <select class="form-control" ng-options="driverversion.id as driverversion.id for driverversion in DriverVersion" ng-model="driverVersionSelected"></select>
            </div>
            <div class="col-lg-2"></div>
        </div>
        <div class="row sensorItem">
            <div class="col-lg-2"></div>
            <div class="col-lg-3" align="right">传感器型号：</div>
            <div class="col-lg-4">
                <select class="form-control" ng-options="adaptdevice.code as adaptdevice.desc for adaptdevice in AdaptDevice" ng-model="adaptDeviceSelected"></select>
            </div>
            <div class="col-lg-2"></div>
        </div>
        <div style="margin-top: 15px; padding: 0px 20px 20px; text-align: center;">
            <button class="btn btn-primary" ng-click="Ok()">确定</button>
            <button class="btn btn-warning" ng-click="Cancel()">取消</button>
        </div>
    </div></script><script type="text/ng-template" id="sensorSync.html"><div class="container-fluid">
        <div align="center" style="padding: 30; border-bottom: 1px solid #E5E5E5; min-height: 16; ">
            <h3>{{sensorTitle}}</h3>
        </div>
        <div class="row sensorItem">
            <div class="col-lg-3"></div>
            <div class="col-lg-3" align="right">状态：</div>
            <div class="col-lg-4">{{sensorStatus.status}}</div>
            <div class="col-lg-2"></div>
        </div>
        <div class="row sensorItem">
            <div class="col-lg-3"></div>
            <div class="col-lg-3" align="right">最后上传：</div>
            <div class="col-lg-4">{{sensorLastUpdate}}</div>
            <div class="col-lg-2"></div>
        </div>
        <div class="row sensorItem">
            <div class="col-lg-3"></div>
            <div class="col-lg-3" align="right">实时读数：</div>
            <div class="col-lg-4" ng-style="{'color': sensorStatus.color}">{{sensorRealData}}</div>
            <div class="col-lg-2"></div>
        </div>
        <div class="row sensorItem">
            <div class="col-lg-3"></div>
            <div class="col-lg-3" align="right">记录读数：</div>
            <div class="col-lg-4">{{sensorLastTotal}}</div>
            <div class="col-lg-2"></div>
        </div>
        <div class="row sensorItem" style="margin-top: 15px; padding: 0px 20px 20px; text-align: center;">
            <div class="col-lg-2"></div>
            <div class="col-lg-8">
                <button class="btn btn-success hint hint--right" ng-click="Sync()" style="width: 200px;" data-hint="同步传感器实时读数">
                    <span class="glyphicon glyphicon-refresh"></span> 同步
                </button>
            </div>
            <div class="col-lg-2"></div>
        </div>
        <div class="row sensorItem" style="margin-top: 15px; padding: 0px 20px 20px; text-align: center;">
            <div class="col-lg-2"></div>
            <div class="col-lg-8">
                <button class="btn btn-warning" ng-click="Cancel()">关闭</button>
            </div>
            <div class="col-lg-2"></div>
        </div>
    </div></script><div class="div"><div class="panel panel-default"><div class="panel-body"><form class="form-inline clearfix" ng-submit="OnSearch()"><div class="form-group pb10 mr5" ng-if="!customer.enable&&buildings.length"><ui-select style="width:225px" ng-model="buildings.selected" remove-selected="false" on-select="buildings.select()"><ui-select-match placeholder="--选择建筑--">{{$select.selected.title}}</ui-select-match><ui-select-choices repeat="item._id as item in buildings | filter: $select.search"><div ng-bind-html="item.title | highlight: $select.search"></div></ui-select-choices></ui-select></div><div class="form-group pb10 mr5" ng-if="DeviceTypes.length"><ui-select style="width:110px" ng-model="DeviceTypes.selected" remove-selected="false" on-select="DeviceTypes.select()"><ui-select-match placeholder="--选择设备--">{{$select.selected.title}}</ui-select-match><ui-select-choices repeat="item.id as item in DeviceTypes | filter: $select.search"><div ng-bind-html="item.title | highlight: $select.search"></div></ui-select-choices></ui-select></div><div class="form-group pb10 ml5 mr5 w200"><input class="form-control" type="text" placeholder="关键字：ID/名称" ng-model="searchKey"></div><div class="form-group pb10"><button type="submit" class="btn btn-info mr5"><span class="glyphicon glyphicon-search"></span> 查询</button></div><div class="btn-group pb10 ml5"><label class="btn btn-primary" ng-model="customer.enable" uib-btn-radio="false"><i class="fa" ng-class="{true:'fa-check-square-o',false:'fa-square-o'}[!customer.enable]"></i> 建筑</label><label class="btn btn-primary" ng-model="customer.enable" uib-btn-radio="true"><i class="fa" ng-class="{true:'fa-check-square-o',false:'fa-square-o'}[!!customer.enable]"></i> 社会属性</label></div><div class="btn-group pb10 pull-right"><button type="button" class="btn btn-success mr5" ng-show="operateStatus.mask.isEnable" ng-click="OnMaskAll(false)"><span class="glyphicon glyphicon-eye-close"></span> 全部启用</button> <button type="button" class="btn btn-danger mr5" ng-show="operateStatus.mask.isEnable" ng-click="OnMaskAll(true)"><span class="glyphicon glyphicon-eye-close"></span> 全部屏蔽</button> <button type="button" class="btn btn-warning mr5" ng-show="operateStatus.sync.isEnable" ng-click="OnSyncAll()"><span class="glyphicon glyphicon-refresh"></span> 异常同步</button><div class="btn-group open" uib-dropdown><a class="btn btn-primary" ui-sref="admin.sensor.create({building:buildings.selected})" ng-show="operateStatus.create.isEnable"><span class="glyphicon glyphicon-plus"></span> 添加传感器 </a><button type="button" class="btn btn-primary dropdown-toggle" uib-dropdown-toggle aria-haspopup="true" aria-expanded="true"><span class="caret"></span> <span class="sr-only"></span></button><ul class="dropdown-menu pull-right"><li><a href="javascript:void(0)" ng-click="importSensor()">文件导入</a></li></ul></div></div></form><div class="row" ng-class="{'row-content':customer.enable}"><div class="col-xs-2 w250 sider-tree" ng-show="customer.enable"><input type="text" class="form-control mt5" placeholder="🔍社会属性关键字搜索" ng-model="customer.search"><div jstree="customer" jstree-search="customer.search"></div></div><div class="col-xs-12" ng-class="{'pl0':customer.enable}"><table class="table table-hover"><thead><tr><th class="text-center" style="width:60px">序号</th><th>ID</th><th>编码</th><th>名称</th><th colspan="5" class="nopadding"><table class="table"><tr><th class="col-md-5">读数</th><th class="col-md-3">操作</th><th class="col-md-4">更新频率</th></tr></table></th><th style="width:100px">控制驱动</th></tr></thead><tbody><tr ng-repeat="sensor in viewOfSensor"><td class="text-center">{{(currentPage-1)*pageSize+$index+1}}</td><td class="col-md-1 text-success">{{sensor.id.substr(12,12)}}</td><td>{{sensor.tag}}</td><td><span editable-text="sensor.title" e-name="name" e-form="rowform" e-required>{{sensor.title}}</span></td><td class="text-left sm-editable nopadding" ng-style="{'color': channel.status.color}" colspan="5"><div class="row" ng-repeat="channel in sensor.channels"><div class="col-md-5 pb5 pt5" ng-class="{'bb': !$last}"><b class="text-primary">{{channel.channel}}</b> <span class="hint hint--right" ng-class="{0:'text-success',1:'text-danger',2:'text-warning'}[channel.status]" editable-text="channel.lasttotal" e-name="name" e-form="rowform" e-required ng-class="channel.status.hintStyle" popover-placement="right" uib-popover="最后上传:{{channel.lastupdate|date:'yyyy-M-dd H:mm:ss'}}" popover-trigger="mouseenter">{{channel.lasttotal}}</span></div><div class="col-md-3"><div class="pb5 pt5"><div class="pull-left OperateItem" popover-placement="bottom" uib-popover="同步" popover-trigger="mouseenter"><a href="javascript:void(0)" style="font-size: 12px" ng-show="operateStatus.sync.isEnable" ng-click="OnSync(channel, sensor)"><i class="glyphicon glyphicon-refresh"></i></a></div><div class="pull-left OperateItem" popover-placement="bottom" uib-popover="{{ channel.mask && '取消' || ''}}屏蔽" popover-trigger="mouseenter"><a href="javascript:void(0)" style="font-size: 12px" ng-show="operateStatus.mask.isEnable" ng-click="OnMask(channel)"><i class="glyphicon" ng-class="{'glyphicon-eye-open': channel.mask,'glyphicon-eye-close': !channel.mask}"></i></a></div><div class="pull-left OperateItem"><div class="buttons" ng-show="!rowform.$visible" popover-placement="bottom" uib-popover="编辑" popover-trigger="mouseenter"><a ui-sref="admin.sensor.edit({id:channel.id})" ng-show="operateStatus.edit.isEnable"><i class="glyphicon glyphicon-edit"></i></a></div><form editable-form name="rowform" onbeforesave="saveUser($data, user.id)" ng-show="rowform.$visible" class="form-buttons form-inline" shown="channel.isEditing"><button type="submit" ng-disabled="rowform.$waiting" class="btn btn-primary btn-xs">保存</button> <button type="button" ng-disabled="rowform.$waiting" ng-click="rowform.$cancel();channel.isEditing = false" class="btn btn-default btn-xs">取消</button></form></div><div class="pull-left OperateItem"><a href="javascript:void(0)" ng-show="channel.id != viewOfSensor.removeChannel && operateStatus.edit.isEnable" ng-click="viewOfSensor.removeChannel=channel.id"><i class="glyphicon glyphicon-trash"></i></a> <a href="javascript:void(0)" ng-show="channel.id == viewOfSensor.removeChannel" ng-click="onRemove(channel,sensor)"><i class="glyphicon glyphicon-ok"></i></a> <a href="javascript:void(0)" ng-show="channel.id == viewOfSensor.removeChannel" ng-click="viewOfSensor.removeChannel=0"><i class="glyphicon glyphicon-remove"></i></a></div></div></div><div class="col-md-4" ng-bind="channel.freq"></div></div></td><td><a href="javascript:void(0)" ng-click="OnSensorAttribute(sensor)"><i class="glyphicon glyphicon-pencil"></i>属性</a></td></tr></tbody></table><uib-pagination class="pull-right mt0 mb0" total-items="itemsTotal" ng-model="currentPage" items-per-page="pageSize" max-size="10" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></uib-pagination></div></div></div></div></div>