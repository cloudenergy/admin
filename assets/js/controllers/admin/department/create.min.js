angular.module("app").controller("departmentcreate",["$scope","$state","$uibModal","Department","Auth","API","Project","UI","Sensor","md5",function(e,t,n,r,o,c,s,u,a,l){e.ondutyHour=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],e.ondutyMinute=["00","10","20","30","40","50"],e.offdutyHour=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],e.offdutyMinute=["00","10","20","30","40","50"],o.Check(function(){e.department={character:"NONE"};var o=e.Project.selected._id;e.warning={},e.submit=function(n){return e.department.account<10?void u.AlertWarning("用户名不能低于10位"):e.department.password!=e.repassword?void swal("错误","两次输入的密码不一致","warning"):e.SelectSensors&&e.SelectSensors.length&&!e.department.account?void u.AlertWarning("请选择所属账户"):e.department.password?(e.department.resource={project:[o],sensor:[]},_.each(e.SelectSensors,function(t){"*"==t._id?e.department.resource.sensor="*":e.department.resource.sensor.push(o+"."+t._id)}),e.department.onduty=e.ondutyHour.selected+":"+e.ondutyMinute.selected,e.department.offduty=e.offdutyHour.selected+":"+e.offdutyMinute.selected,e.department.message=Object.keys(e.warning).filter(function(t){return e.warning[t]?t:""}).join(","),e.department.project=o,e.department.password=l.createHash(e.department.password).toUpperCase(),void c.Query(r.add,e.department,function(e){e.code?u.AlertError(e.message):(u.AlertSuccess("保存成功"),t.go("admin.department.info"))})):void u.AlertWarning("请设置密码")},e.OnSelectAccount=function(t){t.preventDefault();var r=n.open({templateUrl:"accountSelect.html",controller:"AccountSelect",size:"lg",resolve:{SelectedAccounts:function(){return e.SelectAccounts||null}}});r.result.then(function(t){if(e.SelectAccounts=t,e.department.account=t._id,e.SelectAccounts.resource)if("*"==e.SelectAccounts.resource.sensor)e.SelectSensors=[{_id:"*",title:"所有传感器"}];else{var n=new RegExp(o+".","g"),r=o+".*",s=[];for(var u in e.SelectAccounts.resource.sensor){var l=e.SelectAccounts.resource.sensor[u];if(l==r){e.SelectSensors=[{_id:"*",title:"所有传感器"}],sensorID=[];break}if(l.match(n)){var d=l.replace(n,"");s.push(d)}}s.length&&c.Query(a.info,{ids:s},function(t){t.err||(e.SelectSensors=[],_.each(t.result,function(t){e.SelectSensors.push(t)}))})}},function(){})},e.OnSelectSensor=function(t){t.preventDefault();var r=n.open({templateUrl:"channelSelect.html",controller:"ChannelSelect",size:"lg",resolve:{ProjectID:function(){return o},SelectedSensors:function(){return e.SelectSensors||[]}}});r.result.then(function(t){e.SelectSensors=t},function(){})},e.OnSelectCharacter=function(t,n){t.preventDefault(),e.department.character=n},c.Query(s.info,{id:o},function(t){if(t.code);else{if(t.result.onduty){var n=moment(t.result.onduty,"H:mm");e.ondutyHour.selected=n.format("H"),e.ondutyMinute.selected=n.format("mm")}if(t.result.offduty){var r=moment(t.result.offduty,"H:mm");e.offdutyHour.selected=r.format("H"),e.offdutyMinute.selected=r.format("mm")}}})})}]);
//# sourceMappingURL=create.min.js.map
