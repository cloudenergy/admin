angular.module("app").controller("Finance.record.out",["$scope","$filter","$timeout","$api","$q","$state","$stateParams","uiGridConstants",function(e,t,n,i,a,o,r,c){var l=this,d=new Date;l.projectid=r.projectid,l.paneHeight=90.01,l.searchText="",l.startDate=t("date")(d,"yyyy-MM-01"),l.endDate=t("date")(d,"yyyy-MM-dd"),l.types=[{title:"全部类型"},{key:"RECHARGING",title:"充值"},{key:"WITHDRAW",title:"提现"},{key:"PAYFEES",title:"缴费"},{key:"HANDLINGCHARGE",title:"服务费"}],angular.forEach(l.types,function(e){this[e.key]=e.title},l.status),l.status=[{title:"全部状态"},{key:"CHECKING",title:"等待审核"},{key:"CHECKFAILED",title:"审核失败"},{key:"PROCESSING",title:"正在处理"},{key:"FAILED",title:"处理失败"},{key:"SUCCESS",title:"完成"}],angular.forEach(l.status,function(e){this[e.key]=e.title},l.status),l.operation={color:{CHECKING:"text-primary",PROCESSING:"text-warning",CHECKFAILED:"text-danger",FAILED:"text-danger",SUCCESS:"text-success"},text:{CHECKING:"审核",PROCESSING:"状态",CHECKFAILED:"查看明细",FAILED:"查看明细",SUCCESS:"查看明细"}},$("#start_date").bind("dp.change",function(e){n(function(){e.date&&e.oldDate&&l.list()})}),$("#end_date").bind("dp.change",function(e){n(function(){e.date&&e.oldDate&&l.list()})}),l.filter=function(){l.gridOptions.enableFiltering=!l.gridOptions.enableFiltering,l.gridApi.core.notifyDataChange(c.dataChange.COLUMN)},l.export=function(){l.gridOptions.exporterCsvFilename="平台财务_支出_"+(l.projectname?l.projectname+"_":"")+l.startDate.replace(/\-/g,"")+"_"+l.endDate.replace(/\-/g,"")+".csv",l.gridApi.exporter.csvExport("visible","visible",angular.element(document.querySelectorAll(".subContent")))},l.projectid&&(o.$current.data.title=l.projectname=EMAPP.Project[l.projectid].title,i.business.accountbalance({project:l.projectid},function(e){l.accountbalance=e.result||{},l.accountbalance.total=Math.round(100*(l.accountbalance.cash+l.accountbalance.frozen))/100,l.accountbalance.cash=Math.round(100*l.accountbalance.cash)/100,l.accountbalance.frozen=Math.round(100*l.accountbalance.frozen)/100})),l.placeholder=l.projectid&&"商户名称"||"项目名称",l.list=function(e){if(!(e&&l.gridOptions.paging&&l.gridOptions.paging.count<=l.gridOptions.paging.pageindex*l.gridOptions.paging.pagesize))return i.business.pltfundflow({projectid:l.projectid||void 0,key:l.searchText||void 0,from:l.startDate.replace(/\-/g,""),to:l.endDate.replace(/\-/g,""),flow:"EXPENSE",category:l.types.selected||void 0,status:l.status.selected||void 0,pageindex:(e&&l.gridOptions.paging?l.gridOptions.paging.pageindex:0)+1,pagesize:100,cancellable:!0},function(i){return i=i.result||{},angular.forEach(i.detail,function(e){e.timecreate=e.timecreate&&t("date")(1e3*e.timecreate,"yyyy-M-dd H:mm:ss")||"";var n=[];e.channelaccount.name&&n.push(e.channelaccount.name),e.channelaccount.origin&&n.push(e.channelaccount.origin),e.channelaccount.account&&n.push("尾号: "+e.channelaccount.account.substr(e.channelaccount.account.length-4)),e.channelaccount=n.join(" | ")||"关联账户不存在"}),e?l.gridOptions.data=l.gridOptions.data.concat(i.detail||[]):(l.gridOptions.data=i.detail||[],l.gridOptions.data.length&&n(function(){l.gridApi.core.scrollTo(l.gridOptions.data[0],l.gridOptions.columnDefs[0])})),l.gridOptions.paging=i.paging,n(function(){l.paneHeight=90}),l.gridApi.grid.element.height("auto"),i}).$promise},l.list(),l.gridOptions={onRegisterApi:function(t){t.infiniteScroll.on.needLoadMoreData(e,function(){var e=a.defer(),n=e.resolve,i=function(){t.infiniteScroll.dataLoaded(),e.reject()};return function(e){e?e.then(function(){t.infiniteScroll.saveScrollPercentage(),t.infiniteScroll.dataLoaded(!1,!0).then(n,i)},i):i()}(l.list(!0)),e.promise}),l.gridApi=t},infiniteScrollDown:!0,enableColumnResizing:!0,exporterOlderExcelCompatibility:!0,exporterFieldCallback:function(e,t,n,i){return/status/.test(n.field)&&(i=l.status[i]||""),0===i?0:'="'+(i||"")+'"'},columnDefs:[{displayName:"",name:"$index",type:"number",width:50,minWidth:50,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div  class="ui-grid-cell-contents">序号</div>',cellClass:"text-center",cellTemplate:'<div  class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"项目名称",name:"projectname",width:"*",minWidth:120,visible:!l.projectid,enableColumnMenu:!1,cellTemplate:'<div  class="ui-grid-cell-contents text-primary"><a ui-sref="admin.finance.record.out.project({projectid:row.entity.project})" ng-bind="COL_FIELD"></a></div>'},{displayName:"交易帐户",name:"channelaccount",width:"*",minWidth:220,enableColumnMenu:!1},{displayName:"提现金额 ¥",name:"amount",width:"*",minWidth:120},{displayName:"操作后余额 ¥",name:"balance",width:"*",minWidth:120,enableColumnMenu:!1},{displayName:"交易类型",name:"category",width:"*",minWidth:100,enableColumnMenu:!1},{displayName:"交易状态",name:"status",width:"*",minWidth:100,enableColumnMenu:!1,cellTemplate:'<div  class="ui-grid-cell-contents" ng-class="grid.appScope.self.operation.color[row.entity.status]" ng-bind="grid.appScope.self.status[COL_FIELD]"></div>'},{displayName:"提交时间",name:"timecreate",width:"*",minWidth:130},{displayName:"操作",name:"operation",width:"*",minWidth:80,enableColumnMenu:!1,exporterSuppressExport:!0,cellTemplate:'<div  class="ui-grid-cell-contents text-primary"><a class="text-primary" ui-sref="admin.finance.record.out.project.detail({projectid:row.entity.project,orderno:row.entity.orderno})" ng-bind="grid.appScope.self.operation.text[row.entity.status]"></a></div>'}]}}]);
//# sourceMappingURL=record-out.min.js.map
