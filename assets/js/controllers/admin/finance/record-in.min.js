angular.module("app").controller("Finance.record.in",["$scope","$filter","$templateCache","$timeout","$api","$q","$state","$stateParams","uiGridConstants",function(e,t,n,i,a,o,r,d,l){var c=this,s=new Date;c.projectid=d.projectid,c.paneHeight=90.01,c.searchText="",c.startDate=t("date")(s,"yyyy-MM-01"),c.endDate=t("date")(s,"yyyy-MM-dd"),$("#start_date").bind("dp.change",function(e){i(function(){e.date&&e.oldDate&&c.list()})}),$("#end_date").bind("dp.change",function(e){i(function(){e.date&&e.oldDate&&c.list()})}),c.filter=function(){c.gridOptions.enableFiltering=!c.gridOptions.enableFiltering,c.gridApi.core.notifyDataChange(l.dataChange.COLUMN)},c.export=function(){c.gridOptions.exporterCsvFilename="平台财务_收入_"+(c.projectname?c.projectname+"_":"")+c.startDate.replace(/\-/g,"")+"_"+c.endDate.replace(/\-/g,"")+".csv",c.gridApi.exporter.csvExport("visible","visible",angular.element(document.querySelectorAll(".subContent")))},c.projectid&&(r.$current.data.title=c.projectname=EMAPP.Project[c.projectid].title,a.business.accountbalance({project:c.projectid},function(e){c.accountbalance=e.result||{},c.accountbalance.total=Math.round(100*(c.accountbalance.cash+c.accountbalance.frozen))/100,c.accountbalance.cash=Math.round(100*c.accountbalance.cash)/100,c.accountbalance.frozen=Math.round(100*c.accountbalance.frozen)/100})),c.placeholder=c.projectid&&"商户名称"||"项目名称",c.list=function(e){if(!(e&&c.gridOptions.paging&&c.gridOptions.paging.count<=c.gridOptions.paging.pageindex*c.gridOptions.paging.pagesize))return a.business.pltfundflow({projectid:c.projectid||void 0,key:c.searchText||void 0,from:c.startDate.replace(/\-/g,""),to:c.endDate.replace(/\-/g,""),flow:"EARNING",pageindex:(e&&c.gridOptions.paging?c.gridOptions.paging.pageindex:0)+1,pagesize:100,cancellable:!0},function(n){return n=n.result||{},angular.forEach(n.detail,function(e){e.timepaid=e.timepaid&&t("date")(1e3*e.timepaid,"yyyy-M-dd H:mm:ss")||""}),e?c.gridOptions.data=c.gridOptions.data.concat(n.detail||[]):(c.gridOptions.data=n.detail||[],c.gridOptions.data.length&&i(function(){c.gridApi.core.scrollTo(c.gridOptions.data[0],c.gridOptions.columnDefs[0])})),c.gridOptions.paging=n.paging,i(function(){c.paneHeight=90}),c.gridApi.grid.element.height("auto"),n}).$promise},c.list(),c.gridRowChanged=function(){c.sum={amount:0,balance:0},angular.forEach(c.gridApi.core.getVisibleRows(c.gridApi.grid),function(e){"SUCCESS"===e.entity.status&&(c.sum.amount=Math.round(100*(c.sum.amount+e.entity.amount))/100,c.sum.balance=Math.round(100*(c.sum.balance+e.entity.balance))/100)})},c.gridOptions={onRegisterApi:function(t){t.core.on.rowsRendered(e,c.gridRowChanged),t.infiniteScroll.on.needLoadMoreData(e,function(){var e=o.defer(),n=e.resolve,i=function(){t.infiniteScroll.dataLoaded(),e.reject()};return function(e){e?e.then(function(){t.infiniteScroll.saveScrollPercentage(),t.infiniteScroll.dataLoaded(!1,!0).then(n,i)},i):i()}(c.list(!0)),e.promise}),c.gridApi=t},infiniteScrollDown:!0,enableColumnResizing:!0,exporterOlderExcelCompatibility:!0,exporterFieldCallback:function(e,t,n,i){return 0===i?0:'="'+(i||"")+'"'},columnDefs:[{displayName:"",name:"$index",type:"number",width:50,minWidth:50,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div  class="ui-grid-cell-contents">序号</div>',cellClass:"text-center",cellTemplate:'<div  class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"项目名称",name:"projectname",width:"*",minWidth:120,visible:!c.projectid,enableColumnMenu:!1,cellTemplate:'<div  class="ui-grid-cell-contents text-primary"><a ui-sref="admin.finance.record.in.project({projectid:row.entity.project})" ng-bind="COL_FIELD"></a></div>'},{displayName:"充值商户",name:"from",width:"*",minWidth:120,enableColumnMenu:!1},{displayName:"充值金额 ¥",name:"amount",width:"*",minWidth:120,headerCellTemplate:function(){return n.get("ui-grid/uiGridHeaderCell").replace('</sub></span></div><div  role="button" tabindex="0"','</sub></span><div  class="text-info">合计：{{grid.appScope.self.sum.amount}}</div></div><div  role="button" tabindex="0"')}},{displayName:"充值后余额 ¥",name:"balance",width:"*",minWidth:120,enableColumnMenu:!1},{displayName:"到账时间",name:"timepaid",width:"*",minWidth:130}]}}]);
//# sourceMappingURL=record-in.min.js.map
