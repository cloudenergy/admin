angular.module("app").controller("accountCreate",["$scope","$q","$state","$cookies","BillingAccount","Account","md5","API","Auth","UI","Character",function(e,r,c,t,a,n,o,s,u,i,l){u.Check(function(){e.warning={},e.submit=function(r){if(e.account.user.length<6)return void i.AlertError("用户名不能低于6位");if(e.newpasswd!=e.repeatnewpasswd)return void i.AlertError("二次密码输入不一致，请重新输入");if(void 0!=e.newpasswd||null!=e.newpasswd){var t=o.createHash(e.newpasswd).toUpperCase();e.account.passwd=t}return e.characters.selected?(e.account.character=e.characters.selected._id,e.account.message=Object.keys(e.warning).filter(function(r){return e.warning[r]?r:""}).join(","),void s.Query(a.add,{account:e.account.user,title:e.account.user},function(r){r.code?i.AlertError(r.message):(e.account.billingAccount=r.result._id,console.log(e.account),s.Query(n.add,e.account,function(e){console.log(e),e.code?i.AlertError("账户创建错误: "+e.message):(i.AlertSuccess("创建账户成功"),c.go("admin.account.info"))}))})):void i.AlertError("请选择创建账户的权限级别")},s.Query(n.info,{id:t.user},function(r){if(r.code)i.AlertError(result.message);else{e.adminUser=r.result;var c=e.adminUser.character&&e.adminUser.character.level;s.Query(l.info,{power:c},function(r){r.code?i.AlertError(r.message):(e.characters=r.result,e.characters.selected=e.characters[e.characters.length-1])})}})})}]);
//# sourceMappingURL=create.min.js.map
