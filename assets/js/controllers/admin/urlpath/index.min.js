angular.module("app").controller("urlpathInfo",["$scope","$q","UrlPath","API","Auth","UI",function(e,n,o,i,t,d){var u,r=new Array;t.Check(function(){function t(e){d.AlertError(e.data.message)}e.doSave=function(t){function d(e,n){if("/"!=e._id&&(n+=e._id),void 0!=e.authtype){var o={_id:e._id,desc:e.desc,authtype:e.authtype,needlogin:e.needlogin,enable:e.enable};o._id=n,console.log(n,"node: ",o),u.push(o)}void 0!=e.nodes&&e.nodes.length>0&&_.each(e.nodes,function(e){d(e,n+"/")})}t.preventDefault();var u=new Array;d(e.urlpath[0],""),console.log(r);var a=new Array;_.each(r,function(e){a.push(e.url._id)}),i.QueryPromise(o.delete,{id:a}),n.all([i.QueryPromise(o.delete,{id:a}).promise,i.QueryPromise(o.update,u).promise]).then(function(e){console.log(e)})},e.insert=function(e){},i.Query(o.info,{},function(n){if(n.err);else{u=n.result;var o={_id:"/",nodes:new Array};_.each(u,function(e){var n=e._id.split("/"),i=o;_.each(n,function(o,t){if(""!=o){var d=n.length==t+1,u=_.find(i.nodes,function(e){return e._id==o});void 0==u&&(u=d?{_id:o,url:e,desc:e.desc||"",enable:e.enable,needlogin:e.needlogin,authtype:e.authtype,nodes:new Array}:{_id:o,desc:e.desc||"",nodes:new Array},i.nodes.push(u)),i=u}})}),console.log(o),e.urlpath=[o]}},t),e.RemoveNode=function(e,n){e.remove(),r.push(n)},e.enable=function(e){e.enable=!e.enable},e.toggle=function(e){e.toggle()},e.newSubItem=function(e){var n=e.node;n.nodes.push({_id:"",authtype:"NONE",needlogin:!0,enable:!0,editing:!0,isnew:!0,nodes:[]})},e.edit=function(e){e.editing=!0},e.needLogin=function(e){e.needlogin=!e.needlogin},e.SetAuthType=function(e,n){e.authtype=n},e.cancelEditing=function(n,o){o._id.length?o.editing=!1:e.RemoveNode(n,o)},e.save=function(e){e.editing=!1,e.isnew=!1}})}]);