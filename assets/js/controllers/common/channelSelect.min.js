angular.module("app").controller("ChannelSelect",["$scope","$rootScope","$uibModalInstance","API","Sensor","ProjectID","SelectedSensors",function(e,n,i,s,r,o,a){var t;e.currentPage=1,e.project=o,e.Ok=function(){var n=!0;e.viewOfSensors[0].isEnable?(a=[e.viewOfSensors[0]],i.close(a)):(_.each(e.viewOfSensors,function(e){var i=_.find(a,function(n){return n._id==e._id});n=!1,e.isEnable&&angular.isUndefined(i)&&a.push(e)}),n?e.Cancel():i.close(a))},e.Cancel=function(){i.dismiss("cancel")},e.SwitchSensor=function(n,i){if(n.preventDefault(),"*"==i._id)i.isEnable=!i.isEnable,_.each(e.viewOfSensors,function(e){e.isEnable=i.isEnable});else{var s=_.find(a,function(e){return e._id==i._id});s?a=_.without(a,s):a.push(i),e.viewOfSensors[0].isEnable=!1,i.isEnable=!i.isEnable}},e.onSearchSensor=function(n){n.preventDefault(),e.UpdateViewOfSensors(e.sensorSearchKey)},e.OnSelectAll=function(i){i.preventDefault();for(var s=(e.currentPage-1)*n.popPageSize,r=e.currentPage*n.popPageSize,o=s;o<r;o++)e.viewOfSensors[o].isEnable=!0},e.UpdateViewOfSensors=function(n){e.viewOfSensors=[{_id:"*",title:"所有传感器",isEnable:!!a.indexOf("*")}],n?_.each(t,function(i){i.title.match(n)?e.viewOfSensors.push(i):i.channel&&i.channel.match(n)&&e.viewOfSensors.push(i)}):e.viewOfSensors=_.union(e.viewOfSensors,t),_.each(e.viewOfSensors,function(e){var n;n=_.find(a,function(n){return _.isObject(n)?n._id==e._id:n==o+"."+e._id}),e.isEnable=!angular.isUndefined(n)})},s.Query(r.channelinfo,{project:o},function(n){n.err||(t=n.result,e.UpdateViewOfSensors())}.bind(this))}]);