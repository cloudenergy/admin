angular.module("app").controller("session",["$api","$cookies","$state","UI","md5",function(e,t,o,n,a){var s=this,r=/cloudenergy\.me/.test(location.hostname)?".cloudenergy.me":location.hostname,i=function(e){e=e&&e.result||{},angular.forEach(["token","user"],function(o){e[o]&&t.put(o,e[o],{path:"/",domain:r,expires:new Date((new Date).setMonth((new Date).getMonth()+1))})}),e.token?o.go("admin.dashboard"):(o.go("login"),n.AlertError(e.message,"登录失败"))};s.login=function(){var t=this&&this.user,o=this&&this.passwd,s=[];!t&&s.push("帐号"),!o&&s.push("密码"),s=s.join("与"),s&&n.AlertError("请输入您的"+s),!s&&e.auth.login({user:t,passwd:a.createHash(o).toUpperCase()},i,function(e){n.AlertError("服务器错误","错误: "+e.data.code)})}}]);