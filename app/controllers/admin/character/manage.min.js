angular.module("app").controller("characterManage",["$scope","$stateParams","$state","UrlPath","$cookies","Account","$q","Project","Building","Customer","Collector","Sensor","Auth","API","UI","Character",function(e,n,r,t,c,o,a,i,u,s,d,l,f,h,v,g){var p={},m=n.id;f.Check(function(){function n(){var n=a.defer(),r=function(e){var n=function(e,r){_.map(e,function(e,t){e.leaf?p[r+"/"+t]=!0:n(e,"/"==t?"":r+"/"+t)})};n(e,"")};return m?h.Query(g.info,{id:m},function(t){t.err?n.reject(t.err):(e.character=t.result,r(t.result.rule),n.resolve())}):n.resolve(),n.promise}e.OnSave=function(){var n=new Array;!function c(e,r){"/"!=e._id&&(r+=e._id),e.select&&n.push(r),void 0!=e.nodes&&e.nodes.length>0&&_.each(e.nodes,function(e){c(e,r+"/")})}(e.urlpath[0],"");var t={};_.each(n,function(e){var n=e.split("/"),r=t;_.each(n,function(e,t){""==e&&(e="/");var c=!1;t==n.length-1&&(c=!0),r[e]||(r[e]={}),r[e].leaf=c,r=r[e]})}),e.character.rule=t,m?h.Query(g.update,e.character,function(e){return e.code?void v.AlertError(e.message):void r.go("admin.character.info")}):h.Query(g.add,e.character,function(e){return e.code?void v.AlertError(e.message):void r.go("admin.character.info")})},n().then(function(){h.Query(t.info,{},function(n){if(n.err);else{var r={_id:"/",nodes:new Array};_.each(n.result,function(e){var n=e._id.split("/"),t=r;_.each(n,function(r,c){if(""!=r){var o=n.length==c+1,a=_.find(t.nodes,function(e){return e._id==r});void 0==a&&(o?(a={_id:r,url:e,desc:e.desc||"",enable:e.enable,select:!1,nodes:new Array},a.select=!!p[e._id]):a={_id:r,desc:e.desc||"",select:!1,nodes:new Array},t.nodes.push(a)),t=a}})}),e.urlpath=[r]}})}),e.enable=function(e){e.select=!e.select},e.toggle=function(e){e.toggle()},e.EnableSubNode=function(e,n){var r=function(e){e&&_.each(e.nodes,function(e){return e.select=n,r(e)})};r(e)}})}]);
//# sourceMappingURL=manage.min.js.map
