EMAPP.register.controller("characterInfo",["$rootScope","$scope","SettingMenu","API","Auth","$cookies","UI","Character","Config",function(e,r,a,t,c,n,l,o,u){r.operateStatus={manage:{isEnable:!1,url:"/manage"},"delete":{isEnable:!1,url:"/delete"}},r.askingRemoveID=void 0,r.MaxLevel=0,c.Check(r.operateStatus,function(){function e(e){l.AlertError(e.data.message)}a(function(e){r.menu=e}),t.Query(o.info,{},function(e){e.err||(r.characters=e.result,console.log(r.characters),r.MaxLevel=r.characters.length-1)}),r.DoRemove=function(a,c,n){a.preventDefault();var u=l.GetAbsoluteIndex(r.currentPage,n);t.Query(o["delete"],{id:c},function(e){r.characters.splice(u,1)},e)},r.AskForRemove=function(e,a){e.preventDefault(),r.askingRemoveID=a},r.CancelRemove=function(e,a){e.preventDefault(),r.askingRemoveID=void 0},r.$watch("currentPage",function(e){return e?void l.PutPageIndex(void 0,r.currentPage):void(r.currentPage=l.GetPageIndex())}),r.onLevelUp=function(e,a,c){e.preventDefault();var n=r.characters[c-1];r.characters[c-1].level++,r.characters[c].level--,r.characters[c-1]=r.characters[c],r.characters[c]=n,t.Query(o.update,{_id:r.characters[c]._id,level:r.characters[c].level},function(e){}),t.Query(o.update,{_id:r.characters[c-1]._id,level:r.characters[c-1].level},function(e){})},r.onLevelDown=function(e,a,c){e.preventDefault();var n=r.characters[c+1];r.characters[c+1].level--,r.characters[c].level++,r.characters[c+1]=r.characters[c],r.characters[c]=n,t.Query(o.update,{_id:r.characters[c]._id,level:r.characters[c].level},function(e){}),t.Query(o.update,{_id:r.characters[c+1]._id,level:r.characters[c+1].level},function(e){})},r.adminUser=n.user})}]);