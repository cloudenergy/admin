angular.module("app").controller("DriverIndex",["$scope","SettingMenu","$q","$modal","Energy","API","Auth","Project","UI","Customer","base64","Sensor","Driver",function(e,t,r,i,n,o,l,c,s,u,a,d,f){var v="customer.project",p={},g={};l.Check(function(){function n(e,t,r){if(t){var i=[];return _.each(t,function(t){e?t.id=e.id+"/"+t.name:t.id=t.name,t.title=t.name,t.level=r,t.nodes=n(t,t.driver,r+1),t.childrens=null,t.parent=e,i.push(t)}),i.sort(function(e,t){return e.index>t.index?1:-1}),i}}function l(t){p={},g={},e.projects.title=t,o.Query(u.info,{project:t},function(t){if(t.err);else{var r=t.result;if(r){var i=n(null,r.socities,1);e.viewOfDriver=[{nodes:i,title:"社会属性",level:0}],console.log(e.viewOfDriver)}else e.viewOfDriver=[{nodes:[],title:"社会属性",level:0}]}},a)}function a(e){s.AlertError(e.data.message)}t(function(t){e.menu=t}),e.doSaveCustomer=function(t){t.preventDefault();var r=function(e,t){var i={};return _.each(t,function(e,t){var n={id:e.id,title:e.title,acreage:e.acreage||0,index:t};e.originid&&e.originid!=e.id&&(g[e.originid]=e.id);var o=r(n,e.nodes);o&&(n.childrens=o),i[e.id]=n}),i},i=r(null,e.viewOfDriver[0].nodes);console.log(i,p,g);var n={socities:i,project:e.projects.title};console.log(n),o.Query(u.update,n,function(t){console.log(t),t.err?a(t.err):o.Query(d.info,{project:e.projects.title},function(t){t.err||(UpdateSensorSocities(),l(e.projects.title))})})},r.all([o.QueryPromise(c.info,{}).$promise,o.QueryPromise(f["enum"],{}).$promise]).then(function(t){e.projects=angular.isArray(t[0].result)?t[0].result:[t[0].result];var r=s.GetPageItem(v);r?(r=_.find(e.projects,function(e){return e._id==r}),e.projects.title=r._id):e.projects.length>0&&(e.projects.title=e.projects[0]._id),e.Drivers=t[1].result;var i=n(null,e.Drivers,1);e.viewOfDriver=[{nodes:i,title:"驱动列表",level:0}],console.log(e.viewOfDriver)}),e.$watch("projects.title",function(t){t&&(s.PutPageItem(v,t),e.projects.title=t)}),e.save=function(e){if(!e.title.length)return alert("请输入分类名称"),!1;if(e.parent){var t=_.find(e.parent.nodes,function(t){return t.id&&t.id.length&&!t.editing?t.title==e.title?(alert("已有相同名称，请确认"),!0):!1:void 0});if(t)return!1}e.editing=!1,e.originid||(e.origintitle=e.title);var r=function(e){e.id=GenereateID(e.parent,e.title),p[e.id]&&(p[e.id]=null),_.each(e.nodes,function(e){r(e)})};r(e),console.log(e,p)},e.OnSelectSensor=function(t){console.log(t);var r=i.open({templateUrl:"sensorSelect.html",controller:"SensorSelect",size:"lg",resolve:{ProjectID:function(){return e.projects.title},Driver:function(){return t.id}}});r.result.then(function(e){},function(){})}})}]);
//# sourceMappingURL=index.min.js.map
