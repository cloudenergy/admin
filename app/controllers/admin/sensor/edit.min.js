angular.module("app").controller("SensorEdit",["$scope","$stateParams","$state","Sensor","Collector","Energy","Customer","Building","API","Auth","UI",function(e,n,s,i,o,t,r,l,u,c,a){c.Check(function(){function o(e,n,s){if(n){var i=[];return _.each(n,function(n){n.childrens?n.ischild=!1:n.ischild=!0,n.parent=e,n.level=s,n.nodes=o(n,n.childrens,s+1),i.push(n)}),i.sort(function(e,n){return e.title>n.title?1:-1}),i}}var r;e.submit=function(n){var o=angular.copy(e.sensor);o.project=e.sensor.building.project._id,o.building=e.sensor.building._id,r?(o.energy=u.RootEnergycategory(r.id),o.energyPath=r.id):(o.energy="",o.energyPath="");var t=(o.building,function(){console.log(o),u.Query(i.update,o,function(e){e.err||s.go("admin.sensor.info")})});e.sid!=o.sid?u.Query(i.info,{sids:[o.sid]},function(e){return console.log(e),e.result&&e.result.length>0?void alert("传感器标识已经存在"):void t()},function(e){console.log(e)}):t()},u.Query(i.channelinfo,{id:n.id},function(n){n.err||(e.sensor=n.result[0],console.log(e.sensor),e.sid=e.sensor.sid,e.building=e.sensor.building,u.Query(l.info,{id:e.sensor.building.id},function(n){n.err||u.Query(t.info,{project:e.building.project},function(n){if(n.err);else{var s=n.result;if(e.sensor.energyPath){var i,t=e.sensor.energyPath.split("|"),l=s.energy;_.each(t,function(e){l&&(i?i+="|"+e:i=e,l=l[i],l&&(l&&!l.childrens?(l.isSelect=!0,r=l):l=l.childrens))})}if(s){var u=o(null,s.energy,1);e.viewOfEnergy=[{nodes:u,title:"能耗分类",level:0}]}else e.viewOfEnergy=[{nodes:[],title:"能耗分类",level:0}]}})}))}),e.onChoice=function(e){e.isSelect=!e.isSelect;var n=function(e,s){e&&e.nodes&&e.nodes.length&&(_.each(e.nodes,function(e){n(e,s),e.isSelect=s}),e.isSelect=s)};n(e,e.isSelect)},e.onEnergyChoice=function(e){e.nodes||(console.log(e),r&&(r.isSelect=!1),r=e,r.isSelect=!0)},e.OnCollapsePayStatus=function(){e.sensor.paystatus&&"NONE"!=e.sensor.paystatus?e.sensor.paystatus="NONE":e.sensor.paystatus="BYSELF"},e.OnSelectPayMode=function(n,s){n.preventDefault(),e.sensor.paystatus=s}})}]);
//# sourceMappingURL=edit.min.js.map
