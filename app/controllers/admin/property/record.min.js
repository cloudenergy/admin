angular.module("app").controller("Property.record",["$scope","$timeout","$api","$state","$stateParams",function(t,e,a,n,i){function o(){return{project:EMAPP.Project.selected._id,key:c.searchText||void 0,from:c.startDate.replace(/\-/g,""),to:c.endDate.replace(/\-/g,""),flow:{in:"EARNING",out:"EXPENSE"}[c.tab],category:c.category.selected||void 0,status:c.status.selected||void 0,amount:[void 0===c.amount.start?null:parseFloat(c.amount.start),void 0===c.amount.end?null:parseFloat(c.amount.end)]}}var c=this,l=EMAPP.Account._id+"_property_record_pagesize";t.$watchGroup([function(){return c.startDate},function(){return c.endDate}],function(){c.dateRange.temp?e(function(){delete c.dateRange.temp},10):delete c.dateRange.selected,c.listData&&c.list()}),t.$watch(function(){return c.paging.index},function(){c.listData&&c.list()}),t.$watch(function(){return c.paging.size},function(t){localStorage.setItem(l,t),c.listData&&c.list()}),t.$watch("Project.selected",function(){c.list()}),c.tab=i.tab||"all",c.startDate=moment().format("YYYY-MM-01"),c.endDate=moment().format("YYYY-MM-DD"),c.amount={},c.dateRange=["今天","昨天","最近7天","最近30天"],c.dateRange.select=function(t){switch(c.dateRange.temp=!0,c.dateRange.selected=t){case 0:c.startDate=c.endDate=moment().format("YYYY-MM-DD");break;case 1:c.startDate=c.endDate=moment().subtract(1,"days").format("YYYY-MM-DD");break;case 2:c.startDate=moment().subtract(7,"days").format("YYYY-MM-DD"),c.endDate=moment().format("YYYY-MM-DD");break;case 3:c.startDate=moment().subtract(30,"days").format("YYYY-MM-DD"),c.endDate=moment().format("YYYY-MM-DD")}},c.status=[{title:"全部状态"},{key:"CHECKING",title:"等待审核",class:"primary"},{key:"CHECKFAILED",title:"审核失败",class:"warning"},{key:"PROCESSING",title:"正在处理",class:"info"},{key:"FAILED",title:"处理失败",class:"danger"},{key:"SUCCESS",title:"完成",class:"success"}],angular.forEach(c.status,function(t){this[t.key]={title:t.title,class:t.class}},c.status),c.category=[{title:"全部类型"},{key:"RECHARGING",title:"充值"},{key:"WITHDRAW",title:"提现"},{key:"PAYFEES",title:"缴费"},{key:"HANDLINGCHARGE",title:"手续费"},{key:"HANDLINGCHARGERCG",title:"充值服务费"},{key:"HANDLINGCHARGEWTD",title:"提现服务费"},{key:"alipay",title:"支付宝手机支付"},{key:"wx",title:"微信支付"},{key:"wx_pub",title:"微信公众号支付"},{key:"bankcard",title:"银行卡支付"}],angular.forEach(c.category,function(t){this[t.key]=t},c.category),c.category.selected=i.category||void 0,c.paging={index:1,size:parseInt(localStorage.getItem(l)||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},c.list=function(){a.business.fundflow(angular.extend(o(),{pageindex:c.paging.index,pagesize:c.paging.size,cancellable:!0}),function(t){delete a.$request,t=t.result||{},angular.forEach(t.detail,function(t){t.channelaccount&&t.channelaccount.account&&(t.channelaccount.tail=t.channelaccount.account.replace(/\d+(\d{4})$/,"$1")),t.timecreate=t.timecreate&&moment(1e3*t.timecreate).format("YYYY-M-DD H:mm:ss")||"",t.timecheck=t.timecheck&&moment(1e3*t.timecheck).format("YYYY-M-DD H:mm:ss")||"",t.timepaid=t.timepaid&&moment(1e3*t.timepaid).format("YYYY-M-DD H:mm:ss")||""}),c.listData=t.detail||[],c.listData.index=(t.paging||{}).pageindex||1,c.listData.total=(t.paging||{}).count||0,c.statistic=t.statistic||{}})},c.exportProjectflow=function(){delete c.downloadFile,a.export.projectflow(angular.extend(o(),{type:{all:"ALL",in:"EARNING",out:"EXPENSES"}[c.tab]}),function(t){if(t.result.fn){var e=o();c.downloadFile=t.result.fn,c.downloadName=c.projectname+"_"+n.$current.data.title+"_"+e.from+"_"+e.to}})}}]);
//# sourceMappingURL=record.min.js.map
