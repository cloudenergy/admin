angular.module("app").controller("Property.index",["$scope","$api","$uibModal","$timeout",function(t,e,a,c){function n(){e.business.accountbalance({project:EMAPP.Project.selected._id,cancellable:!0},function(t){l.accountbalance=t.result||{},l.accountbalance.total=Math.round(100*(l.accountbalance.cash+l.accountbalance.frozen))/100})}function o(){e.channelaccount.info({project:EMAPP.Project.selected._id,all:!0,flow:"EXPENSE",cancellable:!0},function(t){l.cardInfo=t.result&&t.result[0]||{},l.cardInfo.timecreate=l.cardInfo.timecreate&&moment(1e3*l.cardInfo.timecreate).format("YYYY-M-DD H:mm:ss")||"",l.cardInfo.timeenable=l.cardInfo.timeenable&&moment(1e3*l.cardInfo.timeenable).format("YYYY-M-DD H:mm:ss")||"",l.cardInfo.timeexpire=l.cardInfo.timeexpire&&moment(1e3*l.cardInfo.timeexpire).format("YYYY-M-DD H:mm:ss")||"",l.cardInfo.tail=(l.cardInfo.account||"").replace(/\d+(\d{4})$/,"$1")})}function r(){e.business.projectfundflowstatistic({from:l.startDate.replace(/\-/g,""),to:l.endDate.replace(/\-/g,""),project:EMAPP.Project.selected._id,cancellable:!0},function(t){l.fundflowstatistic=t.result||{}})}function i(){e.business.fundflow({project:EMAPP.Project.selected._id,from:l.startDate.replace(/\-/g,""),to:l.endDate.replace(/\-/g,""),pageindex:1,pagesize:9,cancellable:!0},function(t){l.fundflow=t.result.detail,angular.forEach(l.fundflow,function(t){t.channelaccount&&t.channelaccount.account&&(t.channelaccount.tail=t.channelaccount.account.replace(/\d+(\d{4})$/,"$1")),t.timecreate=t.timecreate&&moment(1e3*t.timecreate).format("YYYY-M-DD H:mm:ss")||"",t.timecheck=t.timecheck&&moment(1e3*t.timecheck).format("YYYY-M-DD H:mm:ss")||"",t.timepaid=t.timepaid&&moment(1e3*t.timepaid).format("YYYY-M-DD H:mm:ss")||""})})}var l=this;l.startDate=moment().format("YYYY-MM-01"),l.endDate=moment().format("YYYY-MM-DD"),l.dateRange=["今天","昨天","最近7天","最近30天"],l.dateRange.select=function(t){switch(l.dateRange.temp=!0,l.dateRange.selected=t){case 0:l.startDate=l.endDate=moment().format("YYYY-MM-DD");break;case 1:l.startDate=l.endDate=moment().subtract(1,"days").format("YYYY-MM-DD");break;case 2:l.startDate=moment().subtract(7,"days").format("YYYY-MM-DD"),l.endDate=moment().format("YYYY-MM-DD");break;case 3:l.startDate=moment().subtract(30,"days").format("YYYY-MM-DD"),l.endDate=moment().format("YYYY-MM-DD")}},t.$watchGroup(["self.startDate","self.endDate"],function(){l.dateRange.temp?c(function(){delete l.dateRange.temp},10):delete l.dateRange.selected,l.fundflow&&(r(),i())}),t.$watch("Project.selected",function(t){n(),o(),r(),i()}),l.getCard=function(t){e.bank.info(function(e){a.open({templateUrl:"modal-property-card.html",controllerAs:"self",controller:["$api","$uibModalInstance",function(a,c){this.bankData=e.result,this.card=t&&angular.copy(t)||{},this.card.locate=angular.isString(this.card.locate)&&JSON.parse(this.card.locate||null)||this.card.locate||{province:"浙江省",city:"杭州市",district:"西湖区"},angular.forEach(this.bankData,$.proxy(function(t){this.bankData[t.id]=t,this.card.origin===t.title&&(this.card.origin=t.id)},this)),this.submit=function(){a.channelaccount.add({id:this.card.id||void 0,flow:this.card.flow||"EXPENSE",belongto:this.card.belongto?void 0:EMAPP.Project.selected._id,name:this.card.name,account:this.card.account,type:this.card.origin,origin:this.bankData[this.card.origin].title,subbranch:this.card.subbranch,locate:this.card.locate},c.close)},this.cancel=function(){c.dismiss("cancel")}}]}).result.then(o)})},l.removeCard=function(t){swal({title:"确认删除此项吗？",text:"卡号："+t.account,type:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确认",confirmButtonColor:"#ec6c62"},function(){e.channelaccount.delete({id:t.id},o)})}}]);
//# sourceMappingURL=index.min.js.map
