angular.module("app").controller("Property.index",["$scope","$api","$uibModal","$timeout",function(e,t,a,n){function c(){t.business.accountbalance({project:EMAPP.Project.selected._id,cancellable:!0},function(e){l.accountbalance=e.result||{},l.accountbalance.total=Math.round(100*(l.accountbalance.cash+l.accountbalance.frozen))/100,l.accountbalance.cash=Math.round(100*l.accountbalance.cash)/100,l.accountbalance.frozen=Math.round(100*l.accountbalance.frozen)/100,l.accountbalance.earning=Math.round(100*l.accountbalance.earning)/100,l.accountbalance.withdraw=Math.round(100*l.accountbalance.withdraw)/100})}function i(){t.channelaccount.info({project:EMAPP.Project.selected._id,all:!0,flow:"EXPENSE",cancellable:!0},function(e){l.cardInfo=e.result&&e.result[0]||{},l.cardInfo.timecreate=l.cardInfo.timecreate&&moment(1e3*l.cardInfo.timecreate).format("YYYY-M-DD H:mm:ss")||"",l.cardInfo.timeenable=l.cardInfo.timeenable&&moment(1e3*l.cardInfo.timeenable).format("YYYY-M-DD H:mm:ss")||"",l.cardInfo.timeexpire=l.cardInfo.timeexpire&&moment(1e3*l.cardInfo.timeexpire).format("YYYY-M-DD H:mm:ss")||"",l.cardInfo.tail=(l.cardInfo.account||"").replace(/\d+(\d{4})$/,"$1")})}function o(){t.business.projectfundflowstatistic({from:l.startDate.replace(/\-/g,""),to:l.endDate.replace(/\-/g,""),project:EMAPP.Project.selected._id,cancellable:!0},function(e){e=e.result||{},e.earning&&angular.forEach(e.earning.category,function(e,t){this.push(angular.extend(e,{name:t}))},e.earning.category=[]),e.expenses&&angular.forEach(e.expenses.category,function(e,t){this.push(angular.extend(e,{category:t}))},e.expenses.category=[]),e.consumption&&angular.forEach(e.consumption.category,function(e,t){this.push(angular.extend(e,{category:t}))},e.consumption.category=[]),l.fundflowstatistic=e})}function r(){t.business.fundflow({project:EMAPP.Project.selected._id,from:l.startDate.replace(/\-/g,""),to:l.endDate.replace(/\-/g,""),pageindex:1,pagesize:11,cancellable:!0},function(e){l.fundflow=e.result.detail,angular.forEach(l.fundflow,function(e){e.channelaccount&&e.channelaccount.account&&(e.channelaccount.tail=e.channelaccount.account.replace(/\d+(\d{4})$/,"$1")),e.timecreate=e.timecreate&&moment(1e3*e.timecreate).format("YYYY-M-DD H:mm:ss")||"",e.timecheck=e.timecheck&&moment(1e3*e.timecheck).format("YYYY-M-DD H:mm:ss")||"",e.timepaid=e.timepaid&&moment(1e3*e.timepaid).format("YYYY-M-DD H:mm:ss")||""})})}var l=this;l.deviceType=[{key:"ELECTRICITYMETER",title:"电表",icon:"emfinance finance-electricity text-warning"},{key:"COLDWATERMETER",title:"冷水表",icon:"emfinance finance-water text-info"},{key:"HOTWATERMETER",title:"热水表",icon:"emfinance finance-water text-danger"},{key:"ENERGYMETER",title:"能量表",icon:"emfinance finance-power text-danger"},{key:"TEMPRATURECONTROL",title:"温控器",icon:"emfinance finance-temprature text-info"}],angular.forEach(l.deviceType,function(e){this[e.key]=e},l.deviceType),l.category=[{key:"RECHARGING",title:"充值"},{key:"PAYFEES",title:"缴费"},{key:"HANDLINGCHARGE",title:"手续费"},{key:"WITHDRAW",icon:"emfinance finance-withdraw text-danger",title:"提现"},{key:"HANDLINGCHARGERCG",icon:"emfinance finance-serve text-warning",title:"充值服务费"},{key:"HANDLINGCHARGEWTD",icon:"emfinance finance-serve text-warning",title:"提现服务费"},{key:"alipay",icon:"emfinance finance-alipay text-info",title:"支付宝手机支付"},{key:"wx",icon:"emfinance finance-wechat text-success",title:"微信支付"},{key:"wx_pub",icon:"emfinance finance-wechat-official text-success",title:"微信公众号支付"},{key:"bankcard",icon:"emfinance finance-unionpay text-primary",title:"银行卡支付"}],angular.forEach(l.category,function(e){this[e.key]=e},l.category),l.startDate=moment().format("YYYY-MM-01"),l.endDate=moment().format("YYYY-MM-DD"),l.dateRange=["今天","昨天","最近7天","最近30天"],l.dateRange.select=function(e){switch(l.dateRange.temp=!0,l.dateRange.selected=e){case 0:l.startDate=l.endDate=moment().format("YYYY-MM-DD");break;case 1:l.startDate=l.endDate=moment().subtract(1,"days").format("YYYY-MM-DD");break;case 2:l.startDate=moment().subtract(7,"days").format("YYYY-MM-DD"),l.endDate=moment().format("YYYY-MM-DD");break;case 3:l.startDate=moment().subtract(30,"days").format("YYYY-MM-DD"),l.endDate=moment().format("YYYY-MM-DD")}},e.$watchGroup(["self.startDate","self.endDate"],function(){l.dateRange.temp?n(function(){delete l.dateRange.temp},10):delete l.dateRange.selected,l.fundflow&&(o(),r())}),e.$watch("Project.selected",function(e){c(),i(),o(),r()}),l.getCard=function(e){t.bank.info(function(t){a.open({templateUrl:"modal-property-card.html",controllerAs:"self",controller:["$api","$uibModalInstance",function(a,n){this.bankData=t.result,this.card=e&&angular.copy(e)||{},this.card.locate=angular.isString(this.card.locate)&&JSON.parse(this.card.locate||null)||this.card.locate||{province:"浙江省",city:"杭州市",district:"西湖区"},angular.forEach(this.bankData,$.proxy(function(e){this.bankData[e.id]=e,this.card.origin===e.title&&(this.card.origin=e.id)},this)),this.submit=function(){a.channelaccount.add({id:this.card.id||void 0,flow:this.card.flow||"EXPENSE",belongto:this.card.belongto?void 0:EMAPP.Project.selected._id,name:this.card.name,account:this.card.account,type:this.card.origin,origin:this.bankData[this.card.origin].title,subbranch:this.card.subbranch,locate:this.card.locate},n.close)},this.cancel=function(){n.dismiss("cancel")}}]}).result.then(i)})},l.removeCard=function(e){swal({title:"确认删除此项吗？",text:"卡号："+e.account,type:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确认",confirmButtonColor:"#ec6c62"},function(){t.channelaccount["delete"]({id:e.id},i)})}}]);
//# sourceMappingURL=index.min.js.map
