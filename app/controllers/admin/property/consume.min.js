angular.module("app").controller("Property.consume",["$scope","$api","$state",function(t,e,n){function i(){e.business.departmentconsumptionstatistic({project:a.projectid,from:a.startDate.replace(/\-/g,""),to:a.endDate.replace(/\-/g,"")},function(t){a.statistic=t.result||{},angular.forEach(a.statistic.consumption.category,function(t,e){this.push(angular.extend(t,{category:e}))},a.statistic.consumption.category=[])})}var a=this,c=EMAPP.Account._id+"_property_consume_pagesize";a.searchText="",a.startDate=moment().format("YYYY-MM-01"),a.endDate=moment().format("YYYY-MM-DD"),t.$watch(function(){return a.startDate},function(){a.listData&&(i(),a.list())}),t.$watch(function(){return a.endDate},function(){a.listData&&(i(),a.list())}),t.$watch(function(){return a.category.selected},function(){a.listData&&a.list()}),t.$watch(function(){return a.paging.index},function(){a.listData&&a.list()}),t.$watch(function(){return a.paging.size},function(t){localStorage.setItem(c,t),a.listData&&a.list()}),t.$watch("Project.selected",function(t){a.projectid=t._id,i(),a.list()}),a.deviceType=[{key:"ELECTRICITYMETER",title:"电表",icon:"emfinance finance-electricity text-warning"},{key:"COLDWATERMETER",title:"冷水表",icon:"emfinance finance-water text-info"},{key:"HOTWATERMETER",title:"热水表",icon:"emfinance finance-water text-danger"},{key:"ENERGYMETER",title:"能量表",icon:"emfinance finance-power text-danger"},{key:"TEMPRATURECONTROL",title:"温控器",icon:"emfinance finance-temprature text-info"}],angular.forEach(a.deviceType,function(t){this[t.key]=t},a.deviceType),a.category=[{title:"全部类型"},{key:"PAYELECTRICITY",title:"电费"},{key:"PAYCOLDWATER",title:"冷水费"},{key:"PAYHOTWATER",title:"热水费"},{key:"PAYPROPERTY",title:"物业费"},{key:"PAYPARKING",title:"停车费"}],angular.forEach(a.category,function(t){this[t.key]=t},a.category),a.paging={index:1,size:parseInt(localStorage.getItem(c)||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},a.list=function(){e.business.departmentconsumptiondetail({project:a.projectid,key:a.searchText||void 0,category:a.category.selected||void 0,from:a.startDate.replace(/\-/g,""),to:a.endDate.replace(/\-/g,""),pageindex:a.paging.index,pagesize:a.paging.size},function(t){t=t.result||{},angular.forEach(t.detail,function(t,e){Object.keys(t.earning&&t.earning.category).length||Object.keys(t.consumption&&t.consumption.category).length||(t.isnull=!0),t.key=e,this.push(t)},t.detail=[]),a.listData=t.detail,a.listData.index=(t.paging||{}).pageindex||1,a.listData.total=(t.paging||{}).count||0})},a.exportConsumptiondetail=function(){delete a.downloadFile,e["export"].consumptiondetail({project:a.projectid,from:a.startDate.replace(/\-/g,""),to:a.endDate.replace(/\-/g,"")},function(t){t.result.fn&&(a.downloadFile=t.result.fn,a.downloadName=a.projectname+"_"+n.$current.data.title+"_"+a.startDate.replace(/\-/g,"")+"_"+a.endDate.replace(/\-/g,""))})}}]);
//# sourceMappingURL=consume.min.js.map
