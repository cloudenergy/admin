angular.module("app").controller("Property.consume",["$scope","$api","$state","$stateParams",function(t,e,n,i){function a(){e.business.departmentconsumptionstatistic({project:c.projectid,from:c.startDate.replace(/\-/g,""),to:c.endDate.replace(/\-/g,"")},function(t){c.statistic=t.result||{},angular.forEach(c.statistic.consumption.category,function(t,e){this.push(angular.extend(t,{category:e}))},c.statistic.consumption.category=[])})}var c=this,o=EMAPP.Account._id+"_property_consume_pagesize";c.projectid=i.projectid,c.searchText="",c.startDate=moment().format("YYYY-MM-01"),c.endDate=moment().format("YYYY-MM-DD"),t.$watch(function(){return c.startDate},function(){c.listData&&(a(),c.list())}),t.$watch(function(){return c.endDate},function(){a(),c.list()}),t.$watch(function(){return c.category.selected},function(){c.listData&&c.list()}),t.$watch(function(){return c.paging.index},function(){c.listData&&c.list()}),t.$watch(function(){return c.paging.size},function(t){localStorage.setItem(o,t),c.listData&&c.list()}),c.deviceType=[{key:"ELECTRICITYMETER",title:"电表",icon:"emfinance finance-electricity text-warning"},{key:"COLDWATERMETER",title:"冷水表",icon:"emfinance finance-water text-info"},{key:"HOTWATERMETER",title:"热水表",icon:"emfinance finance-water text-danger"},{key:"ENERGYMETER",title:"能量表",icon:"emfinance finance-power text-danger"},{key:"TEMPRATURECONTROL",title:"温控器",icon:"emfinance finance-temprature text-info"}],angular.forEach(c.deviceType,function(t){this[t.key]=t},c.deviceType),c.category=[{title:"全部类型"},{key:"PAYELECTRICITY",title:"电费"},{key:"PAYCOLDWATER",title:"冷水费"},{key:"PAYHOTWATER",title:"热水费"},{key:"PAYPROPERTY",title:"物业费"},{key:"PAYPARKING",title:"停车费"}],angular.forEach(c.category,function(t){this[t.key]=t},c.category),e.project.info({id:c.projectid},function(t){c.projectname=t.result.title,n.$current.parent.data.title="物业财务 - "+t.result.title}),c.paging={index:1,size:parseInt(localStorage.getItem(o)||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},c.list=function(){e.business.departmentconsumptiondetail({project:c.projectid,key:c.searchText||void 0,category:c.category.selected||void 0,from:c.startDate.replace(/\-/g,""),to:c.endDate.replace(/\-/g,""),pageindex:c.paging.index,pagesize:c.paging.size},function(t){t=t.result||{},angular.forEach(t.detail,function(t,e){Object.keys(t.earning&&t.earning.category).length||Object.keys(t.consumption&&t.consumption.category).length||(t.isnull=!0),t.key=e,this.push(t)},t.detail=[]),c.listData=t.detail,c.listData.index=(t.paging||{}).pageindex||1,c.listData.total=(t.paging||{}).count||0})},c.exportConsumptiondetail=function(){delete c.downloadFile,e["export"].consumptiondetail({project:c.projectid,from:c.startDate.replace(/\-/g,""),to:c.endDate.replace(/\-/g,"")},function(t){t.result.fn&&(c.downloadFile=t.result.fn,c.downloadName=c.projectname+"_"+n.$current.data.title+"_"+c.startDate.replace(/\-/g,"")+"_"+c.endDate.replace(/\-/g,""))})}}]);
//# sourceMappingURL=consume.min.js.map
