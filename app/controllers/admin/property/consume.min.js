angular.module("app").controller("Property.consume",["$scope","$api","$state",function(t,e,a){var n=this,i=EMAPP.Account._id+"_property_consume_pagesize";n.searchText="",n.startDate=moment().format("YYYY-MM-01"),n.endDate=moment().format("YYYY-MM-DD"),t.$watch(function(){return n.startDate},function(){n.listData&&n.list()}),t.$watch(function(){return n.endDate},function(){n.listData&&n.list()}),t.$watch(function(){return n.category.selected},function(){n.listData&&n.list()}),t.$watch(function(){return n.paging.index},function(){n.listData&&n.list()}),t.$watch(function(){return n.paging.size},function(t){localStorage.setItem(i,t),n.listData&&n.list()}),t.$watch("Project.selected",function(t){n.projectid=t._id,n.list()}),n.category=[{title:"全部类型"},{key:"PAYELECTRICITY",title:"电费"},{key:"PAYCOLDWATER",title:"冷水费"},{key:"PAYHOTWATER",title:"热水费"},{key:"PAYPROPERTY",title:"物业费"},{key:"PAYPARKING",title:"停车费"}],angular.forEach(n.category,function(t){this[t.key]=t},n.category),n.paging={index:1,size:parseInt(localStorage.getItem(i)||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},n.list=function(){e.business.departmentconsumptiondetail({project:n.projectid,key:n.searchText||void 0,category:n.category.selected||void 0,from:n.startDate.replace(/\-/g,""),to:n.endDate.replace(/\-/g,""),pageindex:n.paging.index,pagesize:n.paging.size},function(t){t=t.result||{},angular.forEach(t.detail,function(t,e){Object.keys(t.earning&&t.earning.category).length||Object.keys(t.consumption&&t.consumption.category).length||(t.isnull=!0),t.key=e,this.push(t)},t.detail=[]),n.listData=t.detail,n.listData.index=(t.paging||{}).pageindex||1,n.listData.total=(t.paging||{}).count||0})},n.exportConsumptiondetail=function(){delete n.downloadFile,e.export.consumptiondetail({project:n.projectid,from:n.startDate.replace(/\-/g,""),to:n.endDate.replace(/\-/g,"")},function(t){t.result.fn&&(n.downloadFile=t.result.fn,n.downloadName=n.projectname+"_"+a.$current.data.title+"_"+n.startDate.replace(/\-/g,"")+"_"+n.endDate.replace(/\-/g,""))})}}]);
//# sourceMappingURL=consume.min.js.map
