angular.module("app").controller("Property.record",["$scope","$api","$state","$stateParams",function(t,e,a,i){var n=this,o=EMAPP.Account._id+"_property_record_daterange",c=EMAPP.Account._id+"_property_record_pagesize";t.$watch(function(){return n.startDate},function(t){n.listData&&n.list()}),t.$watch(function(){return n.endDate},function(t){n.listData&&n.list()}),t.$watch(function(){return n.paging.index},function(){n.list()}),t.$watch(function(){return n.paging.size},function(t){localStorage.setItem(c,t),n.listData&&n.list()}),n.tab=i.tab||"all",n.projectid=i.projectid,n.startDate=moment().format("YYYY-MM-01"),n.endDate=moment().format("YYYY-MM-DD"),n.amount={},n.dateRange=["今天","昨天","最近7天","最近30天"],n.dateRange.selected=localStorage.getItem(o)||void 0,n.dateRange.selected&&(n.dateRange.selected=parseInt(n.dateRange.selected)),n.dateRange.select=function(t){n.dateRange.selected===t?(localStorage.removeItem(o),delete n.dateRange.selected):(localStorage.setItem(o,t),n.dateRange.selected=t),n.list()},n.status=[{title:"全部状态"},{key:"CHECKING",title:"等待审核","class":"primary"},{key:"CHECKFAILED",title:"审核失败","class":"warning"},{key:"PROCESSING",title:"正在处理","class":"info"},{key:"FAILED",title:"处理失败","class":"danger"},{key:"SUCCESS",title:"完成","class":"success"}],angular.forEach(n.status,function(t){this[t.key]={title:t.title,"class":t["class"]}},n.status),n.category=[{title:"全部类型"},{key:"RECHARGING",title:"充值"},{key:"WITHDRAW",title:"提现"},{key:"PAYFEES",title:"缴费"},{key:"HANDLINGCHARGE",title:"手续费"},{key:"HANDLINGCHARGERCG",title:"充值服务费"},{key:"HANDLINGCHARGEWTD",title:"提现服务费"},{key:"alipay",title:"支付宝手机支付"},{key:"wx",title:"微信支付"},{key:"wx_pub",title:"微信公众号支付"},{key:"bankcard",title:"银行卡支付"}],angular.forEach(n.category,function(t){this[t.key]=t},n.category),n.category.selected=i.category||void 0,e.project.info({id:n.projectid},function(t){n.projectname=t.result.title,a.$current.parent.data.title="物业财务 - "+t.result.title}),n.paging={index:1,size:parseInt(localStorage.getItem(c)||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},n.list=function(){var t={project:n.projectid||void 0,key:n.searchText||void 0,from:n.startDate.replace(/\-/g,""),to:n.endDate.replace(/\-/g,""),flow:{"in":"EARNING",out:"EXPENSE"}[n.tab],category:n.category.selected||void 0,status:n.status.selected||void 0,amount:[void 0===n.amount.start?null:parseFloat(n.amount.start),void 0===n.amount.end?null:parseFloat(n.amount.end)],pageindex:n.paging.index,pagesize:n.paging.size};if(void 0!==n.dateRange.selected)switch(n.dateRange.selected){case 0:t.from=t.to=moment().format("YYYYMMDD");break;case 1:t.from=t.to=moment().subtract(1,"day").format("YYYYMMDD");break;case 2:t.from=moment().subtract(7,"day").format("YYYYMMDD"),t.to=moment().format("YYYYMMDD");break;case 3:t.from=moment().subtract(30,"day").format("YYYYMMDD"),t.to=moment().format("YYYYMMDD")}e.business.fundflow(t,function(t){t=t.result||{},angular.forEach(t.detail,function(t){t.channelaccount&&t.channelaccount.account&&(t.channelaccount.tail=t.channelaccount.account.replace(/\d+(\d{4})$/,"$1")),t.timecreate=t.timecreate&&moment(1e3*t.timecreate).format("YYYY-M-DD H:mm:ss")||"",t.timecheck=t.timecheck&&moment(1e3*t.timecheck).format("YYYY-M-DD H:mm:ss")||"",t.timepaid=t.timepaid&&moment(1e3*t.timepaid).format("YYYY-M-DD H:mm:ss")||""}),n.listData=t.detail||[],n.listData.index=(t.paging||{}).pageindex||1,n.listData.total=(t.paging||{}).count||0,n.statistic=t.statistic||{}})}}]);