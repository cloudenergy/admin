EMAPP.register.controller("SensorSelect",["$scope","$rootScope","$modalInstance","API","Sensor","ProjectID","Config","DeviceType",function(e,n,o,i,r,s,c,t){var a;e.currentPage=1,e.Ok=function(){var n=!0;_.each(e.viewOfSensors,function(e){if(e.originEnable!=e.isEnable)if(e.isEnable&&e.devicetype!=t){n=!1;var s={_id:e._id,devicetype:t};console.log("Add: ",s),i.Query(r.update,s,function(e){e.err||o.close({})})}else{var s={_id:e._id,devicetype:t};console.log("Clear: ",s),i.Query(r.update,s,function(e){e.err||o.close({})})}}),n&&o.close({})},e.Cancel=function(){o.dismiss("cancel")},e.SwitchSensor=function(e,n){e.preventDefault(),n.isEnable?n.isEnable=!1:n.isEnable=!0},e.onSearchSensor=function(n){n.preventDefault(),e.UpdateViewOfSensors(e.sensorSearchKey)},e.OnSelectAll=function(o){o.preventDefault(),console.log(e.currentPage,n.popPageSize);for(var i=(e.currentPage-1)*n.popPageSize,r=e.currentPage*n.popPageSize,s=i;r>s;s++)e.viewOfSensors[s].isEnable=!0},e.UpdateViewOfSensors=function(n){e.viewOfSensors=[],n?_.each(a,function(o){o.title.match(n)?e.viewOfSensors.push(o):o.channel&&o.channel.match(n)?e.viewOfSensors.push(o):o.energyTitle&&o.energyTitle.match(n)&&e.viewOfSensors.push(o)}):e.viewOfSensors=a,_.each(e.viewOfSensors,function(e){e.originEnable=e.devicetype==t,e.isEnable=e.originEnable})},i.Query(r.channelinfo,{project:s},function(n){console.log(n),n.err||(a=n.result,e.UpdateViewOfSensors())})}]);