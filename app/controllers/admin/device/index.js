EMAPP.register.controller("DeviceIndex",["$scope","SettingMenu","$q","$modal","Energy","API","Auth","Project","UI","Device","base64","Sensor",function(e,t,n,r,c,i,o,l,s,u,p,a){var d={},f={},m="department.project";o.Check(function(){function c(t){var n=[];_.each(e.device,function(e){n.push({id:e.id,name:e.name,childrens:[],ischild:!1,level:1})}),e.viewOfDevice=[{nodes:n,title:"设备类型",level:0}],d={},f={},e.projectSelected=t}t(function(t){e.menu=t}),n.all([i.QueryPromise(l.info,{}).$promise,i.QueryPromise(u.type,{}).$promise]).then(function(t){if(t[0].err||t[1].err);else{e.projects=angular.isArray(t[0].result)?t[0].result:[t[0].result];var n=s.GetPageItem(m);n?(n=_.find(e.projects,function(e){return e._id==n}),e.projectSelected=n._id):e.projects.length>0&&(e.projectSelected=e.projects[0]._id),e.device=t[1].result}}),e.$watch("projectSelected",function(e){e&&(s.PutPageItem(m,e),c(e))}),e.sensor=function(t,n){console.log(t,n);var c=r.open({templateUrl:"sensorSelect.html",controller:"SensorSelect",size:"lg",resolve:{ProjectID:function(){return e.projectSelected},DeviceType:function(){return t.id}}});c.result.then(function(e){},function(){})},e.switchUnitPriceType=function(e){e.unitprice.isnormal=!e.unitprice.isnormal}})}]);