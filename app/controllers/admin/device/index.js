angular.module("app").controller("DeviceIndex",["$scope","SettingMenu","$q","$modal","Energy","API","Auth","Project","UI","Device","base64","Sensor",function(e,t,n,r,i,o,c,l,s,u,p,a){var f={},d={},m="department.project";c.Check(function(){function i(t){var n=[];_.each(e.device,function(e){n.push({id:e.id,name:e.name,childrens:[],ischild:!1,level:1})}),e.viewOfDevice=[{nodes:n,title:"设备类型",level:0}],f={},d={},e.projects.title=t}t(function(t){e.menu=t}),n.all([o.QueryPromise(l.info,{}).$promise,o.QueryPromise(u.type,{}).$promise]).then(function(t){if(t[0].err||t[1].err);else{e.projects=angular.isArray(t[0].result)?t[0].result:[t[0].result];var n=s.GetPageItem(m);n?(n=_.find(e.projects,function(e){return e._id==n}),e.projects.title=n._id):e.projects.length>0&&(e.projects.title=e.projects[0]._id),e.device=t[1].result}}),e.$watch("projects.title",function(e){e&&(s.PutPageItem(m,e),i(e))}),e.sensor=function(t,n){console.log(t,n);var i=r.open({templateUrl:"sensorSelect.html",controller:"SensorSelect",size:"lg",resolve:{ProjectID:function(){return e.projects.title},DeviceType:function(){return t.id}}});i.result.then(function(e){},function(){})},e.switchUnitPriceType=function(e){e.unitprice.isnormal=!e.unitprice.isnormal}})}]);