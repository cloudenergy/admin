EMAPP.register.controller("appidsecretedit",["$scope","$stateParams","$q","$cookies","$location","Account","AppIDSecret","API","Auth","UI","Character",function(e,r,t,c,a,i,s,n,p,o,d){p.Check(function(){e.submit=function(r){return e.character?(e.appidsecret.character=e.character._id,e.appidsecret.desc=e.appidsecret.desc,void n.Query(s.update,e.appidsecret,function(e){a.path("/admin/appidsecret/info")},function(e){e.code&&o.AlertError(e.message)})):void o.AlertError("请选择创建账户的权限级别")},t.all([n.QueryPromise(i.info,{id:c.user}).$promise,n.QueryPromise(s.info,{id:r.id}).$promise]).then(function(r){e.adminUser=r[0].result,e.appidsecret=r[1].result;var t=e.adminUser.character&&e.adminUser.character.level;n.Query(d.info,{power:t},function(r){r.err||(e.characters=r.result,e.level=e.appidsecret.character&&e.appidsecret.character.level,void 0==e.level?e.level=e.characters[e.characters.length-1]:e.character=_.find(e.characters,function(r){return r.level==e.level}))})}),e.onRefreshSecret=function(r){r.preventDefault(),n.Query(s.apply,{appid:e.appidsecret._id},function(r){r.err||(e.appidsecret.secret=r.result.appsecret)})}})}]);