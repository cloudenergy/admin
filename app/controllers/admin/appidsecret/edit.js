angular.module("app").controller("appidsecretedit",["$scope","$stateParams","$q","$cookies","$location","Account","AppIDSecret","API","Auth","UI","Character",function(e,r,c,t,a,i,n,p,s,o,d){s.Check(function(){e.submit=function(r){return e.character?(e.appidsecret.character=e.character._id,e.appidsecret.desc=e.appidsecret.desc,void p.Query(n.update,e.appidsecret,function(e){a.path("/admin/appidsecret/info")},function(e){e.code&&o.AlertError(e.message)})):void o.AlertError("请选择创建账户的权限级别")},c.all([p.QueryPromise(i.info,{id:t.user}).$promise,p.QueryPromise(n.info,{id:r.id}).$promise]).then(function(r){e.adminUser=r[0].result,e.appidsecret=r[1].result;var c=e.adminUser.character&&e.adminUser.character.level;p.Query(d.info,{power:c},function(r){r.err||(e.characters=r.result,e.level=e.appidsecret.character&&e.appidsecret.character.level,void 0==e.level?e.level=e.characters[e.characters.length-1]:e.character=_.find(e.characters,function(r){return r.level==e.level}))})}),e.onRefreshSecret=function(r){r.preventDefault(),p.Query(n.apply,{appid:e.appidsecret._id},function(r){r.err||(e.appidsecret.secret=r.result.appsecret)})}})}]);