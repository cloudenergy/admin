EMAPP.register.controller("SensorSelect",["$scope","$rootScope","$modalInstance","API","Sensor","ProjectID","Config","EnergycategoryID",function(e,n,o,r,i,a,s,t){var c;e.currentPage=1,e.Ok=function(){var n=r.RootEnergycategory(t),a=!0;_.each(e.viewOfSensors,function(e){if(e.originEnable!=e.isEnable)if(e.isEnable&&e.energyPath!=t){a=!1;var s={_id:e._id,energy:n,energyPath:t};console.log("Add: ",s),r.Query(i.update,s,function(e){e.err||o.close({})})}else{var s={_id:e._id,energy:"",energyPath:""};console.log("Clear: ",s),r.Query(i.update,s,function(e){e.err||o.close({})})}}),a&&o.close({})},e.Cancel=function(){o.dismiss("cancel")},e.SwitchSensor=function(e,n){e.preventDefault(),n.isEnable?n.isEnable=!1:n.isEnable=!0},e.onSearchSensor=function(n){n.preventDefault(),e.UpdateViewOfSensors(e.sensorSearchKey)},e.OnSelectAll=function(o){o.preventDefault(),console.log(e.currentPage,n.popPageSize);for(var r=(e.currentPage-1)*n.popPageSize,i=e.currentPage*n.popPageSize,a=r;i>a;a++)e.viewOfSensors[a].isEnable=!0},e.UpdateViewOfSensors=function(n){e.viewOfSensors=[],n?_.each(c,function(o){o.title.match(n)?e.viewOfSensors.push(o):o.channel&&o.channel.match(n)&&e.viewOfSensors.push(o)}):e.viewOfSensors=c,_.each(e.viewOfSensors,function(e){e.originEnable=e.energyPath==t,e.isEnable=e.originEnable})},r.Query(i.channelinfo,{project:a},function(n){console.log(n),n.err||(c=n.result,e.UpdateViewOfSensors())})}]);