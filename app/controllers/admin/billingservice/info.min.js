angular.module("app").controller("BillingServiceInfo",["$scope","$q","$stateParams","Energycategory","$location","Project","Account","API","Auth","$cookies","UI","Pab","BillingService","Config",function(e,t,r,n,o,i,c,s,u,a,l,g,f,v){e.operateStatus={add:{isEnable:!1,url:"/add"},"delete":{isEnable:!1,url:"/delete"},update:{isEnable:!1,url:"/update"}},e.askingRemoveID=void 0,e.PadShow=[],e.settingUserInfo=void 0,e.askingRemoveID=void 0,u.Check(e.operateStatus,function(){function r(t){s.Query(f.info,{project:t},function(t){t.err||(e.billingservices=t.result,_.each(e.billingservices,function(t){t.ecstring="",_.each(t.energycategory,function(r){var n=_.find(e.energycategory,function(e){return e._id==r});n&&(t.ecstring+=n.title+"ï¼Œ")}),t.ecstring=t.ecstring.substr(0,t.ecstring.length-1)}),console.log(e.billingservices))})}function o(e){l.AlertError(e.data.message)}e.onSearchAccount=function(r){r.preventDefault(),console.log(e.accountKey),s.Query(c.info,{user:e.accountKey},function(r){if(!r.err){var n=r.result;e.settingUserInfo=n;var o=n.resource&&n.resource.project||[];t.all([s.QueryPromise(i.info,"*"==o?{}:{ids:o}).$promise,s.QueryPromise(g.info,{account:e.accountKey}).$promise]).then(function(t){var r={};_.each(angular.isArray(t[0].result)?t[0].result:[t[0].result],function(e){r[e._id]={project:e,status:"UNBIND"}}),_.each(t[1].result,function(e){var t=r[e.project];t&&(t.status=e.status)}),_.each(r,function(t){e.PadShow.push(t)})})}})},t.all([s.QueryPromise(n.info,{}).$promise,s.QueryPromise(i.info,{}).$promise]).then(function(t){e.energycategory=t[0].result,e.projects=angular.isArray(t[1].result)?t[1].result:[t[1].result];var r=l.GetPageItem("billingservice.projectid",r);r?e.projects.title=r:e.projects.length>0&&(e.projects.title=e.projects[0]._id)}),e.$watch("projects.title",function(e){e&&(l.PutPageItem("billingservice.projectid",e),r(e))}),e.DoRemove=function(t,r,n){t.preventDefault();var i=l.GetAbsoluteIndex(e.currentPage,n);s.Query(f["delete"],{id:r},function(t){e.billingservices.splice(i,1)},o)},e.AskForRemove=function(t,r){t.preventDefault(),e.askingRemoveID=r},e.CancelRemove=function(t,r){t.preventDefault(),e.askingRemoveID=void 0}})}]);
//# sourceMappingURL=info.min.js.map
