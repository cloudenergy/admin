EMAPP.register.controller("SensorSelect",["$scope","$modalInstance","API","Sensor","ProjectID","SensorIDs","Config",function(e,n,s,i,o,r,c){var t;e.Ok=function(){var s=[],i=[];e.viewOfSensors[0].isEnable?s=e.viewOfSensors[0]._id:_.each(e.viewOfSensors,function(e){var n="";e.project&&(n=_.isObject(e.project)?e.project&&e.project._id+"."||"":e.project+"."||""),e.isEnable?s.push(n+e._id):i.push(n+e._id)}),n.close({select:s,unselect:i})},e.Cancel=function(){n.dismiss("cancel")},e.SwitchSensor=function(n,s){n.preventDefault(),"*"==s._id?(_.each(e.viewOfSensors,function(e){e.isEnable=!1}),s.isEnable=!s.isEnable):(e.viewOfSensors[0].isEnable=!1,s.isEnable=!s.isEnable)},e.onSearchSensor=function(n){n.preventDefault(),e.UpdateViewOfSensors(e.sensorSearchKey)},e.UpdateViewOfSensors=function(n){e.viewOfSensors=[{_id:"*",title:"所有传感器"}],n?_.each(t,function(s){s.title.match(n)&&e.viewOfSensors.push(s)}):e.viewOfSensors=_.union(e.viewOfSensors,t);var s=!1;_.each(e.viewOfSensors,function(e){_.contains(r,e._id)?(s=!0,e.isEnable=!0):e.isEnable=!1}),s||(e.viewOfSensors[0].isEnable=!0)};var a=[];_.each(r,function(e){a.push(e.replace(/.+\./g,""))}),r=a,s.Query(i.channelinfo,{project:o},function(n){n.err||(t=n.result,e.UpdateViewOfSensors())})}]);