EMAPP.register.controller("accountEdit",["$scope","$stateParams","$q","$cookies","$location","SettingMenu","Account","md5","API","Auth","UI","Character","Config",function(e,r,t,n,a,c,i,o,s,l,u,d,f){l.Check(function(){c(function(r){e.menu=r}),e.submit=function(r){var t={_id:e.account._id};if(e.newpasswd!=e.repeatnewpasswd)return void u.AlertError("二次密码输入不一致，请重新输入");if(e.newpasswd&&e.newpasswd.length){var n=o.createHash(e.newpasswd).toUpperCase();t.passwd=n}return e.level?(t.character=e.level._id,t.title=e.account.title,t.mobile=e.account.mobile,t.email=e.account.email,t.message=Object.keys(e.warning).filter(function(r){return e.warning[r]?r:""}).join(","),e.account.initpath&&(t.initpath=e.account.initpath),void s.Query(i.update,t,function(e){u.AlertSuccess("账户更新成功"),a.path("/admin/account/info")},function(e){e.code&&u.AlertError(e.message)})):void u.AlertError("请选择创建账户的权限级别")},t.all([s.QueryPromise(i.info,{id:n.get("user")}).$promise,s.QueryPromise(i.info,{id:r.id}).$promise]).then(function(r){e.adminUser=r[0].result,e.account=r[1].result;var t=e.account.message?e.account.message.split(","):[];e.warning={},angular.forEach(t,function(r,t){e.warning[r]=!0});var n=e.adminUser.character&&e.adminUser.character.level;s.Query(d.info,{power:n},function(r){r.code?u.AlertError(r.message):(e.characters=r.result,e.level=e.account.character&&e.account.character.level,void 0==e.level?e.level=e.characters[e.characters.length-1]:e.level=_.find(e.characters,function(r){return r.level==e.level}))})})})}]);