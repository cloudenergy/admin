angular.module("app").controller("accountEdit",["$scope","$stateParams","$q","$location","SettingMenu","Account","md5","API","Auth","UI","Character","Config",function(e,a,n,r,t,c,i,o,l,s,u,d){l.Check(function(){t(function(a){e.menu=a}),e.submit=function(a){var n={_id:e.account._id};if(e.newpasswd!=e.repeatnewpasswd)return void s.AlertError("二次密码输入不一致，请重新输入");if(e.newpasswd&&e.newpasswd.length){var t=i.createHash(e.newpasswd).toUpperCase();n.passwd=t}return e.level?(n.character=e.level._id,n.title=e.account.title,n.mobile=e.account.mobile,n.email=e.account.email,n.message=Object.keys(e.warning).filter(function(a){return e.warning[a]?a:""}).join(","),e.account.initpath&&(n.initpath=e.account.initpath),void o.Query(c.update,n,function(e){s.AlertSuccess("账户更新成功"),r.path("/admin/account/info")},function(e){e.code&&s.AlertError(e.message)})):void s.AlertError("请选择创建账户的权限级别")},n.all([o.QueryPromise(c.info,{id:EMAPP.Account._id}).$promise,o.QueryPromise(c.info,{id:a.id}).$promise]).then(function(a){e.adminUser=a[0].result,e.account=a[1].result;var n=e.account.message?e.account.message.split(","):[];e.warning={},angular.forEach(n,function(a,n){e.warning[a]=!0});var r=e.adminUser.character&&e.adminUser.character.level;o.Query(u.info,{power:r},function(a){a.code?s.AlertError(a.message):(e.characters=a.result,e.level=e.account.character&&e.account.character.level,void 0==e.level?e.level=e.characters[e.characters.length-1]:e.level=_.find(e.characters,function(a){return a.level==e.level}))})})})}]);