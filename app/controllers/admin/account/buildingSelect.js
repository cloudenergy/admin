angular.module("app").controller("BuildingSelect",["$scope","$modalInstance","API","Building","ProjectID","BuildingIDs",function(i,n,e,l,u,s){var a;if(i.Ok=function(){var e=[],l=[];i.viewOfBuildings[0].isEnable?e=i.viewOfBuildings[0]._id:_.each(i.viewOfBuildings,function(i){var n=i.project&&i.project._id+"."||"";i.isEnable?e.push(n+i._id):l.push(n+i._id)}),n.close({select:e,unselect:l})},i.Cancel=function(){n.dismiss("cancel")},i.SwitchBuilding=function(n,e){n.preventDefault(),"*"==e._id?(_.each(i.viewOfBuildings,function(i){i.isEnable=!1}),e.isEnable=!e.isEnable):(i.viewOfBuildings[0].isEnable=!1,e.isEnable=!e.isEnable)},i.onSearchProject=function(n){n.preventDefault(),i.UpdateViewOfBuildings(i.buildingSearchKey)},i.UpdateViewOfBuildings=function(n){i.viewOfBuildings=[{_id:"*",title:"所有建筑"}],n?_.each(a,function(e){e.title.match(n)&&i.viewOfBuildings.push(e)}):i.viewOfBuildings=_.union(i.viewOfBuildings,a);var e=!1;_.each(i.viewOfBuildings,function(i){_.contains(s,i._id)?(e=!0,i.isEnable=!0):i.isEnable=!1}),e||(i.viewOfBuildings[0].isEnable=!0)},s&&s.length){var c=[];_.each(s,function(i){c.push(i.replace(/.+\./g,""))}),s=c}e.Query(l.info,{project:u},function(n){n.err||(a=n.result,i.UpdateViewOfBuildings())})}]);