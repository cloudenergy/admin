EMAPP.register.controller("BuildingSelect",["$scope","$modalInstance","API","Building","ProjectID","BuildingIDs",function(i,e,n,l,s,u){var t;if(i.Ok=function(){var n=[],l=[];i.viewOfBuildings[0].isEnable?n=i.viewOfBuildings[0]._id:_.each(i.viewOfBuildings,function(i){var e=i.project&&i.project._id+"."||"";i.isEnable?n.push(e+i._id):l.push(e+i._id)}),e.close({select:n,unselect:l})},i.Cancel=function(){e.dismiss("cancel")},i.SwitchBuilding=function(e,n){e.preventDefault(),"*"==n._id?(_.each(i.viewOfBuildings,function(i){i.isEnable=!1}),n.isEnable=!n.isEnable):(i.viewOfBuildings[0].isEnable=!1,n.isEnable=!n.isEnable)},i.onSearchProject=function(e){e.preventDefault(),i.UpdateViewOfBuildings(i.buildingSearchKey)},i.UpdateViewOfBuildings=function(e){i.viewOfBuildings=[{_id:"*",title:"所有建筑"}],e?_.each(t,function(n){n.title.match(e)&&i.viewOfBuildings.push(n)}):i.viewOfBuildings=_.union(i.viewOfBuildings,t);var n=!1;_.each(i.viewOfBuildings,function(i){_.contains(u,i._id)?(n=!0,i.isEnable=!0):i.isEnable=!1}),n||(i.viewOfBuildings[0].isEnable=!0)},u&&u.length){var c=[];_.each(u,function(i){c.push(i.replace(/.+\./g,""))}),u=c}n.Query(l.info,{project:s},function(e){e.err||(t=e.result,i.UpdateViewOfBuildings())})}]);