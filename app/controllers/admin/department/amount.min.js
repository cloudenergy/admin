angular.module("app").controller("accountamount",["$scope","$stateParams","$api","Account","API","Auth","UI","BillingAccount","Log","Payment",function(n,e,c,t,o,r,a,u,i,l){n.AccountID=e.account,r.Check(function(){function e(){o.Query(t.info,{id:n.AccountID},function(e){e.err||(n.account=e.result,n.account.billingAccount.cash=Math.round(100*n.account.billingAccount.cash)/100,n.account.billingAccount.frozen=Math.round(100*n.account.billingAccount.frozen)/100,n.account.billingAccount.expire?(n.expire=moment(n.account.billingAccount.expire),n.expire=n.expire.format("YYYY年MM月DD日")):n.expire="无限制")})}function r(){o.Query(i.charge,{uid:n.AccountID,channel:"manual"},function(e){e.err||(n.chargeLog=e.result)})}c.payment.channelinfo({type:"manual",project:n.Project.selected._id,flow:"EARNING"},function(c){n.channels=c.result,e(),r()}),n.OnCharge=function(){if(!n.cash)return a.AlertWarning(" ","请输入充值金额");if(!n.channels.selected)return a.AlertWarning(" ","请选择充值方式");var c={uid:n.account._id,channel:"Manual",amount:parseFloat(n.cash),channelaccountid:n.channels.selected,project:n.Project.selected._id,subject:"商户项目充值",body:"充值项目: "+n.Project.selected.title,metadata:{operator:EMAPP.Account._id}};o.Query(l.charge,c,function(c){c.code?a.AlertError(" ","充值出错"):(e(),r(),n.cash=0,c.result.fn&&(n.downloadLink="/download/"+c.result.fn,window.open(n.downloadLink)))})},n.OnReverse=function(n){o.Query(l.reversal,{id:n._id,time:moment(n.timecreate).unix(),type:"CHARGE"},function(n){n.err?a.AlertError(" ","冲正出错: "+n.err.message):(e(),r())})},n.OnSaveAlerthreshold=function(){var e={account:n.account.billingAccount._id,alerthreshold:n.account.billingAccount.alerthreshold};o.Query(u.update,e,function(n){})}})}]);
//# sourceMappingURL=amount.min.js.map
