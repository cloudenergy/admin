angular.module("app").controller("departmentInfo",["$scope","$timeout","$uibModal","$api","Auth","UI",function(t,e,n,a,o,i){o.Check(t.operateStatus={create:{isEnable:!1,url:"/create"},"delete":{isEnable:!1,url:"/delete"},edit:{isEnable:!1,url:"/update"}},function(){var o=EMAPP.Account._id+".department.info.pagesize",l=EMAPP.Account._id+".department.info.status";t.statusenum=[{id:0,title:"全部"},{id:1,title:"正常"},{id:2,title:"欠费"}],t.statusenum.selected=parseInt(localStorage.getItem(l)||t.statusenum[0].id),t.paging={total:0,index:1,size:parseInt(localStorage.getItem(o)||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},t.GetDepartment=function(){t.listData&&t.listData.loading||(t.listData&&(t.listData.loading=!0),a.department.info({project:t.Project.selected._id,keyreg:t.departmentKey,amount:t.filterAmount?parseFloat(t.filterAmount):void 0,arrear:{1:!1,2:!0}[t.statusenum.selected],pageindex:t.paging.index,pagesize:t.paging.size},function(e){e=e.result||{},e.detail=angular.isArray(e.detail)&&e.detail||e.detail&&[e.detail]||[],angular.forEach(e.detail,function(t){t.account&&t.account.billingAccount&&(t.account.billingAccount.cash<0?t.status="欠费":t.status="正常"),t.sensorAll=[],angular.forEach(t.sensors,function(e){t.sensorAll.push(e.title+"\n"),e.status["switch"]={EMC_ON:!0,EMC_OFF:!1}[e.status["switch"]]||!0}),t.sensorAll=t.sensorAll.join("")}),t.listData=e.detail,t.listData.index=(e.paging||{}).pageindex||1,t.listData.total=(e.paging||{}).count||0}))},t.$watch("Project.selected",function(){t.paging.index=1,t.GetDepartment()}),t.$watch("statusenum.selected",function(e){localStorage.setItem(l,e),t.paging.index=1,t.listData&&t.GetDepartment()}),t.$watch("paging.index",function(e){t.listData&&t.GetDepartment()}),t.$watch("paging.size",function(n){localStorage.setItem(o,n),e(t.listData&&t.GetDepartment)}),t.DoRemove=function(e){a.department["delete"]({id:e},function(e){t.GetDepartment()},function(t){i.AlertError(" ",t.data.message)})},t.switchControl=function(t){n.open({size:"sm",templateUrl:"switch_control.html",controller:["$scope","$uibModalInstance","$api","md5",function(e,n,a,o){e.md5=o,e.OnSubmit=function(){a.control.send({id:t.sid,uid:EMAPP.Account._id,ctrlcode:o.createHash(e.password).toUpperCase(),command:"EMC_SWITCH",param:{mode:"EMC_OFF"}},function(t){t.code?i.AlertError(" ",t.message):n.close()})},e.OnCancel=n.dismiss}]}).result.then(function(){},function(){t.status["switch"]=!t.status["switch"]})},t.OnImportDepartment=function(){n.open({size:"sm",templateUrl:"import_department.html",controller:["$scope","$uibModalInstance","UI","ProjectID",function(t,e,n,a){t.actionURL="/api/import/importdepartment",t.Character="54d032dd877012ac6d37063f",t.ProjectID=a,t.OnCancel=e.dismiss,t.OnUploadComplete=function(t){t.code?n.AlertError(t.result||" ",t.message):(n.AlertSuccess("导入成功"),e.close())}}],resolve:{ProjectID:function(){return t.Project.selected._id}}}).result.then(t.GetDepartment)},t.OnBatchRecharge=function(){n.open({size:"sm",templateUrl:"batch_recharge.html",controller:["$scope","$uibModalInstance","UI","ProjectID",function(t,e,n,a){t.actionURL="/api/import/importbatchrecharge",t.ProjectID=a,t.OnCancel=e.dismiss,t.OnUploadComplete=function(a){a.code?n.AlertError(a.result||" ",a.message):(n.AlertSuccess("导入成功"),t.OnCancel=e.close,a.result.fn&&(t.downloadLink="/download/"+a.result.fn,window.open(t.downloadLink)))}}],resolve:{ProjectID:function(){return t.Project.selected._id}}}).result.then(t.GetDepartment)},t.OnExportAlertInfo=function(){}})}]);
//# sourceMappingURL=info.min.js.map
