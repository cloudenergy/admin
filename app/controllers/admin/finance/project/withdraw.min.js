angular.module("app").controller("Finance.project.withdraw",["$scope","$api","$filter","$state","$stateParams","$uibModal",function(t,a,e,c,n,o){var r=this;r.projectid=n.projectid,r.cardSelected=null,r.project=EMAPP.Project[r.projectid],c.$current.parent.data.title=r.project.title,a.business.accountbalance({project:r.projectid},function(t){r.accountbalance=t.result||{},r.accountbalance.total=Math.round(100*(r.accountbalance.cash+r.accountbalance.frozen))/100,r.accountbalance.cash=Math.round(100*r.accountbalance.cash)/100,r.accountbalance.frozen=Math.round(100*r.accountbalance.frozen)/100,r.accountbalance.earning=Math.round(100*r.accountbalance.earning)/100,r.accountbalance.withdraw=Math.round(100*r.accountbalance.withdraw)/100}),r.queryFee=function(){return r.amount&&(r.amount=Math.round(100*r.amount)/100),r.cardSelected&&r.amount?void a.payment.handlingcharge({channelaccount:r.cardSelected.id,amount:r.amount},function(t){var a=t.result;r.fee=a.PRJ}):!1},t.$watch(function(){return r.cardSelected},function(t){t&&r.queryFee()}),r.getCardList=function(){a.channelaccount.info({project:r.projectid,all:!0,flow:"EXPENSE",status:"SUCCESS"},function(t){r.cardData=t.result||[]})},r.getCardList(),r.inject=function(){o.open({templateUrl:"withdraw_request_confirmation.html",controllerAs:"self",controller:["$uibModalInstance","UI","data",function(t,a,e){this.submit=function(){t.close(this.detail)},this.cancel=function(){t.dismiss("cancel")},this.detail=e,this.detail.timecreate=moment().unix(),this.detail.applicant=EMAPP.Account._id}],resolve:{data:function(){return{card:r.cardSelected,amount:r.amount,fee:r.fee,project:r.projectid}}},size:"md"}).result.then(function(t){a.withdraw.apply({project:t.project,amount:t.amount,channelaccount:t.card.id},function(t){0==t.code?(swal("成功","已提交成功","success"),c.go(c.current.name,{projectid:r.projectid},{reload:!0})):swal("错误",t.message,"error")})})}}]);
//# sourceMappingURL=withdraw.min.js.map
