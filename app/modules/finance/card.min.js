"use strict";angular.module("app").controller("Finance.card",["$scope","$filter","$timeout","$api","$q","uiGridConstants",function(e,t,n,a,l,i){var r=this;r.paneHeight=90.01,r.status=[{key:"CHECKING",title:"等待审核"},{key:"FAILED",title:"审核失败"},{key:"SUCCESS",title:"审核通过"}],angular.forEach(r.status,function(e){this[e.key]=e.title},r.status),r.filter=function(){r.gridOptions.enableFiltering=!r.gridOptions.enableFiltering,r.gridApi.core.notifyDataChange(i.dataChange.COLUMN)},r.export=function(){r.gridOptions.exporterCsvFilename="平台财务_银行卡管理.csv",r.gridApi.exporter.csvExport("visible","visible",angular.element(document.querySelectorAll(".subContent")))},r.list=function(i){if(!(i&&r.gridOptions.paging&&r.gridOptions.paging.count<=r.gridOptions.paging.pageindex*r.gridOptions.paging.pagesize))return a.channelaccount.info({all:1,flow:"EXPENSE",pageindex:(i&&r.gridOptions.paging?r.gridOptions.paging.pageindex:0)+1,pagesize:100},function(e){return e=e.result,angular.forEach(e.detail,function(e){e.timecreate=e.timecreate&&t("date")(1e3*e.timecreate,"yyyy-M-dd H:mm:ss")||""}),i?r.gridOptions.data=r.gridOptions.data.concat(e.detail||[]):(r.gridOptions.data=e.detail||[],r.gridOptions.data.length&&n(function(){r.gridApi.core.scrollTo(r.gridOptions.data[0],r.gridOptions.columnDefs[0])})),angular.forEach(r.gridOptions.data,function(e){e.locate&&angular.isString(e.locate)&&(angular.forEach(JSON.parse(e.locate),function(e,i){this.push(e)},e.locate=[]),e.locate=e.locate.join("-"))}),r.gridOptions.paging=e.paging,n(function(){r.paneHeight=90}),r.gridApi.grid.element.height("auto"),e}).$promise},r.list(),r.gridOptions={onRegisterApi:function(a){a.infiniteScroll.on.needLoadMoreData(e,function(){function e(){a.infiniteScroll.dataLoaded(),t.reject()}var i,t=l.defer(),n=t.resolve;return(i=r.list(!0))?i.then(function(){a.infiniteScroll.saveScrollPercentage(),a.infiniteScroll.dataLoaded(!1,!0).then(n,e)},e):e(),t.promise}),r.gridApi=a},infiniteScrollDown:!0,enableColumnResizing:!0,exporterOlderExcelCompatibility:!0,exporterFieldCallback:function(e,i,t,n){return/status/.test(t.field)&&(n=r.status[n]||""),0===n?0:'="'+(n||"")+'"'},columnDefs:[{displayName:"",name:"$index",type:"number",width:50,minWidth:50,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"项目名称",name:"project",width:"*",minWidth:120,enableColumnMenu:!1},{displayName:"银行卡号",name:"account",width:"*",minWidth:180,enableColumnMenu:!1},{displayName:"开户银行",name:"origin",width:"*",minWidth:120,enableColumnMenu:!1},{displayName:"支行名称",name:"subbranch",width:"*",minWidth:120,enableColumnMenu:!1},{displayName:"账户归属",name:"locate",width:"*",minWidth:220,enableColumnMenu:!1},{displayName:"申请状态",name:"status",width:"*",minWidth:120,enableColumnMenu:!1,cellTemplate:"<div class=\"ui-grid-cell-contents\" ng-class=\"{'text-primary':COL_FIELD==='CHECKING','text-success':COL_FIELD==='SUCCESS','text-danger':COL_FIELD==='FAILED'}\" ng-bind=\"grid.appScope.self.status[COL_FIELD]\"></div>"},{displayName:"申请时间",name:"timecreate",width:"*",minWidth:130},{displayName:"操作",name:"operation",width:"*",minWidth:80,enableColumnMenu:!1,exporterSuppressExport:!0,cellTemplate:"<div class=\"ui-grid-cell-contents text-primary\"><a ui-sref=\"admin.finance.card.detail({id:row.entity.id})\">{{{true:'审核',false:'查看详情'}[row.entity.status==='CHECKING']}}</a></div>"}]}}]);