"use strict";angular.module("app").controller("Finance.project.list",["$filter","$api","uiGridConstants","$uibModal","$scope","$timeout",function(e,a,t,i,r,n){var s=this;s.paneHeight=90,s.searchText="",s.filter=function(){s.gridOptions.enableFiltering=!s.gridOptions.enableFiltering,s.gridApi.core.notifyDataChange(t.dataChange.COLUMN)},s.export=function(){s.gridOptions.exporterCsvFilename="平台财务_项目列表.csv",s.gridApi.exporter.csvExport("visible","visible",angular.element(document.querySelectorAll(".subContent")))},s.list=function(){a.project.info({titlereg:s.searchText||void 0},function(e){s.gridOptions.data=angular.isArray(e.result)?e.result:[e.result],s.gridApi.grid.element.height("auto")})},s.list(),s.setPayProperty=function(e){i.open({size:"lg",templateUrl:"payproperty.html",controllerAs:"self",controller:["$api","$uibModalInstance",function(a,t){var i=this;i.showSet="baseinfo",i.setPaymentParams={},i.setPaymentParams.withdraw={},i.setPaymentParams.withdraw.cards=[],a.pltfinance.billinginfo({projectid:e._id},function(t){i.showSet="baseinfo",i.setPaymentParams=t.result,i.setPaymentParams.projectid=e._id,!i.setPaymentParams.withdraw&&(i.setPaymentParams.withdraw={}),!i.setPaymentParams.withdraw.cards&&(i.setPaymentParams.withdraw.cards=[]),!i.setPaymentParams.alipay&&(i.setPaymentParams.alipay={}),!i.setPaymentParams.wx&&(i.setPaymentParams.wx={}),!i.setPaymentParams.wx_pub&&(i.setPaymentParams.wx_pub={}),!i.setPaymentParams&&i.setPaymentParams.thirdpartbill,i.setPaymentParams.alipay.flow="PLT",i.setPaymentParams.wx.flow="PLT",i.setPaymentParams.wx_pub.flow="PLT",i.setPaymentParams.withdraw.minwithdraw&&1e3!=i.setPaymentParams.withdraw.minwithdraw&&2e3!=i.setPaymentParams.withdraw.minwithdraw&&5e3!=i.setPaymentParams.withdraw.minwithdraw&&(i.minwithdrawdef=!0),i.setPaymentParams.withdraw.servicecharge&&0!=i.setPaymentParams.withdraw.servicecharge&&10!=i.setPaymentParams.withdraw.servicecharge&&15!=i.setPaymentParams.withdraw.servicecharge&&20!=i.setPaymentParams.withdraw.servicecharge&&30!=i.setPaymentParams.withdraw.servicecharge&&50!=i.setPaymentParams.withdraw.servicecharge&&(i.servicechargedef=!0),a.bank.info(function(e){i.bankData=e.result,angular.forEach(i.setPaymentParams.withdraw.cards,function(e){e.locate=angular.isString(e.locate)&&JSON.parse(e.locate||null)||e.locate||{province:"浙江省",city:"杭州市",district:"西湖区"},angular.forEach(i.bankData,$.proxy(function(a){i.bankData[a.id]=a,e.origin===a.title&&(e.origin=a.id)},i))})})}),i.addCard=function(e){n(e.unshift({id:"",name:"",idcard:"",origin:"",subbranch:"",locate:{province:"浙江省",city:"杭州市",district:"江干区"}}))},i.deleteCard=function(e){n(i.setPaymentParams.withdraw.cards.splice(e,1))},i.ok=function(){a.pltfinance.billingupdate(i.setPaymentParams),t.dismiss("cancel")},i.cancel=function(){t.dismiss("cancel")}}]})},s.gridOptions={onRegisterApi:function(e){s.gridApi=e},enableColumnResizing:!0,exporterOlderExcelCompatibility:!0,exporterFieldCallback:function(e,a,t,i){return 0===i?0:'="'+(i||"")+'"'},columnDefs:[{displayName:"",name:"$index",type:"number",width:50,minWidth:50,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"项目名称",name:"title",width:"*",minWidth:120,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents text-primary"><a ng-click="grid.appScope.self.setPayProperty(row.entity)" ng-bind="COL_FIELD"></a></div>'},{displayName:"项目余额 ¥",name:"billingAccount.cash",width:"*",minWidth:120,enableColumnMenu:!1},{displayName:"",name:"view",width:"*",minWidth:100,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">查看记录</div>',cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents text-primary"><a ui-sref="admin.finance.project.info.record({tab:\'in\',projectid:row.entity._id})">收入记录</a><a class="ml20" ui-sref="admin.finance.project.info.record({tab:\'out\',projectid:row.entity._id})">提现记录</a></div>'},{displayName:"",name:"operation",width:"*",minWidth:220,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">操作</div>',cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents text-primary"><a ui-sref="admin.finance.project.info({projectid:row.entity._id})">管理支付属性</a><a class="ml20" ui-sref="admin.finance.project.info.withdraw({projectid:row.entity._id})">转账</a></div>'}]}}]);