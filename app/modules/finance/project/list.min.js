"use strict";angular.module("app").controller("Finance.project.list",["$filter","$api","uiGridConstants","$uibModal","$scope","$timeout",function(e,a,t,r,i,n){var s=this;s.paneHeight=90,s.searchText="",s.filter=function(){s.gridOptions.enableFiltering=!s.gridOptions.enableFiltering,s.gridApi.core.notifyDataChange(t.dataChange.COLUMN)},s.export=function(){s.gridOptions.exporterCsvFilename="平台财务_项目列表.csv",s.gridApi.exporter.csvExport("visible","visible",angular.element(document.querySelectorAll(".subContent")))},s.list=function(){a.project.info({titlereg:s.searchText||void 0},function(e){s.gridOptions.data=angular.isArray(e.result)?e.result:[e.result],s.gridApi.grid.element.height("auto")})},s.list(),s.setPayProperty=function(i){r.open({size:"lg",templateUrl:"payproperty.html",controllerAs:"self",controller:["$api","$uibModalInstance",function(a,e){var t=this;t.showSet="baseinfo",a.pltfinance.billinginfo({projectid:i._id},function(e){t.setPaymentParams=e.result,t.setPaymentParams.projectid=i._id,t.setPaymentParams.withdraw||(t.setPaymentParams.withdraw={}),t.setPaymentParams.withdraw.cards.length||(t.setPaymentParams.withdraw.cards=[{id:void 0,name:void 0,account:void 0,origin:void 0,subbranch:void 0,locate:{province:void 0,city:void 0,district:void 0}}]),t.setPaymentParams.alipay||(t.setPaymentParams.alipay={}),t.setPaymentParams.wx||(t.setPaymentParams.wx={}),t.setPaymentParams.wx_pub||(t.setPaymentParams.wx_pub={}),t.setPaymentParams||t.setPaymentParams.thirdpartbill,t.setPaymentParams.alipay.flow="PLT",t.setPaymentParams.wx.flow="PLT",t.setPaymentParams.wx_pub.flow="PLT",t.setPaymentParams.withdraw.minwithdraw&&1e3!=t.setPaymentParams.withdraw.minwithdraw&&2e3!=t.setPaymentParams.withdraw.minwithdraw&&5e3!=t.setPaymentParams.withdraw.minwithdraw&&(t.minwithdrawdef=!0),t.setPaymentParams.withdraw.frozenday&&1!=t.setPaymentParams.withdraw.frozenday&&3!=t.setPaymentParams.withdraw.frozenday&&7!=t.setPaymentParams.withdraw.frozenday&&31!=t.setPaymentParams.withdraw.frozenday&&(t.frozendaydef=!0),t.setPaymentParams.withdraw.servicecharge&&0!=t.setPaymentParams.withdraw.servicecharge&&10!=t.setPaymentParams.withdraw.servicecharge&&15!=t.setPaymentParams.withdraw.servicecharge&&20!=t.setPaymentParams.withdraw.servicecharge&&30!=t.setPaymentParams.withdraw.servicecharge&&50!=t.setPaymentParams.withdraw.servicecharge&&(t.servicechargedef=!0),a.bank.info(function(e){t.bankData=e.result,angular.forEach(t.setPaymentParams.withdraw.cards,function(a){a.locate=angular.isString(a.locate)&&JSON.parse(a.locate||null)||a.locate||{province:void 0,city:void 0,district:void 0},angular.forEach(t.bankData,$.proxy(function(e){t.bankData[e.id]=e,a.origin===e.title&&(a.origin=e.id)},t))})})}),t.addCard=function(e){n(e.push({id:void 0,name:void 0,account:void 0,origin:void 0,subbranch:void 0,locate:{province:void 0,city:void 0,district:void 0}}))},t.deleteCard=function(e,a){n(e.splice(a,1)),0==e.length&&e.push({id:void 0,name:void 0,account:void 0,origin:void 0,subbranch:void 0,locate:{province:void 0,city:void 0,district:void 0}})},t.ok=function(){angular.forEach(t.setPaymentParams.withdraw.cards,function(e){e.id||e.name||e.account||e.origin||e.subbranch||delete e.locate}),a.pltfinance.billingupdate(t.setPaymentParams),e.dismiss("cancel")},t.cancel=function(){e.dismiss("cancel")}}]})},s.gridOptions={onRegisterApi:function(e){s.gridApi=e},enableColumnResizing:!0,exporterOlderExcelCompatibility:!0,exporterFieldCallback:function(e,a,t,i){return 0===i?0:'="'+(i||"")+'"'},columnDefs:[{displayName:"",name:"$index",type:"number",width:50,minWidth:50,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"项目名称",name:"title",width:"*",minWidth:120,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents text-primary"><a ng-click="grid.appScope.self.setPayProperty(row.entity)" ng-bind="COL_FIELD"></a></div>'},{displayName:"项目余额 ¥",name:"billingAccount.cash",width:"*",minWidth:120,enableColumnMenu:!1},{displayName:"",name:"view",width:"*",minWidth:100,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">查看记录</div>',cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents text-primary"><a ui-sref="admin.finance.project.info.record({tab:\'in\',projectid:row.entity._id})">收入记录</a><a class="ml20" ui-sref="admin.finance.project.info.record({tab:\'out\',projectid:row.entity._id})">提现记录</a></div>'},{displayName:"",name:"operation",width:"*",minWidth:220,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">操作</div>',cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents text-primary"><a ng-click="grid.appScope.self.setPayProperty(row.entity)">管理支付属性</a><a class="ml20" ui-sref="admin.finance.project.info.withdraw({projectid:row.entity._id})">转账</a></div>'}]}}]);