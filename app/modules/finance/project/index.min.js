"use strict";angular.module("app").controller("Finance.project.index",["$api","$state","$stateParams","$uibModal",function(t,a,c,n){var o=this;o.projectid=c.projectid,o.getCardList=function(){t.channelaccount.info({project:o.projectid,all:!0,flow:"EXPENSE"},function(t){o.cardData=t.result})},o.getCard=function(a){t.bank.info(function(t){n.open({templateUrl:"modal-finance-project-card.html",controllerAs:"self",controller:["$api","$uibModalInstance",function(c,n){this.bankData=t.result,this.card=a||{},this.card.locate=angular.isString(this.card.locate)&&JSON.parse(this.card.locate||null)||this.card.locate||{province:"浙江省",city:"杭州市",district:"西湖区"},angular.forEach(this.bankData,$.proxy(function(t){this.bankData[t.id]=t,this.card.origin===t.title&&(this.card.origin=t.id)},this)),this.submit=function(){c.channelaccount.add({id:this.card.id||void 0,flow:this.card.flow||"EXPENSE",belongto:this.card.belongto?void 0:o.projectid,name:this.card.name,account:this.card.account,origin:this.bankData[this.card.origin].title,subbranch:this.card.subbranch,locate:this.card.locate},n.close)},this.cancel=function(){n.dismiss("cancel")}}]}).result.then(o.getCardList)})},o.removeCard=function(a){swal({title:"确认删除此项吗？",text:"卡号："+a.account,type:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确认",confirmButtonColor:"#ec6c62"},function(){t.channelaccount.delete({id:a.id},o.getCardList)})},o.project=EMAPP.Project[o.projectid],a.$current.data.title=o.project.title,o.getCardList(),t.business.accountbalance({project:o.projectid},function(t){o.accountbalance=t.result,o.accountbalance.total=Math.round(100*(o.accountbalance.cash+o.accountbalance.frozen))/100,o.accountbalance.cash=Math.round(100*o.accountbalance.cash)/100,o.accountbalance.frozen=Math.round(100*o.accountbalance.frozen)/100,o.accountbalance.earning=Math.round(100*o.accountbalance.earning)/100,o.accountbalance.withdraw=Math.round(100*o.accountbalance.withdraw)/100})}]);