"use strict";angular.module("app").controller("Finance.project.index",["$rootScope","$filter","$api","$state","$stateParams","$uibModal","EFUNDFLOW",function(t,a,c,n,e,o,i){var r=this;r.projectid=e.projectid,r.efundflow=i,c.pltfinance.billinginfo({projectid:r.projectid},function(t){console.log(t),t=t.result,r.epayment=t.epayment,r.payment=t.payment,r.prepayment=t.prepayment,r.thirdpartbill=t.thirdpartbill,r.efundflow.selected=t.efundflow||"PLT",r.withdraw=t.withdraw,r.EWP=t.EWP,r.ZFT=t.ZFT}),c.channelaccount.info({project:r.projectid,all:!0,flow:"EXPENSE"},function(t){r.cardData=t.result}),r.save=function(t,a){var n={projectid:r.projectid};n[t]=a,c.pltfinance.billingupdate(n,function(t){console.log(t)})},r.getCardList=function(){c.channelaccount.info({project:r.projectid,all:!0,flow:"EXPENSE"},function(t){r.cardData=t.result})},r.getCard=function(t){c.bank.info(function(a){o.open({templateUrl:"modal-finance-project-card.html",controllerAs:"self",controller:["$api","$uibModalInstance",function(c,n){this.bankData=a.result,this.card=t||{},this.card.locate=angular.isString(this.card.locate)&&JSON.parse(this.card.locate||null)||this.card.locate||{province:"浙江省",city:"杭州市",district:"西湖区"},console.log(this.card),angular.forEach(this.bankData,$.proxy(function(t){this.bankData[t.id]=t,this.card.origin===t.title&&(this.card.origin=t.id)},this)),this.submit=function(){c.channelaccount.add({id:this.card.id||void 0,flow:this.card.flow||"EXPENSE",belongto:this.card.belongto?void 0:r.projectid,name:this.card.name,account:this.card.account,origin:this.bankData[this.card.origin].title,subbranch:this.card.subbranch,locate:this.card.locate},n.close)},this.cancel=function(){n.dismiss("cancel")}}]}).result.then(r.getCardList)})},r.removeCard=function(t){swal({title:"确认删除此项吗？",text:"卡号："+t.account,type:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确认",confirmButtonColor:"#ec6c62"}).then(function(){c.channelaccount.delete({id:t.id},r.getCardList)})},r.project=t.Project[r.projectid],n.$current.data.title=r.project.title,r.getCardList(),c.business.accountbalance({project:r.projectid},function(t){r.accountbalance=t.result,r.accountbalance.total=a("number")(r.accountbalance.cash+r.accountbalance.frozen,2).replace(/\,/g,""),r.accountbalance.cash=a("number")(r.accountbalance.cash,2).replace(/\,/g,""),r.accountbalance.frozen=a("number")(r.accountbalance.frozen,2).replace(/\,/g,""),r.accountbalance.earning=a("number")(r.accountbalance.earning,2).replace(/\,/g,""),r.accountbalance.withdraw=a("number")(r.accountbalance.withdraw,2).replace(/\,/g,"")})}]);