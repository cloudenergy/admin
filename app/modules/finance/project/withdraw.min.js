"use strict";angular.module("app").controller("Finance.project.withdraw",["$rootScope","$scope","$filter","$api","$state","$stateParams","$uibModal","SweetAlert",function(e,t,a,c,n,o,r,l){var u=this;u.projectid=o.projectid,u.cardSelected=null,u.project=e.Project[u.projectid],n.$current.parent.data.title=u.project.title,c.business.accountbalance({project:u.projectid},function(e){u.accountbalance=e.result,u.accountbalance.total=a("number")(u.accountbalance.cash+u.accountbalance.frozen,2).replace(/\,/g,""),u.accountbalance.cash=a("number")(u.accountbalance.cash,2).replace(/\,/g,""),u.accountbalance.frozen=a("number")(u.accountbalance.frozen,2).replace(/\,/g,""),u.accountbalance.earning=a("number")(u.accountbalance.earning,2).replace(/\,/g,""),u.accountbalance.withdraw=a("number")(u.accountbalance.withdraw,2).replace(/\,/g,"")}),u.queryFee=function(){u.amount&&(u.amount=parseFloat(a("number")(1*u.amount,2).replace(/\,/g,""))),u.cardSelected&&u.amount&&c.payment.handlingcharge({channelaccount:u.cardSelected.id,amount:u.amount},function(e){u.fee=e.result.PRJ})},t.$watch("self.cardSelected",function(e){e&&u.queryFee()}),u.getCardList=function(){c.channelaccount.info({project:u.projectid,all:!0,flow:"EXPENSE",status:"SUCCESS"},function(e){u.cardData=e.result})},u.getCardList(),u.inject=function(){r.open({templateUrl:"withdraw_request_confirmation.html",controllerAs:"self",controller:["$uibModalInstance","data",function(t,a){this.submit=function(){t.close(this.detail)},this.cancel=function(){t.dismiss("cancel")},this.detail=a,this.detail.timecreate=moment().unix(),this.detail.applicant=e.Account._id}],resolve:{data:function(){return{card:u.cardSelected,amount:u.amount,fee:u.fee,project:u.projectid}}},size:"md"}).result.then(function(e){c.withdraw.apply({project:e.project,amount:e.amount,channelaccount:e.card.id},function(){l.success("已提交成功"),n.go(n.current.name,{projectid:u.projectid},{reload:!0})},l.error)})}}]);