"use strict";angular.module("app").controller("Finance.project.withdraw",["$scope","$filter","$api","$state","$stateParams","$uibModal","UI",function(t,e,n,c,a,o,r){var u=this;u.projectid=a.projectid,u.cardSelected=null,u.project=EMAPP.Project[u.projectid],c.$current.parent.data.title=u.project.title,n.business.accountbalance({project:u.projectid},function(t){u.accountbalance=t.result,u.accountbalance.total=e("number")(u.accountbalance.cash+u.accountbalance.frozen,2),u.accountbalance.cash=e("number")(u.accountbalance.cash,2),u.accountbalance.frozen=e("number")(u.accountbalance.frozen,2),u.accountbalance.earning=e("number")(u.accountbalance.earning,2),u.accountbalance.withdraw=e("number")(u.accountbalance.withdraw,2)}),u.queryFee=function(){return u.amount&&(u.amount=e("number")(1*u.amount,2)),!(!u.cardSelected||!u.amount)&&void n.payment.handlingcharge({channelaccount:u.cardSelected.id,amount:u.amount},function(t){u.fee=t.result.PRJ})},t.$watch(function(){return u.cardSelected},function(t){t&&u.queryFee()}),u.getCardList=function(){n.channelaccount.info({project:u.projectid,all:!0,flow:"EXPENSE",status:"SUCCESS"},function(t){u.cardData=t.result})},u.getCardList(),u.inject=function(){o.open({templateUrl:"withdraw_request_confirmation.html",controllerAs:"self",controller:["$uibModalInstance","data",function(t,e){this.submit=function(){t.close(this.detail)},this.cancel=function(){t.dismiss("cancel")},this.detail=e,this.detail.timecreate=moment().unix(),this.detail.applicant=EMAPP.Account._id}],resolve:{data:function(){return{card:u.cardSelected,amount:u.amount,fee:u.fee,project:u.projectid}}},size:"md"}).result.then(function(t){n.withdraw.apply({project:t.project,amount:t.amount,channelaccount:t.card.id},function(){r.AlertSuccess("已提交成功"),c.go(c.current.name,{projectid:u.projectid},{reload:!0})},function(t){r.AlertError(t.message)})})}}]);