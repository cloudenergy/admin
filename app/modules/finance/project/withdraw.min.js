"use strict";angular.module("app").controller("Finance.project.withdraw",["$rootScope","$scope","$filter","$api","$state","$stateParams","$uibModal","UI",function(t,e,c,n,a,o,r,u){var i=this;i.projectid=o.projectid,i.cardSelected=null,i.project=t.Project[i.projectid],a.$current.parent.data.title=i.project.title,n.business.accountbalance({project:i.projectid},function(t){i.accountbalance=t.result,i.accountbalance.total=c("number")(i.accountbalance.cash+i.accountbalance.frozen,2),i.accountbalance.cash=c("number")(i.accountbalance.cash,2),i.accountbalance.frozen=c("number")(i.accountbalance.frozen,2),i.accountbalance.earning=c("number")(i.accountbalance.earning,2),i.accountbalance.withdraw=c("number")(i.accountbalance.withdraw,2)}),i.queryFee=function(){return i.amount&&(i.amount=c("number")(1*i.amount,2)),!(!i.cardSelected||!i.amount)&&void n.payment.handlingcharge({channelaccount:i.cardSelected.id,amount:i.amount},function(t){i.fee=t.result.PRJ})},e.$watch(function(){return i.cardSelected},function(t){t&&i.queryFee()}),i.getCardList=function(){n.channelaccount.info({project:i.projectid,all:!0,flow:"EXPENSE",status:"SUCCESS"},function(t){i.cardData=t.result})},i.getCardList(),i.inject=function(){r.open({templateUrl:"withdraw_request_confirmation.html",controllerAs:"self",controller:["$uibModalInstance","data",function(e,c){this.submit=function(){e.close(this.detail)},this.cancel=function(){e.dismiss("cancel")},this.detail=c,this.detail.timecreate=moment().unix(),this.detail.applicant=t.Account._id}],resolve:{data:function(){return{card:i.cardSelected,amount:i.amount,fee:i.fee,project:i.projectid}}},size:"md"}).result.then(function(t){n.withdraw.apply({project:t.project,amount:t.amount,channelaccount:t.card.id},function(){u.AlertSuccess("已提交成功"),a.go(a.current.name,{projectid:i.projectid},{reload:!0})},function(t){u.AlertError(t.message)})})}}]);