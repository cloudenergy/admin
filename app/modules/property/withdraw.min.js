"use strict";angular.module("app").controller("Property.withdraw",["$rootScope","$scope","$filter","$api","$timeout","$uibModal","SweetAlert",function(e,a,t,c,n,o,l){function u(){c.business.accountbalance({project:e.Project.selected._id},function(e){i.accountbalance=e.result,i.accountbalance.total=t("number")(i.accountbalance.cash+i.accountbalance.frozen,2).replace(/\,/g,""),i.accountbalance.cash=t("number")(i.accountbalance.cash,2).replace(/\,/g,""),i.accountbalance.frozen=t("number")(i.accountbalance.frozen,2).replace(/\,/g,""),i.accountbalance.earning=t("number")(i.accountbalance.earning,2).replace(/\,/g,""),i.accountbalance.withdraw=t("number")(i.accountbalance.withdraw,2).replace(/\,/g,"")},function(){delete i.accountbalance}),c.channelaccount.info({project:e.Project.selected._id,all:!0,flow:"EXPENSE",status:"SUCCESS"},function(e){i.cardData=e.result},function(){delete i.cardData})}var r,i=this;i.cardSelected=null,i.calAmount=function(){r&&n.cancel(r),r=n(function(){i.amount=i.amount&&t("number")(1*i.amount,2).replace(/\,/g,"")||i.amount},666)},i.inject=function(){i.amount&&(i.amount=parseFloat(t("number")(1*i.amount,2).replace(/\,/g,""))),i.cardSelected&&i.amount&&c.payment.handlingcharge({channelaccount:i.cardSelected.id,amount:i.amount},function(a){i.fee=a.result.amount,o.open({templateUrl:"withdraw_request_confirmation.html",controllerAs:"self",controller:["$uibModalInstance","data",function(a,t){this.submit=function(){a.close(this.detail)},this.cancel=function(){a.dismiss("cancel")},this.detail=t,this.detail.timecreate=moment().unix(),this.detail.applicant=e.Account._id}],resolve:{data:function(){return{card:i.cardSelected,amount:i.amount,fee:i.fee,project:e.Project.selected._id}}},size:"md"}).result.then(function(e){c.withdraw.apply({project:e.project,amount:e.amount,channelaccount:e.card.id},function(){delete i.amount,delete i.cardSelected,l.success("已提交成功"),u()},l.error)})})},u()}]);