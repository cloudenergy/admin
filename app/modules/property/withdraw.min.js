"use strict";angular.module("app").controller("Property.withdraw",["$rootScope","$scope","$filter","$api","$timeout","$uibModal","UI",function(t,e,n,c,a,o,u){function l(){c.business.accountbalance({project:t.Project.selected._id},function(t){i.accountbalance=t.result,i.accountbalance.total=n("number")(i.accountbalance.cash+i.accountbalance.frozen,2),i.accountbalance.cash=n("number")(i.accountbalance.cash,2),i.accountbalance.frozen=n("number")(i.accountbalance.frozen,2),i.accountbalance.earning=n("number")(i.accountbalance.earning,2),i.accountbalance.withdraw=n("number")(i.accountbalance.withdraw,2)}),c.channelaccount.info({project:t.Project.selected._id,all:!0,flow:"EXPENSE",status:"SUCCESS"},function(t){i.cardData=t.result})}var r,i=this;i.cardSelected=null,i.calAmount=function(){r&&a.cancel(r),r=a(function(){i.amount=i.amount&&n("number")(1*i.amount,2)||i.amount},666)},i.inject=function(){return i.amount&&(i.amount=n("number")(1*i.amount,2)),!(!i.cardSelected||!i.amount)&&void c.payment.handlingcharge({channelaccount:i.cardSelected.id,amount:i.amount},function(e){i.fee=e.result.amount,o.open({templateUrl:"withdraw_request_confirmation.html",controllerAs:"self",controller:["$uibModalInstance","data",function(e,n){this.submit=function(){e.close(this.detail)},this.cancel=function(){e.dismiss("cancel")},this.detail=n,this.detail.timecreate=moment().unix(),this.detail.applicant=t.Account._id}],resolve:{data:function(){return{card:i.cardSelected,amount:i.amount,fee:i.fee,project:t.Project.selected._id}}},size:"md"}).result.then(function(t){c.withdraw.apply({project:t.project,amount:t.amount,channelaccount:t.card.id},function(){delete i.amount,delete i.cardSelected,u.AlertSuccess("已提交成功"),l()},u.AlertError)})})},e.$watch("$root.Project.selected",l)}]);