"use strict";angular.module("app").controller("Property.withdraw",["$rootScope","$scope","$filter","$api","$timeout","$uibModal","SweetAlert",function(t,e,a,c,n,o,l){var u,r=this;function i(){c.business.accountbalance({project:t.Project.selected._id},function(e){r.accountbalance=e.result,r.accountbalance.total=a("number")(r.accountbalance.cash+r.accountbalance.frozen,2).replace(/\,/g,""),r.accountbalance.cash=a("number")(r.accountbalance.cash,2).replace(/\,/g,""),r.accountbalance.frozen=a("number")(r.accountbalance.frozen,2).replace(/\,/g,""),r.accountbalance.earning=a("number")(r.accountbalance.earning,2).replace(/\,/g,""),r.accountbalance.withdraw=a("number")(r.accountbalance.withdraw,2).replace(/\,/g,"")},function(){delete r.accountbalance}),c.channelaccount.info({project:t.Project.selected._id,all:!0,flow:"EXPENSE",status:"SUCCESS"},function(e){r.cardData=e.result},function(){delete r.cardData})}r.cardSelected=null,r.calAmount=function(){u&&n.cancel(u),u=n(function(){r.amount=r.amount&&a("number")(1*r.amount,2).replace(/\,/g,"")||r.amount},666)},r.inject=function(){r.amount&&(r.amount=parseFloat(a("number")(1*r.amount,2).replace(/\,/g,""))),r.cardSelected&&r.amount&&c.payment.handlingcharge({channelaccount:r.cardSelected.id,amount:r.amount},function(e){r.fee=e.result.amount,o.open({templateUrl:"withdraw_request_confirmation.html",controllerAs:"self",controller:["$uibModalInstance","data",function(e,a){this.submit=function(){e.close(this.detail)},this.cancel=function(){e.dismiss("cancel")},this.detail=a,this.detail.timecreate=moment().unix(),this.detail.applicant=t.Account._id}],resolve:{data:function(){return{card:r.cardSelected,amount:r.amount,fee:r.fee,project:t.Project.selected._id}}},size:"md"}).result.then(function(e){c.withdraw.apply({project:e.project,amount:e.amount,channelaccount:e.card.id},function(){delete r.amount,delete r.cardSelected,l.success("已提交成功"),i()},l.error)})})},i()}]);