"use strict";angular.module("app").controller("Property.consume",["$rootScope","$scope","$api","$state","$localStorage",function(t,e,a,i,n){function o(){a.business.departmentconsumptionstatistic({project:s.projectid,from:s.startDate.replace(/\-/g,""),to:s.endDate.replace(/\-/g,"")},function(t){s.statistic=t.result,angular.forEach(s.statistic.consumption.category,function(t,e){this.push(angular.extend(t,{category:e}))},s.statistic.consumption.category=[])},function(){delete s.statistic})}var s=this;s.searchText="",s.startDate=moment().format("YYYY-MM-01"),s.endDate=moment().format("YYYY-MM-DD"),e.$watchGroup(["self.startDate","self.endDate"],function(){s.listData&&(o(),s.list())}),e.$watch("self.category.selected",function(){s.listData&&(o(),s.list())}),e.$watch("self.paging.index",function(){s.listData&&s.list()}),e.$watch("self.paging.size",function(t){n.property_consume_pagesize=t,s.listData&&s.list()}),s.projectid=t.Project.selected._id,s.category=[{title:"全部类型"},{key:"PAYELECTRICITY",title:"电费"},{key:"PAYCOLDWATER",title:"冷水费"},{key:"PAYHOTWATER",title:"热水费"},{key:"PAYPROPERTY",title:"物业费"},{key:"PAYPARKING",title:"停车费"}],angular.forEach(s.category,function(t){this[t.key]=t},s.category),s.paging={index:1,size:parseInt(n.property_consume_pagesize||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},s.list=function(){a.business.departmentconsumptiondetail({project:s.projectid,key:s.searchText||void 0,category:s.category.selected||void 0,from:s.startDate.replace(/\-/g,""),to:s.endDate.replace(/\-/g,""),pageindex:s.paging.index,pagesize:s.paging.size},function(t){t=t.result,angular.forEach(t.detail,function(t,e){Object.keys(t.earning&&t.earning.category).length||Object.keys(t.consumption&&t.consumption.category).length||(t.isnull=!0),t.key=e,this.push(t)},t.detail=[]),s.listData=t.detail,s.listData.index=(t.paging||{}).pageindex||1,s.listData.total=(t.paging||{}).count||0},function(){delete s.listData})},s.exportConsumptiondetail=function(){delete s.downloadFile,a.export.consumptiondetail({project:s.projectid,from:s.startDate.replace(/\-/g,""),to:s.endDate.replace(/\-/g,"")},function(e){e.result.fn&&(s.downloadFile=e.result.fn,s.downloadName=t.Project.selected.title+"_"+i.$current.data.title+"_"+s.startDate.replace(/\-/g,"")+"_"+s.endDate.replace(/\-/g,""))})},o(),s.list()}]);