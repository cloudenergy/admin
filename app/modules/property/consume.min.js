"use strict";angular.module("app").controller("Property.consume",["$rootScope","$scope","$api","$state",function(t,e,a,i){function n(){a.business.departmentconsumptionstatistic({project:o.projectid,from:o.startDate.replace(/\-/g,""),to:o.endDate.replace(/\-/g,"")},function(t){o.statistic=t.result,angular.forEach(o.statistic.consumption.category,function(t,e){this.push(angular.extend(t,{category:e}))},o.statistic.consumption.category=[])},function(){delete o.statistic})}var o=this;o.searchText="",o.startDate=moment(new Date).subtract(30,"days").format("YYYY-MM-DD"),o.endDate=moment(new Date).format("YYYY-MM-DD"),e.$watchGroup(["self.startDate","self.endDate"],function(){o.listData&&(n(),o.list())}),e.$watch("self.category.selected",function(){o.listData&&(n(),o.list())}),e.$watch("self.paging.index",function(){o.listData&&o.list()}),e.$watch("self.paging.size",function(t){angular.isDefined(t)&&(localStorage.property_consume_pagesize=t),o.listData&&o.list()}),o.projectid=t.Project.selected._id,o.category=[{title:"全部类型"},{key:"PAYELECTRICITY",title:"电费"},{key:"PAYCOLDWATER",title:"冷水费"},{key:"PAYHOTWATER",title:"热水费"},{key:"PAYPROPERTY",title:"物业费"},{key:"PAYPARKING",title:"停车费"}],angular.forEach(o.category,function(t){this[t.key]=t},o.category),o.paging={index:1,size:parseInt(localStorage.property_consume_pagesize||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},o.list=function(){a.business.departmentconsumptiondetail({project:o.projectid,key:o.searchText||void 0,category:o.category.selected||void 0,from:o.startDate.replace(/\-/g,""),to:o.endDate.replace(/\-/g,""),pageindex:o.paging.index,pagesize:o.paging.size},function(t){t=t.result,angular.forEach(t.detail,function(t,e){Object.keys(t.earning&&t.earning.category).length||Object.keys(t.consumption&&t.consumption.category).length||(t.isnull=!0),t.key=e,this.push(t)},t.detail=[]),o.listData=t.detail,o.listData.index=(t.paging||{}).pageindex||1,o.listData.total=(t.paging||{}).count||0},function(){delete o.listData})},o.exportConsumptiondetail=function(){delete o.downloadFile,a.export.consumptiondetail({project:o.projectid,from:o.startDate.replace(/\-/g,""),to:o.endDate.replace(/\-/g,"")},function(e){e.result.fn&&(o.downloadFile=e.result.fn,o.downloadName=t.Project.selected.title+"_"+i.$current.data.title+"_"+o.startDate.replace(/\-/g,"")+"_"+o.endDate.replace(/\-/g,""))})},n(),o.list()}]);