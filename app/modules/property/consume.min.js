"use strict";angular.module("app").controller("Property.consume",["$rootScope","$scope","$api","$state","$localStorage",function(t,e,a,i,n){function o(){a.business.departmentconsumptionstatistic({project:c.projectid,from:c.startDate.replace(/\-/g,""),to:c.endDate.replace(/\-/g,"")},function(t){c.statistic=t.result,angular.forEach(c.statistic.consumption.category,function(t,e){this.push(angular.extend(t,{category:e}))},c.statistic.consumption.category=[])},function(){delete c.statistic})}var c=this;c.searchText="",c.startDate=moment().format("YYYY-MM-01"),c.endDate=moment().format("YYYY-MM-DD"),e.$watchGroup(["self.startDate","self.endDate"],function(){c.listData&&(o(),c.list())}),e.$watch("self.category.selected",function(){c.listData&&(o(),c.list())}),e.$watch("self.paging.index",function(){c.listData&&c.list()}),e.$watch("self.paging.size",function(t){n.property_consume_pagesize=t,c.listData&&c.list()}),e.$watch("$root.Project.selected",function(t){c.projectid=t._id,o(),c.list()}),c.category=[{title:"全部类型"},{key:"PAYELECTRICITY",title:"电费"},{key:"PAYCOLDWATER",title:"冷水费"},{key:"PAYHOTWATER",title:"热水费"},{key:"PAYPROPERTY",title:"物业费"},{key:"PAYPARKING",title:"停车费"}],angular.forEach(c.category,function(t){this[t.key]=t},c.category),c.paging={index:1,size:parseInt(n.property_consume_pagesize||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},c.list=function(){a.business.departmentconsumptiondetail({project:c.projectid,key:c.searchText||void 0,category:c.category.selected||void 0,from:c.startDate.replace(/\-/g,""),to:c.endDate.replace(/\-/g,""),pageindex:c.paging.index,pagesize:c.paging.size},function(t){t=t.result,angular.forEach(t.detail,function(t,e){Object.keys(t.earning&&t.earning.category).length||Object.keys(t.consumption&&t.consumption.category).length||(t.isnull=!0),t.key=e,this.push(t)},t.detail=[]),c.listData=t.detail,c.listData.index=(t.paging||{}).pageindex||1,c.listData.total=(t.paging||{}).count||0},function(){delete c.listData})},c.exportConsumptiondetail=function(){delete c.downloadFile,a.export.consumptiondetail({project:c.projectid,from:c.startDate.replace(/\-/g,""),to:c.endDate.replace(/\-/g,"")},function(e){e.result.fn&&(c.downloadFile=e.result.fn,c.downloadName=t.Project.selected.title+"_"+i.$current.data.title+"_"+c.startDate.replace(/\-/g,"")+"_"+c.endDate.replace(/\-/g,""))})}}]);