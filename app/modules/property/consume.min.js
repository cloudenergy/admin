"use strict";angular.module("app").controller("Property.consume",["$rootScope","$scope","$api","$state",function(e,t,a,i){var n=this,o="property_consume_pagesize";function s(){a.business.departmentconsumptionstatistic({project:n.projectid,from:n.startDate.replace(/\-/g,""),to:n.endDate.replace(/\-/g,"")},function(t){n.statistic=t.result,angular.forEach(n.statistic.consumption.category,function(t,e){this.push(angular.extend(t,{category:e}))},n.statistic.consumption.category=[])},function(){delete n.statistic})}n.searchText="",n.startDate=moment().subtract(30,"days").format("YYYY-MM-DD"),n.endDate=moment().format("YYYY-MM-DD"),t.$watchGroup(["self.startDate","self.endDate"],function(){n.listData&&(s(),n.list())}),t.$watch("self.category.selected",function(){n.listData&&(s(),n.list())}),t.$watch("self.paging.index",function(){n.listData&&n.list()}),t.$watch("self.paging.size",function(t){angular.isDefined(t)&&(localStorage[o]=t),n.listData&&n.list()}),n.projectid=e.Project.selected._id,n.category=[{title:"全部类型"},{key:"PAYELECTRICITY",title:"电费"},{key:"PAYCOLDWATER",title:"冷水费"},{key:"PAYHOTWATER",title:"热水费"},{key:"PAYPROPERTY",title:"物业费"},{key:"PAYPARKING",title:"停车费"}],angular.forEach(n.category,function(t){this[t.key]=t},n.category),n.paging={index:1,size:parseInt(localStorage[o]||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},n.list=function(){a.business.departmentconsumptiondetail({project:n.projectid,key:n.searchText||void 0,category:n.category.selected||void 0,from:n.startDate.replace(/\-/g,""),to:n.endDate.replace(/\-/g,""),pageindex:n.paging.index,pagesize:n.paging.size},function(t){t=t.result,angular.forEach(t.detail,function(t,e){Object.keys(t.earning&&t.earning.category).length||Object.keys(t.consumption&&t.consumption.category).length||(t.isnull=!0),t.key=e,this.push(t)},t.detail=[]),n.listData=t.detail,n.listData.index=(t.paging||{}).pageindex||1,n.listData.total=(t.paging||{}).count||0},function(){delete n.listData})},n.exportConsumptiondetail=function(){delete n.downloadFile,a.export.consumptiondetail({project:n.projectid,from:n.startDate.replace(/\-/g,""),to:n.endDate.replace(/\-/g,"")},function(t){t.result.fn&&(n.downloadFile=t.result.fn,n.downloadName=e.Project.selected.title+"_"+i.$current.data.title+"_"+n.startDate.replace(/\-/g,"")+"_"+n.endDate.replace(/\-/g,""))})},s(),n.list()}]);