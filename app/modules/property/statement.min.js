"use strict";angular.module("app").controller("Property.statement",["$rootScope","$scope","$api","$state","$stateParams",function(t,e,i,l,n){var a=this,o="property_statement_pagesize";a.tab=n.tab||"daily",a.format="daily"===a.tab?"YYYY-MM":"YYYY",a.viewDate=moment().format(a.format),e.$watch(function(){return a.viewDate},function(){a.listData&&a.list()}),e.$watch(function(){return a.paging.index},function(){a.listData&&a.list()}),e.$watch(function(){return a.paging.size},function(t){localStorage.setItem(o,t),a.listData&&a.list()}),e.$watch("$root.Project.selected",function(t){a.projectid=t._id,a.list()}),a.paging={index:1,size:parseInt(localStorage.getItem(o)||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},a.list=function(){i.business[a.tab+"fundsummary"]({project:a.projectid,time:a.viewDate.replace(/\-/g,""),pageindex:a.paging.index,pagesize:a.paging.size},function(t){t=t.result,angular.forEach(t.detail,function(t){Object.keys(t.earning).length||Object.keys(t.expenses).length||Object.keys(t.projectbalance).length||Object.keys(t.consumption).length||Object.keys(t.departmentbalance).length||(t.isnull=!0)}),a.listData=t.detail||[],a.listData.index=(t.paging||{}).pageindex||1,a.listData.total=(t.paging||{}).count||0})},a.exportBill=function(e){delete e.downloadFileBill,"daily"===a.tab?i.export.projectdailybill({project:a.projectid,time:e.time},function(i){i.result.fn&&(e.downloadFileBill=i.result.fn,e.downloadNameBill=t.Project.selected.title+"_"+l.$current.data.title+"_日账单_"+e.time)}):i.export.projectmonthlybill({project:a.projectid,time:e.time},function(i){i.result.fn&&(e.downloadFileBill=i.result.fn,e.downloadNameBill=t.Project.selected.title+"_"+l.$current.data.title+"_月账单_"+e.time)})},a.exportReceipt=function(e){delete e.downloadFileReceipt,"daily"===a.tab?i.export.projectdailyreceipt({project:a.projectid,time:e.time},function(i){i.result.fn&&(e.downloadFileReceipt=i.result.fn,e.downloadNameReceipt=t.Project.selected.title+"_"+l.$current.data.title+"_日回单_"+e.time)}):i.export.projectmonthlyreceipt({project:a.projectid,time:e.time},function(i){i.result.fn&&(e.downloadFileReceipt=i.result.fn,e.downloadNameReceipt=t.Project.selected.title+"_"+l.$current.data.title+"_月回单_"+e.time)})}}]);