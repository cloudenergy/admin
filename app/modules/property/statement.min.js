"use strict";angular.module("app").controller("Property.statement",["$rootScope","$scope","$api","$state","$stateParams",function(i,t,l,a,e){var n=this,o="property_statement_pagesize";n.tab=e.tab||"daily",n.format="daily"===n.tab?"YYYY-MM":"YYYY",n.viewDate=moment().format(n.format),t.$watch(function(){return n.viewDate},function(){n.listData&&n.list()}),t.$watch(function(){return n.paging.index},function(){n.listData&&n.list()}),t.$watch(function(){return n.paging.size},function(t){angular.isDefined(t)&&(localStorage[o]=t),n.listData&&n.list()}),n.projectid=i.Project.selected._id,n.paging={index:1,size:parseInt(localStorage[o]||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},n.list=function(){l.business[n.tab+"fundsummary"]({project:n.projectid,time:n.viewDate.replace(/\-/g,""),pageindex:n.paging.index,pagesize:n.paging.size},function(t){t=t.result,angular.forEach(t.detail,function(t){Object.keys(t.earning).length||Object.keys(t.expenses).length||Object.keys(t.projectbalance).length||Object.keys(t.consumption).length||Object.keys(t.departmentbalance).length||(t.isnull=!0)}),n.listData=t.detail||[],n.listData.index=(t.paging||{}).pageindex||1,n.listData.total=(t.paging||{}).count||0},function(){delete n.listData})},n.exportBill=function(e){delete e.downloadFileBill,"daily"===n.tab?l.export.projectdailybill({project:n.projectid,time:e.time},function(t){t.result.fn&&(e.downloadFileBill=t.result.fn,e.downloadNameBill=i.Project.selected.title+"_"+a.$current.data.title+"_日账单_"+e.time)}):l.export.projectmonthlybill({project:n.projectid,time:e.time},function(t){t.result.fn&&(e.downloadFileBill=t.result.fn,e.downloadNameBill=i.Project.selected.title+"_"+a.$current.data.title+"_月账单_"+e.time)})},n.exportReceipt=function(e){delete e.downloadFileReceipt,"daily"===n.tab?l.export.projectdailyreceipt({project:n.projectid,time:e.time},function(t){t.result.fn&&(e.downloadFileReceipt=t.result.fn,e.downloadNameReceipt=i.Project.selected.title+"_"+a.$current.data.title+"_日回单_"+e.time)}):l.export.projectmonthlyreceipt({project:n.projectid,time:e.time},function(t){t.result.fn&&(e.downloadFileReceipt=t.result.fn,e.downloadNameReceipt=i.Project.selected.title+"_"+a.$current.data.title+"_月回单_"+e.time)})},n.list()}]);