"use strict";angular.module("app").controller("Property.record",["$rootScope","$scope","$timeout","$localStorage","$api","$state","$stateParams",function(t,e,a,n,o,c,i){function l(){return{project:t.Project.selected._id,key:s.searchText||void 0,from:s.startDate.replace(/\-/g,""),to:s.endDate.replace(/\-/g,""),flow:{in:"EARNING",out:"EXPENSE"}[s.tab],category:s.category.selected||void 0,status:s.status.selected||void 0,groupby:"all"===s.tab&&"order"||void 0,amount:[void 0===s.amount.start?null:parseFloat(s.amount.start),void 0===s.amount.end?null:parseFloat(s.amount.end)]}}var s=this,r=[{key:"CHECKING",title:"等待审核",class:"primary"},{key:"CHECKFAILED",title:"审核失败",class:"warning"},{key:"PROCESSING",title:"正在处理",class:"info"},{key:"FAILED",title:"处理失败",class:"danger"},{key:"SUCCESS",title:"完成",class:"success"}],d=[{key:"RECHARGING",title:"充值"},{key:"alipay",title:"支付宝手机支付"},{key:"wx",title:"微信支付"},{key:"wx_pub",title:"微信公众号支付"},{key:"bankcard",title:"银行卡支付"},{key:"manual",title:"人工充值"}],m=[{key:"WITHDRAW",title:"提现"},{key:"HANDLINGCHARGERCG",title:"充值服务费"},{key:"HANDLINGCHARGEWTD",title:"提现服务费"}];e.$watchGroup(["self.startDate","self.endDate"],function(){s.dateRange.temp?a(function(){delete s.dateRange.temp},10):delete s.dateRange.selected,s.listData&&s.list()}),e.$watch("self.paging.index",function(){s.listData&&s.list()}),e.$watch("self.paging.size",function(t){n.property_record_pagesize=t,s.listData&&s.list()}),e.$watch("$root.Project.selected",function(){s.list()}),s.tab=i.tab||"all",s.startDate=i.startDate||moment().format("YYYY-MM-01"),s.endDate=i.endDate||moment().format("YYYY-MM-DD"),s.amount={},s.dateRange=["今天","昨天","最近7天","最近30天"],s.dateRange.selected=i.dateRange&&parseInt(i.dateRange)||void 0,s.dateRange.temp=!!i.dateRange,s.dateRange.select=function(t){switch(s.dateRange.temp=!0,s.dateRange.selected=t){case 0:s.startDate=s.endDate=moment().format("YYYY-MM-DD");break;case 1:s.startDate=s.endDate=moment().subtract(1,"days").format("YYYY-MM-DD");break;case 2:s.startDate=moment().subtract(7,"days").format("YYYY-MM-DD"),s.endDate=moment().format("YYYY-MM-DD");break;case 3:s.startDate=moment().subtract(30,"days").format("YYYY-MM-DD"),s.endDate=moment().format("YYYY-MM-DD")}},s.status=[{title:"全部状态"}].concat(r),angular.forEach(s.status,function(t){this[t.key]={title:t.title,class:t.class}},s.status),s.category=[{title:"全部类型"}],"in"===s.tab&&(s.category=s.category.concat(d)),"out"===s.tab&&(s.category=s.category.concat(m)),"all"===s.tab&&(s.category=s.category.concat(d),s.category=s.category.concat(m)),angular.forEach(s.category,function(t){this[t.key]=t},s.category),s.category.selected=i.category||void 0,s.paging={index:1,size:parseInt(n.property_record_pagesize||10),items:[{key:10,title:"每页10条"},{key:15,title:"每页15条"},{key:30,title:"每页30条"},{key:50,title:"每页50条"},{key:100,title:"每页100条"}]},s.list=function(){o.business.fundflow(angular.extend(l(),{pageindex:s.paging.index,pagesize:s.paging.size}),function(t){t=t.result,angular.forEach(t.detail,function(t){t.channelaccount&&t.channelaccount.account&&(t.channelaccount.tail=t.channelaccount.account.replace(/\d+(\d{4})$/,"$1")),t.timecreate=t.timecreate&&moment(1e3*t.timecreate).format("YYYY-M-DD H:mm:ss")||"",t.timecheck=t.timecheck&&moment(1e3*t.timecheck).format("YYYY-M-DD H:mm:ss")||"",t.timepaid=t.timepaid&&moment(1e3*t.timepaid).format("YYYY-M-DD H:mm:ss")||""}),s.listData=t.detail||[],s.listData.index=(t.paging||{}).pageindex||1,s.listData.total=(t.paging||{}).count||0,s.statistic=t.statistic||{}},function(){delete s.listData,delete s.statistic})},s.exportProjectflow=function(){delete s.downloadFile,o.export.projectflow(angular.extend(l(),{type:{all:"ALL",in:"EARNING",out:"EXPENSES"}[s.tab]}),function(e){if(e.result.fn){var a=l();s.downloadFile=e.result.fn,s.downloadName=t.Project.selected.title+"_"+c.$current.data.title+"_"+a.from+"_"+a.to}})}}]);