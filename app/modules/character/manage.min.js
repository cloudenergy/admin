"use strict";angular.module("app").controller("characterManage",["$scope","$stateParams","$state","$api","$cookies","$q","Auth","UI",function(e,n,r,t,c,a,o,i){var u={},s=n.id;o.Check(function(){function n(){var n=a.defer(),r=function(e){var n=function(e,r){_.map(e,function(e,t){e.leaf?u[r+"/"+t]=!0:n(e,"/"==t?"":r+"/"+t)})};n(e,"")};return s?t.character.info({id:s},function(t){t.err?n.reject(t.err):(e.character=t.result,r(t.result.rule),n.resolve())}):n.resolve(),n.promise}e.OnSave=function(){var n=[];!function e(r,t){"/"!=r._id&&(t+=r._id),r.select&&n.push(t),void 0!=r.nodes&&r.nodes.length>0&&_.each(r.nodes,function(n){e(n,t+"/")})}(e.urlpath[0],"");var c={};_.each(n,function(e){var n=e.split("/"),r=c;_.each(n,function(e,t){""==e&&(e="/");var c=!1;t==n.length-1&&(c=!0),r[e]||(r[e]={}),r[e].leaf=c,r=r[e]})}),e.character.rule=c,s?t.character.update(e.character,function(e){return e.code?void i.AlertError(e.message):void r.go("admin.character.info")}):t.character.add(e.character,function(e){return e.code?void i.AlertError(e.message):void r.go("admin.character.info")})},n().then(function(){t.urlpath.info(function(n){if(n.err);else{var r={_id:"/",nodes:[]};_.each(n.result,function(e){var n=e._id.split("/"),t=r;_.each(n,function(r,c){if(""!=r){var a=n.length==c+1,o=_.find(t.nodes,function(e){return e._id==r});void 0==o&&(a?(o={_id:r,url:e,desc:e.desc||"",enable:e.enable,select:!1,nodes:[]},o.select=!!u[e._id]):o={_id:r,desc:e.desc||"",select:!1,nodes:[]},t.nodes.push(o)),t=o}})}),e.urlpath=[r]}})}),e.enable=function(e){e.select=!e.select},e.toggle=function(e){e.toggle()},e.EnableSubNode=function(e,n){var r=function(e){e&&_.each(e.nodes,function(e){return e.select=n,r(e)})};r(e)}})}]);