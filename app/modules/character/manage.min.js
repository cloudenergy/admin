"use strict";angular.module("app").controller("characterManage",["$scope","$stateParams","$state","$api","$q","Auth","UI",function(e,n,t,c,a,r,o){var i={},u=n.id;r.Check(function(){function n(){var n=a.defer(),t=function(e){var n=function(e,t){_.map(e,function(e,c){e.leaf?i[t+"/"+c]=!0:n(e,"/"==c?"":t+"/"+c)})};n(e,"")};return u?c.character.info({id:u},function(c){e.character=c.result,t(e.character.rule),n.resolve()},function(e){n.reject(e.code)}):n.resolve(),n.promise}e.OnSave=function(){var n=[];!function e(t,c){"/"!=t._id&&(c+=t._id),t.select&&n.push(c),void 0!=t.nodes&&t.nodes.length>0&&_.each(t.nodes,function(n){e(n,c+"/")})}(e.urlpath[0],"");var a={};_.each(n,function(e){var n=e.split("/"),t=a;_.each(n,function(e,c){""==e&&(e="/");var a=!1;c==n.length-1&&(a=!0),t[e]||(t[e]={}),t[e].leaf=a,t=t[e]})}),e.character.rule=a,c.character[u?"update":"add"](e.character,function(){t.go("admin.character.info")},function(e){o.AlertError(e.message)})},n().then(function(){c.urlpath.info(function(n){var t={_id:"/",nodes:[]};_.each(n.result,function(e){var n=e._id.split("/"),c=t;_.each(n,function(t,a){if(""!=t){var r=n.length==a+1,o=_.find(c.nodes,function(e){return e._id==t});void 0==o&&(r?(o={_id:t,url:e,desc:e.desc||"",enable:e.enable,select:!1,nodes:[]},o.select=!!i[e._id]):o={_id:t,desc:e.desc||"",select:!1,nodes:[]},c.nodes.push(o)),c=o}})}),e.urlpath=[t]})}),e.enable=function(e){e.select=!e.select},e.toggle=function(e){e.toggle()},e.EnableSubNode=function(e,n){var t=function(e){e&&_.each(e.nodes,function(e){return e.select=n,t(e)})};t(e)}})}]);