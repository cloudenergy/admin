"use strict";angular.module("app").component("characterManage",{templateUrl:"app/modules/character/manage.html?rev=0a6b5cdba9",controller:["$q","$state","$stateParams","$api","SweetAlert",function(n,a,e,t,c){var o=this,l={},u=e.id,r=n.defer();u?t.character.info({id:u},function(n){o.character=n.result,function(n){!function a(n,r){_.map(n,function(n,e){n.leaf?l[r+"/"+e]=!0:a(n,"/"==e?"":r+"/"+e)})}(n,"")}(o.character.rule),r.resolve()}):r.resolve(),r.promise.then(function(){t.urlpath.info(function(n){var e={_id:"/",nodes:[]};angular.forEach(n.result,function(t){var c=t._id.split("/"),o=e;angular.forEach(c,function(e,n){if(e){var a=c.length==n+1,r=_.find(o.nodes,function(n){return n._id==e});null==r&&(a?(r={_id:e,url:t,desc:t.desc||"",enable:t.enable,select:!1,nodes:[]}).select=!!l[t._id]:r={_id:e,desc:t.desc||"",select:!1,nodes:[]},o.nodes.push(r)),o=r}})}),o.urlpath=[e]})}),o.EnableSubNode=function(n,a){!function e(n){n&&angular.forEach(n.nodes,function(n){n.select=a,e(n)})}(n)},o.OnSave=function(){var r=[],e={};!function e(n,a){"/"!=n._id&&(a+=n._id),n.select&&r.push(a),null!=n.nodes&&0<n.nodes.length&&angular.forEach(n.nodes,function(n){e(n,a+"/")})}(o.urlpath[0],""),angular.forEach(r,function(n){var r=n.split("/"),t=e;angular.forEach(r,function(n,e){""==n&&(n="/");var a=!1;e==r.length-1&&(a=!0),t[n]||(t[n]={}),t[n].leaf=a,t=t[n]})}),o.character.rule=e,t.character[u?"update":"add"](o.character,function(){a.go("admin.character.info")},c.error)}}]});