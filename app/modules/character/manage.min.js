"use strict";angular.module("app").controller("characterManage",["$scope","$stateParams","$state","$api","$cookies","$q","Auth","UI",function(e,n,c,t,r,a,o,i){var u={},d=n.id;o.Check(function(){function n(){var n=a.defer(),c=function(e){var n=function(e,c){_.map(e,function(e,t){e.leaf?u[c+"/"+t]=!0:n(e,"/"==t?"":c+"/"+t)})};n(e,"")};return d?t.character.info({id:d},function(t){e.character=t.result,c(e.character.rule),n.resolve()},function(e){n.reject(e.code)}):n.resolve(),n.promise}e.OnSave=function(){var n=[];!function e(c,t){"/"!=c._id&&(t+=c._id),c.select&&n.push(t),void 0!=c.nodes&&c.nodes.length>0&&_.each(c.nodes,function(n){e(n,t+"/")})}(e.urlpath[0],"");var r={};_.each(n,function(e){var n=e.split("/"),c=r;_.each(n,function(e,t){""==e&&(e="/");var r=!1;t==n.length-1&&(r=!0),c[e]||(c[e]={}),c[e].leaf=r,c=c[e]})}),e.character.rule=r,d?t.character.update(e.character,function(e){return e.code?void i.AlertError(e.message):void c.go("admin.character.info")}):t.character.add(e.character,function(e){return e.code?void i.AlertError(e.message):void c.go("admin.character.info")})},n().then(function(){t.urlpath.info(function(n){var c={_id:"/",nodes:[]};_.each(n.result,function(e){var n=e._id.split("/"),t=c;_.each(n,function(c,r){if(""!=c){var a=n.length==r+1,o=_.find(t.nodes,function(e){return e._id==c});void 0==o&&(a?(o={_id:c,url:e,desc:e.desc||"",enable:e.enable,select:!1,nodes:[]},o.select=!!u[e._id]):o={_id:c,desc:e.desc||"",select:!1,nodes:[]},t.nodes.push(o)),t=o}})}),e.urlpath=[c]})}),e.enable=function(e){e.select=!e.select},e.toggle=function(e){e.toggle()},e.EnableSubNode=function(e,n){var c=function(e){e&&_.each(e.nodes,function(e){return e.select=n,c(e)})};c(e)}})}]);