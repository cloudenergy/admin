"use strict";angular.module("app").component("characterManage",{templateUrl:"app/modules/character/manage.html?rev=d96af4790e",controller:["$q","$state","$stateParams","$api","UI",function(e,n,a,r,t){var c=this,o={},i=a.id,u=e.defer(),l=function(e){!function e(n,a){_.map(n,function(n,r){n.leaf?o[a+"/"+r]=!0:e(n,"/"==r?"":a+"/"+r)})}(e,"")};i?r.character.info({id:i},function(e){c.character=e.result,l(c.character.rule),u.resolve()},function(e){u.reject(e.code)}):u.resolve(),u.promise.then(function(){r.urlpath.info(function(e){var n={_id:"/",nodes:[]};angular.forEach(e.result,function(e){var a=e._id.split("/"),r=n;angular.forEach(a,function(n,t){if(n){var c=a.length==t+1,i=_.find(r.nodes,function(e){return e._id==n});void 0==i&&(c?(i={_id:n,url:e,desc:e.desc||"",enable:e.enable,select:!1,nodes:[]},i.select=!!o[e._id]):i={_id:n,desc:e.desc||"",select:!1,nodes:[]},r.nodes.push(i)),r=i}})}),c.urlpath=[n]})}),c.EnableSubNode=function(e,n){!function e(a){a&&angular.forEach(a.nodes,function(a){a.select=n,e(a)})}(e)},c.OnSave=function(){var e=[],a={};!function n(a,r){"/"!=a._id&&(r+=a._id),a.select&&e.push(r),void 0!=a.nodes&&a.nodes.length>0&&angular.forEach(a.nodes,function(e){n(e,r+"/")})}(c.urlpath[0],""),angular.forEach(e,function(e){var n=e.split("/"),r=a;angular.forEach(n,function(e,a){""==e&&(e="/");var t=!1;a==n.length-1&&(t=!0),r[e]||(r[e]={}),r[e].leaf=t,r=r[e]})}),c.character.rule=a,r.character[i?"update":"add"](c.character,function(){n.go("admin.character.info")},function(e){t.AlertError(e.message)})}}]});