"use strict";angular.module("app").component("characterManage",{templateUrl:"app/modules/character/manage.html?rev=0df6222778",controller:["$q","$state","$stateParams","$api","UI",function(n,e,a,r,t){var c=this,o={},i=a.id,u=n.defer(),l=function(n){!function n(e,a){_.map(e,function(e,r){e.leaf?o[a+"/"+r]=!0:n(e,"/"==r?"":a+"/"+r)})}(n,"")};i?r.character.info({id:i},function(n){c.character=n.result,l(c.character.rule),u.resolve()}):u.resolve(),u.promise.then(function(){r.urlpath.info(function(n){var e={_id:"/",nodes:[]};angular.forEach(n.result,function(n){var a=n._id.split("/"),r=e;angular.forEach(a,function(e,t){if(e){var c=a.length==t+1,i=_.find(r.nodes,function(n){return n._id==e});void 0==i&&(c?(i={_id:e,url:n,desc:n.desc||"",enable:n.enable,select:!1,nodes:[]},i.select=!!o[n._id]):i={_id:e,desc:n.desc||"",select:!1,nodes:[]},r.nodes.push(i)),r=i}})}),c.urlpath=[e]})}),c.EnableSubNode=function(n,e){!function n(a){a&&angular.forEach(a.nodes,function(a){a.select=e,n(a)})}(n)},c.OnSave=function(){var n=[],a={};!function e(a,r){"/"!=a._id&&(r+=a._id),a.select&&n.push(r),void 0!=a.nodes&&a.nodes.length>0&&angular.forEach(a.nodes,function(n){e(n,r+"/")})}(c.urlpath[0],""),angular.forEach(n,function(n){var e=n.split("/"),r=a;angular.forEach(e,function(n,a){""==n&&(n="/");var t=!1;a==e.length-1&&(t=!0),r[n]||(r[n]={}),r[n].leaf=t,r=r[n]})}),c.character.rule=a,r.character[i?"update":"add"](c.character,function(){e.go("admin.character.info")},t.AlertError)}}]});