"use strict";angular.module("app").component("sensor",{templateUrl:"app/modules/byitem/sensor.html?rev=59e8fcc0db",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:["$api","$uibModal","$rootScope","$scope",function(e,t,i,n){var s,c=this;c.currentPage=1,c.popPageSize=10,c.devicetype=[{id:void 0,name:"全部类型"}],c.$onInit=function(){e.device.type({project:c.resolve.projectid},function(e){angular.forEach(e.result,function(e){c.devicetype[e.id]=e,c.devicetype.push(e)})});c.resolve.addItemsIDs;e.sensor.info({project:c.resolve.projectid,key:c.sensorSearchKey,devicetype:c.devicetype.selected,pageindex:c.currentPage,SHOWALL:!0},function(e){angular.forEach(s=e.result.detail,function(t){c.resolve.selected.length&&angular.forEach(c.resolve.selected,function(e){t.did==e.key&&(t.isEnable=t.originisEnable=!0,t.switch=!1)}),t.did==c.resolve.selected.key&&(t.isEnable=!0)}),c.UpdateViewOfSensors()})},c.UpdateViewOfSensors=function(t){c.listData=[],t?_.each(s,function(e){c.devicetype.selected?e.devicetype.match(c.devicetype.selected)&&0===e.devicetype.match(c.devicetype.selected).index&&(e.title&&e.title.match(t)||e.addrid&&e.addrid.match(t)||e.subentry&&e.subentry.match(t))&&c.listData.push(e):(e.title&&e.title.match(t)||e.addrid&&e.addrid.match(t)||e.subentry&&e.subentry.match(t))&&c.listData.push(e)}):c.devicetype.selected?_.each(s,function(e){e.devicetype.match(c.devicetype.selected)&&0===e.devicetype.match(c.devicetype.selected).index&&c.listData.push(e)}):c.listData=_.union(c.listData,s),_.each(c.listData,function(t){var e;e=_.find(c.resolve.selected,function(e){return _.isObject(e)?e.key==t.did:e==i.Project.selected._id+"."+t.key}),t.isEnable=!angular.isUndefined(e)})},c.SwitchSensor=function(e){e.isEnable=!e.isEnable,e.isEnable==e.originisEnable&&(e.switch=!1)||(e.switch=!0)},c.filterItem=function(e){var t=!0;return t=(t=c.devicetype.selected?!!~e.devicetype.indexOf(c.devicetype.selected):t)&&(c.sensorSearchKey?!!(~e.title.indexOf(c.sensorSearchKey)||~e.did.indexOf(c.sensorSearchKey)||e.subentry&&~e.subentry.indexOf(c.sensorSearchKey)):t)},c.SelectAll=function(){angular.forEach(c.listData,function(e){e.isEnable=!0,e.isEnable==e.originisEnable&&(e.switch=!1)||(e.switch=!0)})},c.AntiElection=function(){angular.forEach(c.listData,function(e){e.isEnable=!e.isEnable,e.isEnable==e.originisEnable&&(e.switch=!1)||(e.switch=!0)})},c.Ok=function(){var t=[],i=[];angular.forEach(c.listData,function(e){e.switch&&(e.isEnable?t.push(e):i.push(e))}),t.length||i.length?c.close({$value:{addItems:t,removeItems:i}}):c.dismiss()},c.Cancel=function(){c.dismiss()}}]});