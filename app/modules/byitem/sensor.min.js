"use strict";angular.module("app").component("sensor",{templateUrl:"app/modules/byitem/sensor.html?rev=4c5ffcb40d",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:["$api","$uibModal","$rootScope",function(e,i,n){var t,s=this;s.currentPage=1,s.popPageSize=10,s.devicetype=[{id:void 0,name:"全部类型"}],s.$onInit=function(){e.device.type({project:s.resolve.projectid},function(e){angular.forEach(e.result,function(e){s.devicetype[e.id]=e,s.devicetype.push(e)})});s.resolve.addItemsIDs;e.sensor.info({project:s.resolve.projectid,key:s.sensorSearchKey,devicetype:s.devicetype.selected,pageindex:s.currentPage,SHOWALL:!0},function(e){angular.forEach(t=e.result.detail,function(e){angular.forEach(s.resolve.selected,function(i){e.did==i.key&&(e.isEnable=e.originisEnable=!0,e.switch=!1)}),e.did==s.resolve.selected.key&&(e.isEnable=!0)}),s.UpdateViewOfSensors()})},s.UpdateViewOfSensors=function(e){s.listData=[],e?_.each(t,function(i){(i.title.match(e)||i.addrid.match(e)||i.subentry&&i.subentry.match(e))&&s.listData.push(i)}):s.listData=_.union(s.listData,t),_.each(s.listData,function(e){var i;i=_.find(s.resolve.selected,function(i){return _.isObject(i)?i.key==e.did:i==n.Project.selected._id+"."+e.key}),e.isEnable=!angular.isUndefined(i)})},s.SwitchSensor=function(e){e.isEnable=!e.isEnable,e.isEnable==e.originisEnable&&(e.switch=!1)||(e.switch=!0)},s.filterItem=function(e){var i=!0;return(i=s.devicetype.selected?!!~e.devicetype.indexOf(s.devicetype.selected):i)&&(i=s.sensorSearchKey?!!(~e.title.indexOf(s.sensorSearchKey)||~e.did.indexOf(s.sensorSearchKey)||e.subentry&&~e.subentry.indexOf(s.sensorSearchKey)):i),i},s.SelectAll=function(){angular.forEach(s.listData,function(e){e.isEnable=!0,e.isEnable==e.originisEnable&&(e.switch=!1)||(e.switch=!0)})},s.AntiElection=function(){angular.forEach(s.listData,function(e){e.isEnable=!e.isEnable,e.isEnable==e.originisEnable&&(e.switch=!1)||(e.switch=!0)})},s.Ok=function(){var e=[],i=[];angular.forEach(s.listData,function(n){n.switch&&(n.isEnable?e.push(n):i.push(n))}),e.length||i.length?s.close({$value:{addItems:e,removeItems:i}}):s.dismiss()},s.Cancel=function(){s.dismiss()}}]});