<div class="panel panel-default mb0 layout-column"><div class="panel-body flex-initial pb0"><div class="pull-right pt8 pr15 mb10"><a class="btn-link" ng-if="$ctrl.type != 'BYCATEGORY'" ng-click="$ctrl.addnode('root')">添加属性</a></div><div class="pull-right pt8 pr15 mb10"><a class="btn-link" ng-click="$ctrl.refresh()">更新属性</a></div></div><div class="panel-body flex overflow-auto pt0 pb0"><table class="table table-bordered table-hover mb0 table-node text-center"><thead><tr><td class="col-sm-2">属性名</td><td class="col-sm-1"><div>面积</div><div>[AREA]</div></td><td class="col-sm-1"><div>人数</div><div>[PERSON]</div></td><td class="col-sm-2">公式 <i class="fa fa-question-circle ml5" popover-placement="top" uib-popover="每个参数必须单独填写在[]内，比如[AREA]" popover-is-open="over" ng-mouseenter="over=true" ng-mouseleave="over=false"></i></td><td class="col-sm-4">仪表关联</td><td class="col-sm-2" ng-if="$ctrl.type != 'BYCATEGORY'">操作</td><td class="col-sm-2" ng-if="$ctrl.type == 'BYCATEGORY'">状态</td></tr></thead><tbody><tr ng-repeat="item in $ctrl.itemData"><td colspan="6" class="table-td"><div class="col-sm-12 table-row pb10" ng-click="item.showChildren=!item.showChildren"><div class="col-sm-2"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="item.title"></div><div class="col-sm-1"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="item.formula.variables.AREA"></div><div class="col-sm-1"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="item.formula.variables.PERSON"></div><div class="col-sm-2"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="item.formula.formula"></div><div class="col-sm-4">{{item.childArray.length}} <a class="glyphicon glyphicon-link" ng-click="$ctrl.changeSensor(item);$event.stopPropagation();"></a></div><div class="col-sm-2" ng-if="item.id"><a ng-click="$event.stopPropagation();$ctrl.save('root',item,'UPDATE');"><i class="fa fa-floppy-o"></i> </a><a ng-if="!item.key&&$ctrl.type != 'BYCATEGORY'" class="ml10" ng-click="item.showChildren=true;$ctrl.addnode('child',item);$event.stopPropagation();"><i class="fa fa-plus-square"></i> </a><a class="ml10" ng-if="$ctrl.type != 'BYCATEGORY'" ng-click="$ctrl.delete(item);$event.stopPropagation();"><i class="fa fa-times"></i> </a><a class="ml10" ng-click="$event.stopPropagation();$ctrl.save('root',item,'UPDATE',!item.enable);"><i ng-if="!item.enable" popover-placement="top" uib-popover="已禁用" popover-is-open="ban" ng-mouseenter="ban=true" ng-mouseleave="ban=false" class="fa fa-ban"></i> <i ng-if="item.enable" popover-placement="top" uib-popover="已启用" popover-is-open="circleo" ng-mouseenter="circleo=true" ng-mouseleave="circleo=false" class="fa fa-circle-o"></i></a></div><div class="col-sm-2" ng-if="!item.id"><a ng-click="$ctrl.save('root',item,'ADD');$event.stopPropagation();"><i class="fa fa-floppy-o"></i> </a><a class="ml10" ng-click="$ctrl.cancel($ctrl.itemData,$index)"><i class="fa fa-times"></i></a></div></div><div class="col-sm-12 table-child" style="padding-bottom:10px!important" ng-if="item.showChildren" ng-repeat="child in item.childArray" ng-click="child.showChildren=!child.showChildren"><div class="col-sm-2" ng-click="child.showGrandchildren=!child.showGrandchildren"><input class="form-control table-child-input" ng-click="$event.stopPropagation();" type="text" ng-model="child.title"></div><div class="col-sm-1" ng-click="child.showGrandchildren=!child.showGrandchildren"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="child.formula.variables.AREA"></div><div class="col-sm-1" ng-click="child.showGrandchildren=!child.showGrandchildren"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="child.formula.variables.PERSON"></div><div class="col-sm-2" ng-if="$ctrl.type != 'BYCATEGORY'" ng-click="child.showGrandchildren=!child.showGrandchildren"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="child.formula.formula"></div><div class="col-sm-4" ng-click="child.showGrandchildren=!child.showGrandchildren">{{child.childArray.length && child.childArray.length || child.addrid}} <a class="glyphicon glyphicon-link" ng-click="$ctrl.changeSensor(child)"></a></div><div class="col-sm-2" ng-if="!child.id&&$ctrl.type != 'BYCATEGORY'"><a style="margin-left: -20px" ng-click="$ctrl.save('child',child,'ADD')"><i class="fa fa-floppy-o"></i> </a><a class="ml10" ng-click="$ctrl.cancel(item.childArray,$index)"><i class="fa fa-times"></i></a></div><div class="col-sm-2" ng-class="{'ml-60':$ctrl.type == 'BYCATEGORY'}"><a style="margin-left: -20px" ng-if="child.id&&$ctrl.type != 'BYCATEGORY'" ng-click="$ctrl.save('child',child,'UPDATE')"><i class="fa fa-floppy-o"></i> </a><a class="ml10" ng-click="child.showChildren=true;$ctrl.addnode('child',child);$event.stopPropagation();console.log(child)"><i class="fa fa-plus-square"></i> </a><a class="ml10" ng-if="child.id&&$ctrl.type != 'BYCATEGORY'" ng-click="$ctrl.delete(child,item)"><i class="fa fa-times"></i> </a><a class="ml10" ng-click="$event.stopPropagation();$ctrl.save('child',child,'UPDATE',!child.enable);"><i ng-if="!child.enable" popover-placement="top" uib-popover="已禁用" popover-is-open="ban" ng-mouseenter="ban=true" ng-mouseleave="ban=false" class="fa fa-ban"></i> <i ng-if="child.enable" popover-placement="top" uib-popover="已启用" popover-is-open="circleo" ng-mouseenter="circleo=true" ng-mouseleave="circleo=false" class="fa fa-circle-o"></i></a></div><div class="col-sm-12 table-grandchild" style="padding-top:10px!important" ng-if="child.showGrandchildren" ng-repeat="node in child.child"><div class="col-sm-2" style="margin-left: -5px"><input class="form-control table-grandchild-input" ng-click="$event.stopPropagation();" type="text" ng-model="node.title"></div><div class="col-sm-1"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="node.formula.variables.AREA"></div><div class="col-sm-1"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="node.formula.variables.PERSON"></div><div class="col-sm-2"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="node.formula.formula"></div><div class="col-sm-4" style="padding-left: 100px">{{node.addrid}}</div><div class="col-sm-2" ng-if="node.id"><a class="ml20" style="margin-left: 28px" ng-click="$ctrl.save('child',node,'UPDATE','DEV')"><i class="fa fa-floppy-o"></i> </a><a class="ml10" ng-click="$ctrl.delete(node)"><i class="fa fa-times"></i></a></div></div><div class="col-sm-12 table-child" style="padding-bottom:10px!important" ng-if="child.showChildren" ng-repeat="child2 in child.childArray"><div class="col-sm-2" ng-click="child2.showGrandchildren=!child2.showGrandchildren"><input class="form-control table-child-input" ng-click="$event.stopPropagation();" type="text" ng-model="child2.title"></div><div class="col-sm-1" ng-click="child2.showGrandchildren=!child2.showGrandchildren"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="child2.formula.variables.AREA"></div><div class="col-sm-1" ng-click="child2.showGrandchildren=!child2.showGrandchildren"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="child2.formula.variables.PERSON"></div><div class="col-sm-2" ng-if="$ctrl.type != 'BYCATEGORY'" ng-click="child2.showGrandchildren=!child2.showGrandchildren"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="child2.formula.formula"></div><div class="col-sm-4" ng-click="child2.showGrandchildren=!child2.showGrandchildren">{{child2.childArray.length && child2.childArray.length || child2.addrid}} <a class="glyphicon glyphicon-link" ng-click="$ctrl.changeSensor(child)"></a></div><div class="col-sm-2" ng-if="!child2.id&&$ctrl.type != 'BYCATEGORY'"><a style="margin-left: -20px" ng-click="$ctrl.save('child',child2,'ADD')"><i class="fa fa-floppy-o"></i> </a><a class="ml10" ng-click="$ctrl.cancel(item.childArray,$index)"><i class="fa fa-times"></i></a></div><div class="col-sm-2" ng-class="{'ml-60':$ctrl.type == 'BYCATEGORY'}"><a style="margin-left: -20px" ng-if="child2.id&&$ctrl.type != 'BYCATEGORY'" ng-click="$ctrl.save('child',child,'UPDATE')"><i class="fa fa-floppy-o"></i> </a><a class="ml10" ng-if="child2.id&&$ctrl.type != 'BYCATEGORY'" ng-click="$ctrl.delete(child,item)"><i class="fa fa-times"></i> </a><a class="ml10" ng-click="$event.stopPropagation();$ctrl.save('child',child,'UPDATE',!child2.enable);"><i ng-if="!child2.enable" popover-placement="top" uib-popover="已禁用" popover-is-open="ban" ng-mouseenter="ban=true" ng-mouseleave="ban=false" class="fa fa-ban"></i> <i ng-if="child2.enable" popover-placement="top" uib-popover="已启用" popover-is-open="circleo" ng-mouseenter="circleo=true" ng-mouseleave="circleo=false" class="fa fa-circle-o"></i></a></div><div class="col-sm-12 table-grandchild" style="padding-top:10px!important" ng-if="child2.showGrandchildren" ng-repeat="node in child2.child"><div class="col-sm-2" style="margin-left: -5px"><input class="form-control table-grandchild-input" ng-click="$event.stopPropagation();" type="text" ng-model="node.title"></div><div class="col-sm-1"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="node.formula.variables.AREA"></div><div class="col-sm-1"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="node.formula.variables.PERSON"></div><div class="col-sm-2"><input class="form-control" ng-click="$event.stopPropagation();" type="text" ng-model="node.formula.formula"></div><div class="col-sm-4" style="padding-left: 100px">{{node.addrid}}</div><div class="col-sm-2" ng-if="node.id"><a class="ml20" style="margin-left: 28px" ng-click="$ctrl.save('child',node,'UPDATE','DEV')"><i class="fa fa-floppy-o"></i> </a><a class="ml10" ng-click="$ctrl.delete(node)"><i class="fa fa-times"></i></a></div></div></div></div></td></tr></tbody></table></div><div class="panel-body flex-initial pt0"></div></div>