<<<<<<< HEAD
"use strict";angular.module("app").component("analyticAttribute",{templateUrl:"app/modules/byitem/index.html?rev=c1a27824be",controller:["$rootScope","$api","$uibModal","$stateParams","$timeout","SweetAlert",function(t,o,a,r,e,d){var l=this;l.type=r.type,l.changeSensor=function(n){a.open({backdrop:"static",component:"sensor",size:"lg",resolve:{projectid:function(){return t.Project.selected._id},selected:function(){return angular.equals(n.child,{})&&n||n.child}}}).result.then(function(a){l.addsensor=function(){1==a.removeItems.length&&1==a.addItems.length&&o.eca.update({projectid:t.Project.selected._id,node:{id:n.id,key:a.addItems.did,title:n.title,parent:n.parent,formula:{variables:{AREA:n.formula.variables.AREA,PERSON:n.formula.variables.PERSON},formula:n.formula.formula},type:r.type},method:"UPDATE"},function(){l.originData=angular.copy(l.itemData),l.loadData().finally(function(){angular.forEach(l.itemData,function(a){angular.forEach(l.originData,function(e){e.showChildren&&a.id==e.id&&(a.showChildren=e.showChildren),e.nodes&&angular.forEach(e.nodes,function(a){a.showGrandchildren&&a.id==e.id&&(n.showGrandchildren=a.showGrandchildren)})})})})}),1<=a.addItems.length&&1!=a.removeItems.length&&angular.forEach(a.addItems,function(a){l.add(a,a.title,n.id)}),1<=a.removeItems.length&&1!=a.addItems.length&&angular.forEach(a.removeItems,function(e){angular.forEach(n.child,function(a){a.key==e.did&&l.delete(a)})})},n.id&&l.addsensor(),n.id||l.save("child",n,"ADD")})},l.loadData=function(){return o.eca.info({projectid:t.Project.selected._id,type:r.type},function(a){l.itemData=a.result,angular.forEach(l.itemData,function(a){a.childArray=[],angular.forEach(a.child,function(e){e.addrid=e.key.substring(12,24),a.childArray.push(e),e.childArray=[],angular.forEach(e.child,function(a){e.childArray.push(a)})})})},function(a){l.itemData=a.result}).$promise},l.loadData(),l.addnode=function(a,e){"root"==a?l.itemData.push({title:"",type:r.type,formula:{formula:"",variables:{AREA:"",PERSON:""}}}):e.childArray.push({title:"",type:r.type,parent:e.id,formula:{formula:"",variables:{AREA:"",PERSON:""}}})},l.cancel=function(a,e){a.splice(e,1)},l.delete=function(a,e){o.eca.update({projectid:t.Project.selected._id,node:{id:a.id},method:"REMOVE"},function(){l.originData=angular.copy(l.itemData),l.loadData().finally(function(){angular.forEach(l.itemData,function(n){angular.forEach(l.originData,function(a){a.showChildren&&n.id==a.id&&(n.showChildren=a.showChildren),a.child&&angular.forEach(a.child,function(e){angular.forEach(n.child,function(a){e.showGrandchildren&&e.id==a.id&&(a.showGrandchildren=e.showGrandchildren)})})})})})})},l.refresh=function(){o.eca.refresh({projectid:t.Project.selected._id,type:r.type},function(){l.loadData()})},l.save=function(a,e,n,i){o.eca.update({projectid:t.Project.selected._id,node:{id:e.id,key:e.key,title:e.title,parent:"child"==a&&e.parent||void 0,formula:{variables:{AREA:e.formula.variables&&e.formula.variables.AREA,PERSON:e.formula.variables&&e.formula.variables.PERSON},formula:e.formula.formula||""},enable:angular.isUndefined(i)&&e.enable||i,type:r.type},method:n},function(){l.originData=angular.copy(l.itemData),l.loadData().finally(function(){angular.forEach(l.itemData,function(a){angular.forEach(l.originData,function(e){e.showChildren&&a.id==e.id&&(a.showChildren=e.showChildren),e.nodes&&angular.forEach(e.nodes,function(a){a.showGrandchildren&&a.id==e.id&&(child.showGrandchildren=a.showGrandchildren)})})})})},function(){d.info("请填写完整参数")}).$promise.finally(function(){})},l.add=function(a,e,n){o.eca.update({projectid:t.Project.selected._id,node:{title:e,key:a.did,parent:n,type:r.type},method:"ADD"},function(){l.originData=angular.copy(l.itemData),l.loadData().finally(function(){angular.forEach(l.itemData,function(a){angular.forEach(l.originData,function(e){e.showChildren&&a.id==e.id&&(a.showChildren=e.showChildren),e.nodes&&angular.forEach(e.nodes,function(a){a.showGrandchildren&&a.id==e.id&&(child.showGrandchildren=a.showGrandchildren)})})})})},function(){d.info("请填写完整参数")}).$promise.finally(function(){})}}]});
=======
"use strict";angular.module("app").component("analyticAttribute",{templateUrl:"app/modules/byitem/index.html?rev=b600d0ffde",controller:["$rootScope","$api","$uibModal","$stateParams","$timeout","SweetAlert",function(a,e,n,i,t,o){var r=this;r.type=i.type,r.changeSensor=function(t){n.open({backdrop:"static",component:"sensor",size:"lg",resolve:{projectid:function(){return a.Project.selected._id},selected:function(){return angular.equals(t.child,{})&&t||t.child}}}).result.then(function(n){r.addsensor=function(){1==n.removeItems.length&&1==n.addItems.length&&e.eca.update({projectid:a.Project.selected._id,node:{id:t.id,key:n.addItems.did,title:t.title,parent:t.parent,formula:{variables:{AREA:t.formula.variables.AREA,PERSON:t.formula.variables.PERSON},formula:t.formula.formula},type:i.type},method:"UPDATE"},function(){r.originData=angular.copy(r.itemData),r.loadData().finally(function(){angular.forEach(r.itemData,function(a){angular.forEach(r.originData,function(e){e.showChildren&&a.id==e.id&&(a.showChildren=e.showChildren),e.nodes&&angular.forEach(e.nodes,function(a){a.showGrandchildren&&a.id==e.id&&(t.showGrandchildren=a.showGrandchildren)})})})})}),n.addItems.length>=1&&1!=n.removeItems.length&&angular.forEach(n.addItems,function(a){r.add(a,a.title,t.id)}),n.removeItems.length>=1&&1!=n.addItems.length&&angular.forEach(n.removeItems,function(a){angular.forEach(t.child,function(e){e.key==a.did&&r.delete(e)})})},t.id&&r.addsensor(),!t.id&&r.save("child",t,"ADD")})},r.loadData=function(){return e.eca.info({projectid:a.Project.selected._id,type:i.type},function(a){r.itemData=a.result,angular.forEach(r.itemData,function(a){a.childArray=[],angular.forEach(a.child,function(e){e.addrid=e.key.substring(12,24),a.childArray.push(e),e.childArray=[],angular.forEach(e.child,function(a){e.childArray.push(a)})})})},function(a){r.itemData=a.result}).$promise},r.loadData(),r.addnode=function(a,e){"root"==a?r.itemData.push({title:"",type:i.type,formula:{formula:"",variables:{AREA:"",PERSON:""}}}):e.childArray.push({title:"",type:i.type,parent:e.id,formula:{formula:"",variables:{AREA:"",PERSON:""}}})},r.cancel=function(a,e){a.splice(e,1)},r.delete=function(n,i){e.eca.update({projectid:a.Project.selected._id,node:{id:n.id},method:"REMOVE"},function(){r.originData=angular.copy(r.itemData),r.loadData().finally(function(){angular.forEach(r.itemData,function(a){angular.forEach(r.originData,function(e){e.showChildren&&a.id==e.id&&(a.showChildren=e.showChildren),e.child&&angular.forEach(e.child,function(e){angular.forEach(a.child,function(a){e.showGrandchildren&&e.id==a.id&&(a.showGrandchildren=e.showGrandchildren)})})})})})})},r.refresh=function(){e.eca.refresh({projectid:a.Project.selected._id,type:i.type},function(){r.loadData()})},r.save=function(n,t,d,l){e.eca.update({projectid:a.Project.selected._id,node:{id:t.id,key:t.key,title:t.title,parent:"child"==n&&t.parent||void 0,formula:{variables:{AREA:t.formula.variables&&t.formula.variables.AREA,PERSON:t.formula.variables&&t.formula.variables.PERSON},formula:t.formula.formula||""},enable:angular.isUndefined(l)&&t.enable||l,type:i.type},method:d},function(){r.originData=angular.copy(r.itemData),r.loadData().finally(function(){angular.forEach(r.itemData,function(a){angular.forEach(r.originData,function(e){e.showChildren&&a.id==e.id&&(a.showChildren=e.showChildren),e.nodes&&angular.forEach(e.nodes,function(a){a.showGrandchildren&&a.id==e.id&&(child.showGrandchildren=a.showGrandchildren)})})})})},function(){o.info("请填写完整参数")}).$promise.finally(function(){})},r.add=function(n,t,d){e.eca.update({projectid:a.Project.selected._id,node:{title:t,key:n.did,parent:d,type:i.type},method:"ADD"},function(){r.originData=angular.copy(r.itemData),r.loadData().finally(function(){angular.forEach(r.itemData,function(a){angular.forEach(r.originData,function(e){e.showChildren&&a.id==e.id&&(a.showChildren=e.showChildren),e.nodes&&angular.forEach(e.nodes,function(a){a.showGrandchildren&&a.id==e.id&&(child.showGrandchildren=a.showGrandchildren)})})})})},function(){o.info("请填写完整参数")}).$promise.finally(function(){})}}]});
>>>>>>> 6e3d1a2aa57f97a11542dd09c3d02693cef0d7c3
