"use strict";angular.module("app").component("projectEdit",{templateUrl:"app/modules/project/edit.html?rev=3fc611442a",controller:["$stateParams","$api","SweetAlert","base64","Upload","$state",function(n,r,i,o,e,u){var a=this;a.ondutyHour=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],a.ondutyMinute=["00","10","20","30","40","50"],a.offdutyHour=angular.copy(a.ondutyHour),a.offdutyMinute=angular.copy(a.ondutyMinute),a.$onInit=function(){r.project.info({id:n.id},function(e){a.project=e.result,""!==a.project.avatar&&(a.file=[{key:a.project.avatar}]);var t=moment(a.project.onduty,"HH:mm");a.project.onduty=t.format("HH:mm"),a.ondutyHour.selected=t.format("HH"),a.ondutyMinute.selected=t.format("mm");var o=moment(a.project.offduty,"HH:mm");a.project.offduty=o.format("HH:mm"),a.offdutyHour.selected=o.format("HH"),a.offdutyMinute.selected=o.format("mm")},i.error)},a.Save=function(e,t){a.project.onduty=String(a.ondutyHour.selected)+":"+String(a.ondutyMinute.selected),a.project.offduty=String(a.offdutyHour.selected)+":"+String(a.offdutyMinute.selected);var o={id:n.id,title:a.project.title,description:a.project.description,address:a.project.address,onduty:a.project.onduty,offduty:a.project.offduty,avatar:a.file&&a.file.length&&a.file[0].key||""};"time"==t?(o.onduty=a.project.onduty,o.offduty=a.project.offduty):o[t]=e,r.project.update(o,function(){i.success("修改成功"),delete a.project["edit_"+t],u.go("admin.project.info")},i.error)},a.uploadImg={upload:function(){angular.isUndefined(a.file[0].key)&&angular.isUndefined(a.file[0].$upload)&&(a.file[0].$upload=1,e.base64DataUrl(a.file[0]).then(function(t){a.file[0].__proto__.$base64=1,r.interaction.uploadtoken({file:(new Date).getTime()+"_"+a.file[0].name},function(e){r.qiniu.upload({base64:o.encode(e.result.file),token:e.result.token},{file:t.split("data:image/jpeg;base64,")[1]},function(e){a.file[0].key=e.key,angular.forEach(a.file[0],function(e,t){/^\$/.test(t)&&delete a.file[0][t]}),a.project.avatar=e.key})})}))},delete:function(){i.swal({title:"确定删除该图片吗？",type:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确认"}).then(function(){r.interaction.remove({file:a.file[0].key}),a.file.splice(0,1)})}}}]});