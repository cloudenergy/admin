"use strict";angular.module("app").component("projectEdit",{templateUrl:"app/modules/project/edit.html?rev=d7aa82bf2e",controller:["$stateParams","$api","SweetAlert","base64","Upload","$state",function(e,t,o,n,r,i){var u=this;u.ondutyHour=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],u.ondutyMinute=["00","10","20","30","40","50"],u.offdutyHour=angular.copy(u.ondutyHour),u.offdutyMinute=angular.copy(u.ondutyMinute),u.$onInit=function(){t.project.info({id:e.id},function(e){u.project=e.result,""!==u.project.avatar&&(u.file=[{key:u.project.avatar}]);var t=moment(u.project.onduty,"HH:mm");u.project.onduty=t.format("HH:mm"),u.ondutyHour.selected=t.format("HH"),u.ondutyMinute.selected=t.format("mm");var o=moment(u.project.offduty,"HH:mm");u.project.offduty=o.format("HH:mm"),u.offdutyHour.selected=o.format("HH"),u.offdutyMinute.selected=o.format("mm")},o.error)},u.Save=function(n,r){u.project.onduty=String(u.ondutyHour.selected)+":"+String(u.ondutyMinute.selected),u.project.offduty=String(u.offdutyHour.selected)+":"+String(u.offdutyMinute.selected);var a={id:e.id,title:u.project.title,description:u.project.description,address:u.project.address,onduty:u.project.onduty,offduty:u.project.offduty,avatar:u.file.length&&u.file[0].key||""};"time"==r?(a.onduty=u.project.onduty,a.offduty=u.project.offduty):a[r]=n,t.project.update(a,function(){o.success("修改成功"),delete u.project["edit_"+r],i.go("admin.project.info")},o.error)},u.uploadImg={upload:function(){angular.isUndefined(u.file[0].key)&&angular.isUndefined(u.file[0].$upload)&&(u.file[0].$upload=1,r.base64DataUrl(u.file[0]).then(function(e){u.file[0].__proto__.$base64=1,t.interaction.uploadtoken({file:(new Date).getTime()+"_"+u.file[0].name},function(o){t.qiniu.upload({base64:n.encode(o.result.file),token:o.result.token},{file:e.split("data:image/jpeg;base64,")[1]},function(e){u.file[0].key=e.key,angular.forEach(u.file[0],function(e,t){/^\$/.test(t)&&delete u.file[0][t]}),u.project.avatar=e.key})})}))},delete:function(){o.swal({title:"确定删除该图片吗？",type:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确认"}).then(function(){t.interaction.remove({file:u.file[0].key}),u.file.splice(0,1)})}}}]});