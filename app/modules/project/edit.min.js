"use strict";angular.module("app").component("projectEdit",{templateUrl:"app/modules/project/edit.html?rev=42e2b55bd7",controller:["$stateParams","$api","SweetAlert","base64","Upload",function(e,t,o,n,u){var r=this;r.ondutyHour=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],r.ondutyMinute=["00","10","20","30","40","50"],r.offdutyHour=angular.copy(r.ondutyHour),r.offdutyMinute=angular.copy(r.ondutyMinute),r.$onInit=function(){t.project.info({id:e.id},function(e){r.project=e.result,""!==r.project.avatar&&(r.file=[{key:r.project.avatar}]);var t=moment(r.project.onduty,"HH:mm");r.project.onduty=t.format("HH:mm"),r.ondutyHour.selected=t.format("HH"),r.ondutyMinute.selected=t.format("mm");var o=moment(r.project.offduty,"HH:mm");r.project.offduty=o.format("HH:mm"),r.offdutyHour.selected=o.format("HH"),r.offdutyMinute.selected=o.format("mm")},o.error)},r.Save=function(n,u){r.project.onduty=String(r.ondutyHour.selected)+":"+String(r.ondutyMinute.selected),r.project.offduty=String(r.offdutyHour.selected)+":"+String(r.offdutyMinute.selected);var i={id:e.id};i.avatar=r.file[0]&&r.file[0].key,"time"==u?(i.onduty=r.project.onduty,i.offduty=r.project.offduty):i[u]=n,t.project.update(i,function(){o.success("修改成功"),delete r.project["edit_"+u]},o.error)},r.uploadImg={upload:function(){angular.isUndefined(r.file[0].key)&&angular.isUndefined(r.file[0].$upload)&&(r.file[0].$upload=1,u.base64DataUrl(r.file[0]).then(function(e){r.file[0].__proto__.$base64=1,t.interaction.uploadtoken({file:(new Date).getTime()+"_"+r.file[0].name},function(o){t.qiniu.upload({base64:n.encode(o.result.file),token:o.result.token},{file:e.split("data:image/jpeg;base64,")[1]},function(e){r.file[0].key=e.key,angular.forEach(r.file[0],function(e,t){/^\$/.test(t)&&delete r.file[0][t]}),r.project.avatar=e.key})})}))},delete:function(){o.swal({title:"确定删除该图片吗？",type:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确认"}).then(function(){t.interaction.remove({file:r.file[0].key}),r.file.splice(0,1)})}}}]});