"use strict";angular.module("app").controller("projectCreate",["$scope","$state","$api","UI","User","$q",function(e,r,t,c,n,o){e.ondutyHour=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],e.ondutyMinute=["00","10","20","30","40","50"],e.offdutyHour=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],e.offdutyMinute=["00","10","20","30","40","50"],e.ondutyHour.selected="8",e.ondutyMinute.selected="00",e.offdutyHour.selected="17",e.offdutyMinute.selected="00",e.warning={},e.submit=function(n){if(e.account.user.length<6)return void c.AlertError("帐号不能低于6位");if(e.newpasswd!=e.repeatnewpasswd)return void c.AlertError("二次密码输入不一致，请重新输入");if(void 0==e.newpasswd&&null==e.newpasswd||(e.account.passwd=e.newpasswd),!e.characters.selected)return void c.AlertError("请选择权限级别");if(("TENEMENTENGINEER"==e.characters.selected._id||"TECHSUPPORT"==e.characters.selected._id)&&!e.account.email)return void c.AlertError("物业工程和技术支持必须填写邮箱");e.account.character=e.characters.selected._id,e.account.message=Object.keys(e.warning).filter(function(r){return e.warning[r]?r:""}).join(",");var o=[];e.project.onduty=e.ondutyHour.selected+":"+e.ondutyMinute.selected,e.project.offduty=e.offdutyHour.selected+":"+e.offdutyMinute.selected,o.push(e.project),t.project.add(o,function(){c.AlertSuccess("新建项目成功"),t.account.add(e.account,function(){c.AlertSuccess("新建项目与帐号成功"),r.go("admin.project.info")},function(e){c.AlertError("新建帐号错误: "+e.message)})},function(){c.AlertError("新建项目错误")})},t.energycategory.info(function(r){e.energycategory=r.result},c.AlertError),t.account.info({id:n.data._id},function(r){e.adminUser=r.result,t.character.info({power:e.adminUser.character&&e.adminUser.character.level},function(r){e.characters=r.result,e.characters.selected=e.characters[e.characters.length-1]},c.AlertError)},c.AlertError)}]);