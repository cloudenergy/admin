"use strict";angular.module("app").controller("projectInfo",["$rootScope","$scope","$api","SweetAlert","$state","$uibModal",function(e,t,o,n,c,r){t.askingRemoveID=void 0,t.currentPage=1,t.pageSize=15,t.Project=e.Project,o.project.info(function(c){angular.forEach(angular.copy(e.Project),function(e,o){delete t.Project[e._id],t.Project.splice(t.Project.length-o-1,1)}),angular.forEach(angular.isArray(c.result)?c.result:[c.result],function(e){t.Project.push(e),t.Project[e._id]=e}),t.DoRemove=function(c,r){o.project.delete({id:c},function(){e.Project.splice(t.pageSize*(t.currentPage-1)+r,1),t.Project.splice(t.pageSize*(t.currentPage-1)+r,1),delete e.Project[c],delete t.Project[c]},n.error)},t.AskForRemove=function(e){t.askingRemoveID=e},t.statusSwitch=function(t,n){n.preventDefault(),r.open({templateUrl:"modal-projectStatus.html",size:"md",controller:["$scope","$uibModalInstance",function(n,c){n.ok=function(){o.project.status({projectid:t,status:"ONLINE"},function(){o.project.info(function(t){angular.forEach(angular.copy(e.Project),function(t,o){delete e.Project[t._id],e.Project.splice(e.Project.length-o-1,1)}),angular.forEach(angular.isArray(t.result)?t.result:[t.result],function(t){e.Project.push(t),e.Project[t._id]=t})})}),c.dismiss("cancel")},n.cancel=function(){c.dismiss("cancel")}}]})},t.CancelRemove=function(){delete t.askingRemoveID},t.$watch("currentPage",function(){delete t.askingRemoveID})}),t.projectInfo=function(t){e.Project.selected=t,c.go("admin.project.edit",{project:t})},t.selecteProject=function(t){e.Project.selected=t,c.go("admin.project.edit",{id:t._id},{reload:!0})},t.onSearch=function(){o.project.info({titlereg:t.searchKey},function(e){angular.isArray(e.result)&&(t.Project=e.result)||(t.Project=[e.result])},function(e){t.Project=[]})},t.projectChange=function(e,t){var i={time:"timeChange.html",title:"titleChange.html",description:"descriptionChange.html"};r.open({size:"md",templateUrl:i[t],controller:["$scope","$uibModalInstance",function(t,c){t.project=angular.copy(e),t.title=t.project.title;var r=moment(t.project.onduty,"H:mm"),i=moment(t.project.offduty,"H:mm");t.ondutyHour=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],t.ondutyMinute=["00","10","20","30","40","50"],t.offdutyHour=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],t.offdutyMinute=["00","10","20","30","40","50"],t.ondutyHour.selected=r.format("H"),t.ondutyMinute.selected=r.format("mm"),t.offdutyHour.selected=i.format("H"),t.offdutyMinute.selected=i.format("mm"),t.ok=function(){t.project.onduty=String(t.ondutyHour.selected)+":"+String(t.ondutyMinute.selected),t.project.offduty=String(t.offdutyHour.selected)+":"+String(t.offdutyMinute.selected),o.project.update(t.project,function(){angular.extend(e,t.project),n.success("更新成功"),c.dismiss("cancel")},n.error)},t.cancel=function(){c.dismiss("cancel")}}]}).result.then(function(){},function(){c.reload()})},t.popover={url:{title:"titleChange.html",description:"descriptionChange.html"},title:{title:"项目名称修改",description:"项目描述修改"},ok:function(e,c,r){e[c+"IsOpen"]=!1,t.project=angular.copy(e),t.project[c]=r[c],o.project.update(t.project,function(){e[c]=r[c],n.success("更新成功")},n.error)},cancel:function(e,t){e[t+"IsOpen"]=!1}}}]);