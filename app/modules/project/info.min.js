"use strict";angular.module("app").controller("projectInfo",["$rootScope","$scope","$api","UI","$state","$uibModal",function(e,t,o,r,c,n){t.askingRemoveID=void 0,t.currentPage=1,t.pageSize=15,t.Project=e.Project,o.project.info(function(c){angular.forEach(angular.copy(e.Project),function(e,o){delete t.Project[e._id],t.Project.splice(t.Project.length-o-1,1)}),angular.forEach(angular.isArray(c.result)?c.result:[c.result],function(e){t.Project.push(e),t.Project[e._id]=e}),t.DoRemove=function(c,n){o.project.delete({id:c},function(){e.Project.splice(t.pageSize*(t.currentPage-1)+n,1),t.Project.splice(t.pageSize*(t.currentPage-1)+n,1),delete e.Project[c],delete t.Project[c]},r.AlertError)},t.AskForRemove=function(e){t.askingRemoveID=e},t.statusSwitch=function(t,r){r.preventDefault(),n.open({templateUrl:"modal-projectStatus.html",size:"md",controller:["$scope","$uibModalInstance",function(r,c){r.ok=function(){o.project.status({projectid:t,status:"ONLINE"},function(){o.project.info(function(t){angular.forEach(angular.copy(e.Project),function(t,o){delete e.Project[t._id],e.Project.splice(e.Project.length-o-1,1)}),angular.forEach(angular.isArray(t.result)?t.result:[t.result],function(t){e.Project.push(t),e.Project[t._id]=t})})}),c.dismiss("cancel")},r.cancel=function(){c.dismiss("cancel")}}]})},t.CancelRemove=function(){delete t.askingRemoveID},t.$watch("currentPage",function(){delete t.askingRemoveID})}),t.selecteProject=function(t){e.Project.selected=t,c.go("admin.project.edit",{id:t._id},{reload:!0})},t.onSearch=function(){o.project.info({titlereg:t.searchKey},function(e){angular.isArray(e.result)&&(t.Project=e.result)||(t.Project=[e.result])},function(e){t.Project=[]})},t.projectChange=function(c,u){var i={time:"timeChange.html",title:"titleChange.html",description:"descriptionChange.html"};n.open({size:"md",templateUrl:i[u],controller:["$scope","$uibModalInstance",function(t,n){t.project=c,t.title=t.project.title;var u=moment(t.project.onduty,"H:mm"),i=moment(t.project.offduty,"H:mm");t.ondutyHour=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],t.ondutyMinute=["00","10","20","30","40","50"],t.offdutyHour=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],t.offdutyMinute=["00","10","20","30","40","50"],t.ondutyHour.selected=u.format("H"),t.ondutyMinute.selected=u.format("mm"),t.offdutyHour.selected=i.format("H"),t.offdutyMinute.selected=i.format("mm"),t.ok=function(){t.project.onduty=String(t.ondutyHour.selected)+":"+String(t.ondutyMinute.selected),t.project.offduty=String(t.offdutyHour.selected)+":"+String(t.offdutyMinute.selected),o.project.update(t.project,function(){o.project.info(function(o){angular.forEach(angular.copy(e.Project),function(e,o){delete t.Project[e._id],t.Project.splice(t.Project.length-o-1,1)}),angular.forEach(angular.isArray(o.result)?o.result:[o.result],function(e){t.Project.push(e),t.Project[e._id]=e})}),r.AlertSuccess("更新成功")},r.AlertError),t.OnCancel=n.dismiss("cancel")},t.cancel=function(){t.OnCancel=n.dismiss("cancel")}}]}).result.then(function(){},function(){o.project.info(function(o){angular.forEach(angular.copy(e.Project),function(e,o){delete t.Project[e._id],t.Project.splice(t.Project.length-o-1,1)}),angular.forEach(angular.isArray(o.result)?o.result:[o.result],function(e){t.Project.push(e),t.Project[e._id]=e})})})}}]);