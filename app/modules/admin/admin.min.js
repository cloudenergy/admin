angular.module("app").controller("admin",["$scope","$rootScope","$cookies","$q","$state","$localStorage","$api",function(e,t,a,n,i,o,r){var c=this,l={dashboard:"home",character:"user",project:"archive",account:"briefcase",billingservice:"calculator",urlpath:"compass",building:"building",department:"diamond",customer:"yen",eventcategory:"envelope",energycategory:"database",energy:"fire",sensor:"dashboard",collector:"tasks",finance:"dollar",property:"dollar"},s=[{title:"首页",state:"admin.dashboard",ignore:!0},{title:"角色管理",state:"admin.character.info"},{title:"项目管理",state:"admin.project.info"},{title:"账户管理",state:"admin.account.info"},{title:"计费策略",state:"admin.billingservice.info"},{title:"地址管理",state:"admin.urlpath.info"},{title:"建筑管理",state:"admin.building.info"},{title:"商户管理",state:"admin.department.info"},{title:"社会属性",state:"admin.customer.index"},{title:"数据管理器",state:"admin.collector.info"},{title:"能耗配置",state:"admin.energycategory.info"},{title:"能耗分类",state:"admin.energy.index"},{title:"智能仪表管理",state:"admin.sensor.info"},{title:"事件配置",state:"admin.eventcategory.info"},{title:"平台财务",state:"admin.finance.index"},{title:"物业财务",state:"admin.property.index"}],d=[];t.layoutLoaded={},t.app={name:document.title,year:(new Date).getFullYear(),layout:angular.extend({isSmallSidebar:!1,isChatOpen:!1,isFixedHeader:!0,isFixedFooter:!1,isBoxed:!1,isStaticSidebar:!1,isRightSidebar:!1,isOffscreenOpen:!1,isConversationOpen:!1,isQuickLaunch:!1,sidebarTheme:"",headerTheme:""},o.layout||{}),isMessageOpen:!1,isConfigOpen:!1},e.user={avatar:"app/modules/admin/img/avatar.jpg?rev=0781880511",name:a.get("user")},e.wwwLink=location.origin.replace("preadmin.","pre.").replace("admin.","www."),e.$watchCollection("app.layout",function(e){o.layout=e}),e.$watch("$state.current.name",function(e){i.current.prefix=/^(\w+\.\w+)?/.exec(e)[0]||""}),e.$on("$includeContentRequested",function(e,a){/^app\/modules\/admin/.test(a)&&(t.layoutLoaded[a]=n.defer(),d.push(t.layoutLoaded[a].promise))}),e.$on("$includeContentLoaded",function(e,a){/^app\/modules\/admin/.test(a)&&t.layoutLoaded[a]&&t.layoutLoaded[a].resolve()}),n.all(d.concat([r.account.info({id:a.get("user")},function(e){EMAPP.Account=e.result||{},EMAPP.Rule={},function e(t,a,n){angular.forEach(t,function(t,i){"leaf"!==i&&(0===a?e(t,a+1,[i]):t.leaf?EMAPP.Rule[n.concat([i]).join(".")]=!0:e(t,a+1,n.concat([i])))})}(EMAPP.Account.character.rule["/"],0),angular.forEach(s,function(e){(e.ignore||EMAPP.Rule[e.state])&&(e.prefix=/^(\w+\.\w+)?/.exec(e.state)[0]||"",e.icon=l[e.state.split(".")[1]]||"circle",this.push(e))},c.menu=[])}).$promise,r.project.info(function(e){angular.forEach(EMAPP.Project=angular.isArray(e.result)?e.result:e.result&&[e.result]||[],function(e){EMAPP.Project[e._id]=e})}).$promise])).then(function(){if(EMAPP.Project.length){var e=EMAPP.Account._id+"_root_project_selected";EMAPP.Project.selected=EMAPP.Project[o[e]]||EMAPP.Project[0],t.Project=EMAPP.Project,t.$watch("Project.selected",function(t){o[e]=t._id}),t.layoutLoaded=!0}})}]);