"use strict";angular.module("app").controller("index",["$rootScope","$scope","$filter","$api","$timeout","$uibModal","SweetAlert",function(t,i,e,a,n,r,o){i.bossPageshow=!1,"yyhua"!==t.Account.user&&"dxc"!==t.Account.user&&"gugenie"!==t.Account.user&&"gugeyang"!==t.Account.user||(i.bossPageshow=!0),console.log(t);var l=moment().format("YYYYMMDD"),u=moment().subtract(1,"month").format("YYYYMMDD");i.config={dataLoaded:!0},i.mobilData={wx:[],zfb:[],wxgz:[]},i.arrearage=[],i.fundflow=[],i.projectInfo=[],i.accountbalance="",a.business.pltfundflow({flow:"EARNING",from:u,to:l,status:"SUCCESS"},function(t){var e=t.result,a=R.map(function(t){return{time:moment.unix(t.timepaid).format("MM[月]DD[日]"),amount:t.amount,origin:t.channelaccount.origin}})(e),n=R.map(function(t){for(var e=0,a="",n="",r=0;r<t.length;r++)e+=t[r].amount,a=t[r].time,n=t[r].origin;return{time:a,amount:e,origin:n}})(R.groupWith(function(t,e){return t.time===e.time},R.filter(function(t){return R.where({origin:R.equals("支付宝")})(t)},a))),r=R.map(function(t){for(var e=0,a="",n="",r=0;r<t.length;r++)e+=t[r].amount,a=t[r].time,n=t[r].origin;return{time:a,amount:e,origin:n}})(R.groupWith(function(t,e){return t.time===e.time},R.filter(function(t){return R.where({origin:R.equals("微信公众号")})(t)},a))),o=R.map(function(t){for(var e=0,a="",n="",r=0;r<t.length;r++)e+=t[r].amount,a=t[r].time,n=t[r].origin;return{time:a,amount:e,origin:n}})(R.groupWith(function(t,e){return t.time===e.time},R.filter(function(t){return R.where({origin:R.equals("微信")})(t)},a)));i.mobilData.wx=R.sortBy(R.prop("time"))(o),i.mobilData.zfb=R.sortBy(R.prop("time"))(r),i.mobilData.wxgz=R.sortBy(R.prop("time"))(n)}),a.business.projectfundflowstatistic({from:u,project:"5a17d653e94e70727a3f40c8",to:l},function(t){var e=t.result.earning.sum,a=t.result.department.balance,n=t.result.department.sum;i.fundflow.push({name:"宁波影秀城",earning:e,balance:a,arrearage:n})}),a.business.projectfundflowstatistic({from:u,project:"5c299f841ebec64f7adc50b1",to:l},function(t){var e=t.result.earning.sum,a=t.result.department.balance,n=t.result.department.sum;i.fundflow.push({name:"五迪中心",earning:e,balance:a,arrearage:n})}),a.business.projectfundflowstatistic({from:u,project:"5b3e1e9513761f16bc52292f",to:l},function(t){var e=t.result.earning.sum,a=t.result.department.balance,n=t.result.department.sum;i.fundflow.push({name:"中豪国际",earning:e,balance:a,arrearage:n})}),a.business.projectfundflowstatistic({from:u,project:"58754ff2dd5daebd43db9988",to:l},function(t){var e=t.result.earning.sum,a=t.result.department.balance,n=t.result.department.sum;i.fundflow.push({name:"杭州日信",earning:e,balance:a,arrearage:n})}),a.business.projectfundflowstatistic({from:u,project:"56713c947f0fd05911d382f4",to:l},function(t){var e=t.result.earning.sum,a=t.result.department.balance,n=t.result.department.sum;i.fundflow.push({name:"迪诺水镇",earning:e,balance:a,arrearage:n})}),a.project.info({ids:["5a17d653e94e70727a3f40c8","5c299f841ebec64f7adc50b1","5b3e1e9513761f16bc52292f","58754ff2dd5daebd43db9988","56713c947f0fd05911d382f4"],statistic:!0},function(t){i.projectInfo=R.map(function(t){var e="";switch(t.title){case"杭州日信科技有限公司":e="杭州日信";break;case"中豪国际大厦":e="中豪国际";break;default:e=t.title}return{departmentsNub:t.statistic.departments,devicesNub:t.statistic.devices,name:e}})(t.result)}),a.business.accountbalance({project:"PLT"},function(t){i.accountbalance={earning:t.result.earning,withdraw:t.result.withdraw}}),i.$watch("mobilData.wx+mobilData.zfb+mobilData.wxgz",function(){i.mobil={color:["#60CCFF","#73E085","#F0D010"],title:{text:"移动端充值",padding:[10,5,5,10],textStyle:{align:"center",fontSize:14,fontFamily:"PingFang-SC-Bold",fontWeight:"bold",color:"rgba(102, 102, 102, 1)",lineHeight:"20px",width:"100%"}},grid:{left:50,right:50,bottom:30},legend:{top:20,data:["支付宝","微信","公众号"]},tooltip:{trigger:"axis"},xAxis:{type:"category",data:R.map(function(t){return t.time})(i.mobilData.wx)},yAxis:{type:"value",name:"单位:千元"},series:[{name:"支付宝",data:0<i.mobilData.zfb.length?R.map(function(t){return(t.amount/1e3).toFixed(2)})(i.mobilData.zfb):[],type:"bar",barWidth:10,itemStyle:{normal:{barBorderRadius:5}}},{name:"微信",data:0<i.mobilData.wx.length?R.map(function(t){return(t.amount/1e3).toFixed(2)})(i.mobilData.wx):[],type:"bar",barWidth:10,itemStyle:{normal:{barBorderRadius:5}}},{name:"公众号",data:0<i.mobilData.wxgz.length?R.map(function(t){return(t.amount/1e3).toFixed(2)})(i.mobilData.wxgz):[],type:"bar",barWidth:10,itemStyle:{normal:{barBorderRadius:5}}}]}}),i.$watch("fundflow",function(t,e){i.mid1={title:{text:"平台收入排名",textAlign:"left",padding:[10,5,5,10],textStyle:{fontSize:14,fontFamily:"PingFang-SC-Bold",fontWeight:"bold",color:"rgba(102, 102, 102, 1)",lineHeight:"20px"}},tooltip:{},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",show:!1},yAxis:[{axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1},type:"category",data:R.map(function(t){return t.name})(R.sortBy(R.prop("earning"))(i.fundflow))},{axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1},type:"category",data:R.map(function(t){return t.earning})(R.sortBy(R.prop("earning"))(i.fundflow))}],series:[{type:"bar",data:R.map(function(t){return t.earning})(R.sortBy(R.prop("earning"))(i.fundflow)),barWidth:14,itemStyle:{normal:{barBorderRadius:7,color:function(t){return["rgba(254,133,79,.2)","rgba(254,133,79,.4)","rgba(rgba(254,133,79,.6)","rgba(254,133,79,.8)","rgba(254,133,79,1)"][t.dataIndex]}}}}]},i.mid2={title:{text:"平台余额排名",textAlign:"left",padding:[10,5,5,10],textStyle:{fontSize:14,fontFamily:"PingFang-SC-Bold",fontWeight:"bold",color:"rgba(102, 102, 102, 1)",lineHeight:"20px"}},tooltip:{},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1}},yAxis:[{axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1},type:"category",data:R.map(function(t){return t.name})(R.sortBy(R.prop("balance"))(i.fundflow))},{axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1},type:"category",data:R.map(function(t){return t.balance})(R.sortBy(R.prop("balance"))(i.fundflow))}],series:[{type:"bar",data:R.map(function(t){return t.balance})(R.sortBy(R.prop("balance"))(i.fundflow)),barWidth:14,itemStyle:{normal:{barBorderRadius:7,color:function(t){return["rgba(255,173,38,.2)","rgba(255,173,38,.4)","rgba(255,173,38,.6)","rgba(255,173,38,.8)","rgba(255,173,38,1)"][t.dataIndex]}}}}]},i.mid3={title:{text:"平台欠费排名",textAlign:"left",padding:[10,5,5,10],textStyle:{fontSize:14,fontFamily:"PingFang-SC-Bold",fontWeight:"bold",color:"rgba(102, 102, 102, 1)",lineHeight:"20px"}},tooltip:{},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",show:!1},yAxis:[{axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1},type:"category",inverse:!0,data:R.map(function(t){return t.name})(R.sortBy(R.prop("arrearage"))(i.fundflow))},{axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1},type:"category",inverse:!0,data:R.map(function(t){return Math.abs(t.arrearage)})(R.sortBy(R.prop("arrearage"))(i.fundflow))}],series:[{type:"bar",data:R.map(function(t){return Math.abs(t.arrearage)})(R.sortBy(R.prop("arrearage"))(i.fundflow)),barWidth:14,itemStyle:{normal:{barBorderRadius:7,color:function(t){return["rgba(105,192,255,1)","rgba(105,192,255,.8)","rgba(105,192,255,.6)","rgba(105,192,255,.4)","rgba(105,192,255,.2)"][t.dataIndex]}}}}]}},!0),i.$watch("projectInfo",function(){i.bottom1={color:["#69C0FF","#889DFF","#DB87FF","#FAD337","#6DEFD2"],title:{text:"平台商户数量统计",textAlign:"left",padding:[10,5,5,10],textStyle:{fontSize:14,fontFamily:"PingFang-SC-Bold",fontWeight:"bold",color:"rgba(102, 102, 102, 1)",lineHeight:"20px"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b} ({d}%)"},legend:{orient:"vertical",right:20,top:"middle",icon:"circle",data:R.map(function(t){return{name:t.name+" : "+t.departmentsNub+" 户"}})(i.projectInfo)},series:[{name:"平台商户数量统计",type:"pie",center:["30%","50%"],radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!1}},labelLine:{normal:{show:!1}},data:R.map(function(t){return{value:t.departmentsNub,name:t.name+" : "+t.departmentsNub+" 户"}})(i.projectInfo)}]},i.bottom2={color:["#69C0FF","#889DFF","#DB87FF","#FAD337","#6DEFD2"],title:{text:"平台仪表数量",textAlign:"left",padding:[10,5,5,10],textStyle:{fontSize:14,fontFamily:"PingFang-SC-Bold",fontWeight:"bold",color:"rgba(102, 102, 102, 1)",lineHeight:"20px"}},legend:{orient:"vertical",right:20,top:"middle",icon:"circle",data:R.map(function(t){return{name:t.name+" : "+t.devicesNub+" 个"}})(i.projectInfo)},tooltip:{trigger:"item",formatter:"{a} <br/>{b} ({d}%)"},series:[{name:"平台仪表数量",type:"pie",center:["30%","50%"],radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!1}},labelLine:{normal:{show:!1}},data:R.map(function(t){return{value:t.devicesNub,name:t.name+" : "+t.devicesNub+" 个",itemStyle:{normal:{borderWidth:5}}}})(i.projectInfo)}]}},!0),i.$watch("accountbalance",function(){i.bottom3={color:["#FF9768","#FB70AD"],title:{text:"平台流水统计",textAlign:"left",padding:[10,5,5,10],textStyle:{fontSize:14,fontFamily:"PingFang-SC-Bold",fontWeight:"bold",color:"rgba(102, 102, 102, 1)",lineHeight:"20px"}},legend:{orient:"vertical",right:20,top:"middle",icon:"circle",data:["收入 : "+i.accountbalance.earning+" 元","支出 : "+i.accountbalance.withdraw+" 元"]},tooltip:{trigger:"item",formatter:"{a} <br/>{b} ({d}%)"},series:[{name:"平台流水统计",type:"pie",center:["30%","50%"],radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!1}},labelLine:{normal:{show:!1}},data:[{value:i.accountbalance.withdraw,name:"支出 : "+i.accountbalance.withdraw+" 元"},{value:i.accountbalance.earning,name:"收入 : "+i.accountbalance.earning+" 元"}]}]}},!0)}]);