"use strict";angular.module("app").controller("BuildingSelect",["$scope","$uibModalInstance","$api","ProjectID","BuildingIDs",function(i,n,e,l,u){var s;if(i.Ok=function(){var e=[],l=[];i.viewOfBuildings[0].isEnable?e=i.viewOfBuildings[0].id:_.each(i.viewOfBuildings,function(i){var n=i.projectid&&i.projectid+"."||"";i.isEnable?e.push(n+i.id):l.push(n+i.id)}),n.close({select:e,unselect:l})},i.Cancel=function(){n.dismiss("cancel")},i.SwitchBuilding=function(n,e){n.preventDefault(),"*"==e.id?(_.each(i.viewOfBuildings,function(i){i.isEnable=!1}),e.isEnable=!e.isEnable):(i.viewOfBuildings[0].isEnable=!1,e.isEnable=!e.isEnable)},i.onSearchProject=function(n){n.preventDefault(),i.UpdateViewOfBuildings(i.buildingSearchKey)},i.UpdateViewOfBuildings=function(n){i.viewOfBuildings=[{id:"*",title:"所有建筑"}],n?_.each(s,function(e){e.title.match(n)&&i.viewOfBuildings.push(e)}):i.viewOfBuildings=_.union(i.viewOfBuildings,s);var e=!1;_.each(i.viewOfBuildings,function(i){_.contains(u,i.id)?(e=!0,i.isEnable=!0):i.isEnable=!1}),e||(i.viewOfBuildings[0].isEnable=!0)},u&&u.length){var t=[];_.each(u,function(i){t.push(i.replace(/.+\./g,""))}),u=t}e.building.info({project:l},function(n){s=n.result.detail,i.UpdateViewOfBuildings()})}]);