"use strict";angular.module("app").controller("BuildingSelect",["$scope","$uibModalInstance","$api","ProjectID","BuildingIDs",function(u,i,n,e,l){var t;if(u.Ok=function(){var e=[],l=[];u.viewOfBuildings[0].isEnable?e=u.viewOfBuildings[0].id:_.each(u.viewOfBuildings,function(i){var n=i.projectid&&i.projectid+"."||"";i.isEnable?e.push(n+i.id):l.push(n+i.id)}),i.close({select:e,unselect:l})},u.Cancel=function(){i.dismiss("cancel")},u.SwitchBuilding=function(i,n){i.preventDefault(),"*"==n.id?_.each(u.viewOfBuildings,function(i){i.isEnable=!1}):u.viewOfBuildings[0].isEnable=!1,n.isEnable=!n.isEnable},u.onSearchProject=function(i){i.preventDefault(),u.UpdateViewOfBuildings(u.buildingSearchKey)},u.UpdateViewOfBuildings=function(n){u.viewOfBuildings=[{id:"*",title:"所有建筑"}],n?_.each(t,function(i){i.title.match(n)&&u.viewOfBuildings.push(i)}):u.viewOfBuildings=_.union(u.viewOfBuildings,t);var e=!1;_.each(u.viewOfBuildings,function(i){_.contains(l,i.id)?(e=!0,i.isEnable=!0):i.isEnable=!1}),e||(u.viewOfBuildings[0].isEnable=!0)},l&&l.length){var s=[];_.each(l,function(i){s.push(i.replace(/.+\./g,""))}),l=s}n.building.info({project:e},function(i){t=i.result.detail,u.UpdateViewOfBuildings()})}]);