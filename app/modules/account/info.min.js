"use strict";angular.module("app").controller("accountInfo",["$scope","$api","UI","$uibModal",function(e,c,t,a){e.askingRemoveID=void 0,e.currentPage=1,e.getAccounts=function(){c.account.info({key:e.searchKey,pageindex:e.currentPage||1,pagesize:15},function(c){e.accounts=c.result},function(e){!/90000005|90000007/.test(e.code)&&t.AlertError(e)})},e.DoRemove=function(a,n,r){a.preventDefault(),c.account.delete({id:n},function(){e.accounts.accounts.splice(r,1)},t.AlertError)},e.AskForRemove=function(c,t){c.preventDefault(),e.askingRemoveID=t},e.CancelRemove=function(c){c.preventDefault(),e.askingRemoveID=void 0},e.$watch("currentPage",function(c){if(!c)return void e.getAccounts();e.getAccounts()}),e.onSearch=function(){e.getAccounts()},e.accountChange=function(e,n){var r={mobile:"mobileChange.html",title:"titleChange.html",email:"emailChange.html",character:"characterChange.html"};a.open({size:"sm",templateUrl:r[n],controller:["$scope","$uibModalInstance","$rootScope",function(a,n,r){a.account=angular.copy(e),a.title=a.account.title,c.character.info({power:r.Account.character&&r.Account.character.level},function(e){a.characters=e.result,a.characters.selected=a.account.character,a.characters.level=a.account.character&&a.account.character.level,void 0==a.characters.level?a.characters.level=a.characters[a.characters.length-1]:a.characters.level=_.find(a.characters,function(e){return e.level==a.characters.level})},t.AlertError),a.ok=function(){a.account.character=a.characters.selected._id,c.account.update(a.account,function(){a.account.character=a.characters.selected,angular.extend(e,a.account),t.AlertSuccess("更新成功")},t.AlertError),a.OnCancel=n.dismiss("cancel")},a.cancel=function(){a.OnCancel=n.dismiss("cancel")}}]})}}]);