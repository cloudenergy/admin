"use strict";angular.module("app").controller("accountInfo",["$scope","$api","UI","$uibModal",function(e,c,t,n){e.askingRemoveID=void 0,e.currentPage=1,e.getAccounts=function(){c.account.info({key:e.searchKey,pageindex:e.currentPage||1,pagesize:15},function(c){e.accounts=c.result},function(e){!/90000005|90000007/.test(e.code)&&t.AlertError(e)})},e.DoRemove=function(n,a,r){n.preventDefault(),c.account.delete({id:a},function(){e.accounts.accounts.splice(r,1)},t.AlertError)},e.AskForRemove=function(c,t){c.preventDefault(),e.askingRemoveID=t},e.CancelRemove=function(c){c.preventDefault(),e.askingRemoveID=void 0},e.$watch("currentPage",function(c){if(!c)return void e.getAccounts();e.getAccounts()}),e.onSearch=function(){e.getAccounts()},e.accountChange=function(a,r){var o={mobile:"mobileChange.html",title:"titleChange.html",email:"emailChange.html",character:"characterChange.html"},l=e;n.open({size:"sm",templateUrl:o[r],controller:["$scope","$uibModalInstance","$rootScope",function(e,n,r){e.account=a,e.title=e.account.title,c.character.info({power:r.Account.character&&r.Account.character.level},function(c){e.characters=c.result,e.characters.selected=e.account.character,e.characters.level=e.account.character&&e.account.character.level,void 0==e.characters.level?e.characters.level=e.characters[e.characters.length-1]:e.characters.level=_.find(e.characters,function(c){return c.level==e.characters.level})},t.AlertError),e.ok=function(){e.account.character=e.characters.selected._id,c.account.update(e.account,function(){l.getAccounts(),t.AlertSuccess("更新成功")},t.AlertError),e.OnCancel=n.dismiss("cancel")},e.cancel=function(){e.OnCancel=n.dismiss("cancel")}}]}).result.then(function(){},function(){e.getAccounts()})}}]);