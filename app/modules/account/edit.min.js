"use strict";angular.module("app").controller("accountEdit",["$rootScope","$scope","$stateParams","$q","$state","$api","UI",function(a,e,c,r,t,n,i){e.submit=function(a){var c={_id:e.account._id};return e.newpasswd!=e.repeatnewpasswd?void i.AlertError("二次密码输入不一致，请重新输入"):(e.newpasswd&&e.newpasswd.length&&(c.passwd=e.newpasswd),e.characters.level?(c.character=e.characters.level._id,c.title=e.account.title,c.mobile=e.account.mobile,c.email=e.account.email,c.message=Object.keys(e.warning).filter(function(a){return e.warning[a]?a:""}).join(","),e.account.initpath&&(c.initpath=e.account.initpath),void n.account.update(c,function(){i.AlertSuccess("更新成功"),t.go("admin.account.info")},i.AlertError)):void i.AlertError("请选择权限级别"))},r.all([n.account.info({id:a.Account._id}).$promise,n.account.info({id:c.id}).$promise]).then(function(a){e.adminUser=a[0].result,e.account=a[1].result;var c=e.account.message?e.account.message.split(","):[];e.warning={},angular.forEach(c,function(a){e.warning[a]=!0}),n.character.info({power:e.adminUser.character&&e.adminUser.character.level},function(a){e.characters=a.result,e.characters.level=e.account.character&&e.account.character.level,void 0==e.characters.level?e.characters.level=e.characters[e.characters.length-1]:e.characters.level=_.find(e.characters,function(a){return a.level==e.characters.level})},i.AlertError)})}]);