"use strict";angular.module("app").controller("accountEdit",["$rootScope","$scope","$stateParams","$q","$state","$api","SweetAlert",function(a,t,c,e,r,n,s){a.Account._id==c.id&&(t.self=!0),t.submit=function(c){var e={_id:t.account._id};t.newpasswd==t.repeatnewpasswd?(t.newpasswd&&t.newpasswd.length&&(e.passwd=t.newpasswd),t.characters.level?(e.character=t.characters.level._id,e.title=t.account.title,e.mobile=t.account.mobile,e.email=t.account.email,e.message=Object.keys(t.warning).filter(function(c){return t.warning[c]?c:""}).join(","),t.account.initpath&&(e.initpath=t.account.initpath),n.account.update(e,function(){a.User.$account().then(function(){s.success("更新成功"),r.go("admin.account.info")})},s.error)):s.error("请选择权限级别")):s.error("二次密码输入不一致，请重新输入")},e.all([n.account.info({id:a.Account._id}).$promise,n.account.info({id:c.id}).$promise]).then(function(c){t.adminUser=c[0].result,t.account=c[1].result;var e=t.account.message?t.account.message.split(","):[];t.warning={},angular.forEach(e,function(c){t.warning[c]=!0}),n.character.info({power:t.adminUser.character&&t.adminUser.character.level},function(c){t.characters=c.result,t.self&&t.characters.push(t.account.character),t.characters.level=t.account.character&&t.account.character.level,null==t.characters.level?t.characters.level=t.characters[t.characters.length-1]:t.characters.level=_.find(t.characters,function(c){return c.level==t.characters.level})},s.error)})}]);