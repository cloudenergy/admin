"use strict";angular.module("app").controller("accountEdit",["$rootScope","$scope","$stateParams","$q","$state","$api","UI",function(e,a,c,t,r,n,i){a.submit=function(e){var c={_id:a.account._id};return a.newpasswd!=a.repeatnewpasswd?void i.AlertError("二次密码输入不一致，请重新输入"):(a.newpasswd&&a.newpasswd.length&&(c.passwd=a.newpasswd),a.characters.level?(c.character=a.characters.level._id,c.title=a.account.title,c.mobile=a.account.mobile,c.email=a.account.email,c.message=Object.keys(a.warning).filter(function(e){return a.warning[e]?e:""}).join(","),a.account.initpath&&(c.initpath=a.account.initpath),void n.account.update(c,function(){i.AlertSuccess("更新成功"),r.go("admin.account.info")},function(e){i.AlertError(e.message)})):void i.AlertError("请选择权限级别"))},t.all([n.account.info({id:e.Account._id}).$promise,n.account.info({id:c.id}).$promise]).then(function(e){a.adminUser=e[0].result,a.account=e[1].result;var c=a.account.message?a.account.message.split(","):[];a.warning={},angular.forEach(c,function(e){a.warning[e]=!0}),n.character.info({power:a.adminUser.character&&a.adminUser.character.level},function(e){a.characters=e.result,a.characters.level=a.account.character&&a.account.character.level,void 0==a.characters.level?a.characters.level=a.characters[a.characters.length-1]:a.characters.level=_.find(a.characters,function(e){return e.level==a.characters.level})},function(e){i.AlertError(e.message)})})}]);