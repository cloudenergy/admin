"use strict";angular.module("app").controller("accountEdit",["$rootScope","$scope","$stateParams","$q","$state","$api","SweetAlert",function(e,c,a,t,r,n,i){e.Account._id==a.id&&(c.self=!0),c.submit=function(a){var t={_id:c.account._id};return c.newpasswd!=c.repeatnewpasswd?void i.error("二次密码输入不一致，请重新输入"):(c.newpasswd&&c.newpasswd.length&&(t.passwd=c.newpasswd),c.characters.level?(t.character=c.characters.level._id,t.title=c.account.title,t.mobile=c.account.mobile,t.email=c.account.email,t.message=Object.keys(c.warning).filter(function(e){return c.warning[e]?e:""}).join(","),c.account.initpath&&(t.initpath=c.account.initpath),void n.account.update(t,function(){e.User.$account().then(function(){i.success("更新成功"),r.go("admin.account.info")})},i.error)):void i.error("请选择权限级别"))},t.all([n.account.info({id:e.Account._id}).$promise,n.account.info({id:a.id}).$promise]).then(function(e){c.adminUser=e[0].result,c.account=e[1].result;var a=c.account.message?c.account.message.split(","):[];c.warning={},angular.forEach(a,function(e){c.warning[e]=!0}),n.character.info({power:c.adminUser.character&&c.adminUser.character.level},function(e){c.characters=e.result,c.self&&c.characters.push(c.account.character),c.characters.level=c.account.character&&c.account.character.level,void 0==c.characters.level?c.characters.level=c.characters[c.characters.length-1]:c.characters.level=_.find(c.characters,function(e){return e.level==c.characters.level})},i.error)})}]);