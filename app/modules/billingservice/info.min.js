"use strict";angular.module("app").component("billingserviceInfo",{templateUrl:"app/modules/billingservice/info.html?rev=38cae1b74f",controller:["$rootScope","$api","SweetAlert","$state","$scope","ToFloat","$uibModal",function(e,n,t,i,r,o,s){var l=this;r.currentPage=1,r.pageSize=15,l.askingRemoveID=void 0,l.PadShow=[],l.settingUserInfo=void 0,l.askingRemoveID=void 0,l.tab=i.current.name.split(".")[i.current.name.split(".").length-1],n.billingservice.info({project:e.Project.selected._id,verbose:!1},function(e){angular.isArray(e.result)?l.billingservices=e.result:(l.billingservices=[],l.billingservices.push(e.result)),angular.forEach(l.billingservices,function(e){e.rules.fixprice=o(e.rules.fixprice)})},function(){delete l.billingservices}),l.DoRemove=function(e,i,o){e.preventDefault(),n.billingservice.delete({id:i},function(){l.billingservices.splice(r.pageSize*(r.currentPage-1)+o,1)},t.error)},l.AskForRemove=function(e,n){e.preventDefault(),l.askingRemoveID=n},l.CancelRemove=function(e,n){e.preventDefault(),l.askingRemoveID=void 0},l.OnSelectSensor=function(e,n){e.preventDefault(),s.open({templateUrl:"modal-channelselectUpdate.html",controller:"ChannelSelectUpdate",size:"lg",resolve:{billingserviceID:function(){return n.id},ProjectID:function(){return n.projectid},DeleteIDS:function(){return l.DeleteIDS||[]},DeleteSensors:function(){return l.DeleteSensors||[]},SelectedSensors:function(){return l.SelectSensors||[]},SelectedSensorsIDS:function(){return l.SelectedSensorsIDS||[]}}})}}]}),angular.module("app").controller("ChannelSelectUpdate",["$scope","$rootScope","$uibModal","$uibModalInstance","$api","ProjectID","SelectedSensors","SelectedSensorsIDS","DeleteIDS","DeleteSensors","$stateParams","$state","SweetAlert","billingserviceID",function(e,n,t,i,r,o,s,l,c,a,u,f,d,S){var p;e.currentPage=1,e.project=o,e.popPageSize=8,e.UpdateAffirm=function(){t.open({templateUrl:"UpdateAffirm.html",size:"md",resolve:{DeleteIDS:function(){return c||[]},SelectedSensorsIDS:function(){return l||[]},removeSensor:function(){return a||[]},addSensor:function(){return s||[]}},controller:["DeleteIDS","SelectedSensorsIDS","$scope","$uibModalInstance","removeSensor","addSensor",function(e,t,i,o,s,l){i.addSensor=l,i.removeSensor=s,i.DeleteIDS=e,i.SelectedSensorsIDS=t,i.Ok=function(){o.dismiss("cancel"),r.billingservice.update({id:S,projectid:n.Project.selected._id,removeChannels:e||void 0,addChannels:t||void 0},function(){d.success("修改计费仪表成功"),f.go("admin.billingservice.info",{},{reload:!0})},d.error)},i.Cancel=function(){o.dismiss("cancel")}}]}).result.then(function(e){},function(){})},e.Ok=function(){angular.forEach(p,function(e){e.preEnable!=e.isEnable&&(e.isEnable?(s.push(e),l.push(e.id)):(c.push(e.id),a.push(e)))}),(c.length||l.length)&&e.UpdateAffirm(),i.dismiss("cancel")},e.Cancel=function(){i.dismiss("cancel")},e.SwitchSensor=function(e,n){e.preventDefault(),n.isEnable=!n.isEnable},e.onSearchSensor=function(n){n.preventDefault(),e.UpdateViewOfSensors(e.sensorSearchKey)},e.OnSelectAll=function(n){n.preventDefault(),angular.forEach(e.viewOfSensors,function(e){e.isEnable=!0})},e.UpdateViewOfSensors=function(n){e.viewOfSensors=[],n?angular.forEach(p,function(t){t.title.match(n)||t.addrid.match(n)?e.viewOfSensors.push(t):t.channel&&t.channel.match(n)&&e.viewOfSensors.push(t)}):e.viewOfSensors=_.union(e.viewOfSensors,p)},e.$watch("devicetype.selected",function(n){e.viewOfSensors=[],angular.forEach(p,function(t){t.devicetype.match(n.id)&&e.viewOfSensors.push(t)})}),r.billingservice.equipments({project:o,strategyid:S,SHOWALL:!0},function(n){p=n.result,angular.forEach(p,function(e){e.isEnable=e.selected,e.preEnable=e.selected}),e.UpdateViewOfSensors()}.bind(this)),r.device.type({project:o},function(n){e.devicetype=n.result})}]);