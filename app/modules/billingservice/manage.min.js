"use strict";angular.module("app").component("billingUpdate",{templateUrl:"app/modules/billingservice/manage.html?rev=b88a09ffa7",controller:["$rootScope","$api","$state","SweetAlert","$uibModal","$scope","$timeout","$stateParams",function(e,i,o,r,t,n,u,s){var a=this;a.times=[],a.date=[],a.viewSensors=[],a.SelectedSensorsIDS=[],(a.GetInfo=function(){i.billingservice.info({id:o.params.id},function(e){if(e=e.result,a.serviceTitle=e.title,e.rules){if(a.advanced=!0,e.rules.timequantumprice||e.rules.week||e.rules.day||(a.advanced=!1),e.rules.timequantumprice){var i={},o=0;angular.forEach(e.rules.timequantumprice,function(r,t){o++,i.price!==r?(angular.isUndefined(i.price)||(i.HourTo||(i.HourTo=i.HourFrom+1),a.times.push(i),i={}),i.HourFrom=t,i.price=r,o===e.rules.timequantumprice.length&&(i.HourTo=t+1,24==i.HourTo&&(i.HourTo=0),a.times.push(i))):(i.HourTo=t+1,24==i.HourTo&&(i.HourTo=0),o===e.rules.timequantumprice.length&&a.times.push(i))})}else a.times=[{HourFrom:void 0,HourTo:void 0,price:void 0},{HourFrom:void 0,HourTo:void 0,price:void 0}],a.fixprice=e.rules.fixprice;a.equipments=e.equipments,u(function(){a.setSelectChecked()},100)}})})(),a.hours=[];for(var c=0;c<24;c++)a.hours.push(c);a.addTime=function(){a.times.push({HourFrom:void 0,HourTo:void 0,price:void 0})},a.removeTime=function(e){a.times.splice(e,1)},a.submit=function(){var t=document.getElementsByClassName("hourFrom"),n=document.getElementsByClassName("hourTo"),u={},c=!0;if(angular.forEach(t,function(e){Number(e.value)||0==e.value||(c=!1)}),angular.forEach(n,function(e){Number(e.value)||0==e.value||(c=!1)}),!c)return r.info("请选择日期"),!1;a.advanced?(u.timequantumprice=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],angular.forEach(a.times,function(e){if(Number(e.HourFrom)<Number(e.HourTo))for(var i=Number(e.HourFrom);i<Number(e.HourTo);i++)u.timequantumprice[i]=e.price}),angular.forEach(u.timequantumprice,function(e,i){void 0===e&&(u.timequantumprice[i]=0)})):u.fixprice=a.fixprice,i.billingservice.update({id:s.id,title:a.serviceTitle,projectid:e.Project.selected._id,rules:u},function(){r.success("保存成功"),o.go("admin.billingservice.info")},r.error)},a.setSelectChecked=function(){var e=document.getElementsByClassName("hourFrom"),i=document.getElementsByClassName("hourTo");angular.forEach(e,function(e,i){for(var o=0;o<e.options.length;o++)if(String(e.options[o].innerHTML)==String(a.times[i].HourFrom)){e.options[o].selected=!0;break}}),angular.forEach(i,function(e,i){for(var o=0;o<e.options.length;o++)if(String(e.options[o].innerHTML)==String(a.times[i].HourTo)){e.options[o].selected=!0;break}})},a.changeSensor=function(){t.open({component:"billingserviceSensorSelect",size:"lg",backdrop:"static",resolve:{strategyid:function(){return s.id},projectid:function(){return e.Project.selected._id}}}).result.then(function(){a.GetInfo()})}}]});