"use strict";angular.module("app").component("billingUpdate",{templateUrl:"app/modules/billingservice/manage.html?rev=e7c1c78ee5",controller:["$rootScope","$api","$state","SweetAlert","$uibModal","$scope","$timeout","$stateParams",function(t,n,u,c,e,i,s,a){var d=this;d.times=[],d.date=[],d.viewSensors=[],d.SelectedSensorsIDS=[],(d.GetInfo=function(){n.billingservice.info({id:u.params.id},function(o){if(o=o.result,d.serviceTitle=o.title,o.rules){if(d.advanced=!0,o.rules.timequantumprice||o.rules.week||o.rules.day||(d.advanced=!1),o.rules.timequantumprice){var r={},t=0;angular.forEach(o.rules.timequantumprice,function(e,i){t++,r.price!==e?(angular.isUndefined(r.price)||(r.HourTo||(r.HourTo=r.HourFrom+1),d.times.push(r),r={}),r.HourFrom=i,r.price=e,t===o.rules.timequantumprice.length&&(r.HourTo=i+1,24==r.HourTo&&(r.HourTo=0),d.times.push(r))):(r.HourTo=i+1,24==r.HourTo&&(r.HourTo=0),t===o.rules.timequantumprice.length&&d.times.push(r))})}else d.times=[{HourFrom:void 0,HourTo:void 0,price:void 0},{HourFrom:void 0,HourTo:void 0,price:void 0}],d.fixprice=o.rules.fixprice;d.equipments=o.equipments,s(function(){d.setSelectChecked()},100)}})})(),d.hours=[];for(var o=0;o<24;o++)d.hours.push(o);d.addTime=function(){d.times.push({HourFrom:void 0,HourTo:void 0,price:void 0})},d.removeTime=function(e){d.times.splice(e,1)},d.submit=function(){var e=document.getElementsByClassName("hourFrom"),i=document.getElementsByClassName("hourTo"),o={},r=!0;if(angular.forEach(e,function(e){Number(e.value)||0==e.value||(r=!1)}),angular.forEach(i,function(e){Number(e.value)||0==e.value||(r=!1)}),!r)return c.info("请选择日期"),!1;d.advanced?(o.timequantumprice=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],angular.forEach(d.times,function(e){if(Number(e.HourFrom)<Number(e.HourTo))for(var i=Number(e.HourFrom);i<Number(e.HourTo);i++)o.timequantumprice[i]=e.price}),angular.forEach(o.timequantumprice,function(e,i){void 0===e&&(o.timequantumprice[i]=0)})):o.fixprice=d.fixprice,n.billingservice.update({id:a.id,title:d.serviceTitle,projectid:t.Project.selected._id,rules:o},function(){c.success("保存成功"),u.go("admin.billingservice.info")},c.error)},d.setSelectChecked=function(){var e=document.getElementsByClassName("hourFrom"),i=document.getElementsByClassName("hourTo");angular.forEach(e,function(e,i){for(var o=0;o<e.options.length;o++)if(String(e.options[o].innerHTML)==String(d.times[i].HourFrom)){e.options[o].selected=!0;break}}),angular.forEach(i,function(e,i){for(var o=0;o<e.options.length;o++)if(String(e.options[o].innerHTML)==String(d.times[i].HourTo)){e.options[o].selected=!0;break}})},d.changeSensor=function(){e.open({component:"billingserviceSensorSelect",size:"lg",backdrop:"static",resolve:{strategyid:function(){return a.id},projectid:function(){return t.Project.selected._id}}}).result.then(function(){d.GetInfo()})}}]});