"use strict";angular.module("app").component("billingUpdate",{templateUrl:"app/modules/billingservice/manage.html?rev=76e78d5385",controller:["$rootScope","$api","$state","SweetAlert","$uibModal","$scope","$timeout","$stateParams",function(e,i,o,r,t,n,u,s){var c=this;c.times=[],c.date=[],c.viewSensors=[],c.SelectedSensorsIDS=[],(c.GetInfo=function(){i.billingservice.info({id:o.params.id},function(e){if(e=e.result,c.serviceTitle=e.title,e.rules){if(c.advanced=!0,e.rules.timequantumprice||e.rules.week||e.rules.day||(c.advanced=!1),e.rules.timequantumprice){var i={},o=0;angular.forEach(e.rules.timequantumprice,function(r,t){o++,i.price!==r?(angular.isUndefined(i.price)||(i.HourTo||(i.HourTo=i.HourFrom+1),c.times.push(i),i={}),i.HourFrom=t,i.price=r,o===e.rules.timequantumprice.length&&(i.HourTo=t+1,24==i.HourTo&&(i.HourTo=0),c.times.push(i))):(i.HourTo=t+1,24==i.HourTo&&(i.HourTo=0),o===e.rules.timequantumprice.length&&c.times.push(i))})}else c.times=[{HourFrom:void 0,HourTo:void 0,price:void 0},{HourFrom:void 0,HourTo:void 0,price:void 0}],c.fixprice=e.rules.fixprice;c.equipments=e.equipments,u(function(){c.setSelectChecked()},100)}})})(),c.hours=[];for(var a=0;a<24;a++)c.hours.push(a);c.addTime=function(){c.times.push({HourFrom:void 0,HourTo:void 0,price:void 0})},c.removeTime=function(e){c.times.splice(e,1)},c.submit=function(){var t=document.getElementsByClassName("hourFrom"),n=document.getElementsByClassName("hourTo"),u={},a=!0;if(angular.forEach(t,function(e){Number(e.value)||0==e.value||(a=!1)}),angular.forEach(n,function(e){Number(e.value)||0==e.value||(a=!1)}),!a)return r.info("请选择日期"),!1;c.advanced?(u.timequantumprice=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],angular.forEach(c.times,function(e){if(Number(e.HourFrom)<Number(e.HourTo))for(var i=Number(e.HourFrom);i<Number(e.HourTo);i++)u.timequantumprice[i]=e.price}),angular.forEach(u.timequantumprice,function(e,i){void 0===e&&(u.timequantumprice[i]=0)})):u.fixprice=c.fixprice,i.billingservice.update({id:s.id,title:c.serviceTitle,projectid:e.Project.selected._id,rules:u},function(){r.success("保存成功"),o.go("admin.billingservice.info")},r.error)},c.setSelectChecked=function(){var e=document.getElementsByClassName("hourFrom"),i=document.getElementsByClassName("hourTo");angular.forEach(e,function(e,i){for(var o=0;o<e.options.length;o++)if(String(e.options[o].innerHTML)==String(c.times[i].HourFrom)){e.options[o].selected=!0;break}}),angular.forEach(i,function(e,i){for(var o=0;o<e.options.length;o++)if(String(e.options[o].innerHTML)==String(c.times[i].HourTo)){e.options[o].selected=!0;break}})},c.changeSensor=function(){t.open({component:"billingserviceSensorSelect",size:"lg",backdrop:"static",resolve:{strategyid:function(){return s.id},projectid:function(){return e.Project.selected._id}}}).result.then(function(){c.GetInfo()})}}]});