"use strict";angular.module("app").component("billingUpdate",{templateUrl:"app/modules/billingservice/manage.html?rev=30dd21a9c1",controller:["$rootScope","$api","$state","SweetAlert","$uibModal","$scope","$timeout","$stateParams",function(e,i,o,r,t,n,u,c){var s=this;s.times=[],s.date=[],s.viewSensors=[],s.SelectedSensorsIDS=[],(s.GetInfo=function(){i.billingservice.info({id:o.params.id},function(e){if(e=e.result,s.serviceTitle=e.title,e.rules){if(s.advanced=!0,e.rules.timequantumprice||e.rules.week||e.rules.day||(s.advanced=!1),e.rules.timequantumprice){var i={},o=0;angular.forEach(e.rules.timequantumprice,function(r,t){o++,i.price!==r?(angular.isUndefined(i.price)||(i.HourTo||(i.HourTo=i.HourFrom+1),s.times.push(i),i={}),i.HourFrom=t,i.price=r,o===e.rules.timequantumprice.length&&(i.HourTo=t+1,24==i.HourTo&&(i.HourTo=0),s.times.push(i))):(i.HourTo=t+1,24==i.HourTo&&(i.HourTo=0),o===e.rules.timequantumprice.length&&s.times.push(i))})}else s.times=[{HourFrom:void 0,HourTo:void 0,price:void 0},{HourFrom:void 0,HourTo:void 0,price:void 0}],s.fixprice=e.rules.fixprice;s.equipments=e.equipments,u(function(){s.setSelectChecked()},100)}})})(),s.hours=[];for(var a=0;a<24;a++)s.hours.push(a);s.addTime=function(){s.times.push({HourFrom:void 0,HourTo:void 0,price:void 0})},s.removeTime=function(e){s.times.splice(e,1)},s.submit=function(){var t=document.getElementsByClassName("hourFrom"),n=document.getElementsByClassName("hourTo"),u={},a=!0;if(angular.forEach(t,function(e){Number(e.value)||0==e.value||(a=!1)}),angular.forEach(n,function(e){Number(e.value)||0==e.value||(a=!1)}),!a)return r.info("请选择日期"),!1;s.advanced?(u.timequantumprice=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],angular.forEach(s.times,function(e){if(Number(e.HourFrom)<Number(e.HourTo))for(var i=Number(e.HourFrom);i<Number(e.HourTo);i++)u.timequantumprice[i]=e.price}),angular.forEach(u.timequantumprice,function(e,i){void 0===e&&(u.timequantumprice[i]=0)})):u.fixprice=s.fixprice,i.billingservice.update({id:c.id,title:s.serviceTitle,projectid:e.Project.selected._id,rules:u},function(){r.success("保存成功"),o.go("admin.billingservice.info")},r.error)},s.setSelectChecked=function(){var e=document.getElementsByClassName("hourFrom"),i=document.getElementsByClassName("hourTo");angular.forEach(e,function(e,i){for(var o=0;o<e.options.length;o++)if(String(e.options[o].innerHTML)==String(s.times[i].HourFrom)){e.options[o].selected=!0;break}}),angular.forEach(i,function(e,i){for(var o=0;o<e.options.length;o++)if(String(e.options[o].innerHTML)==String(s.times[i].HourTo)){e.options[o].selected=!0;break}})},s.changeSensor=function(){t.open({component:"billingserviceSensorSelect",size:"lg",backdrop:"static",resolve:{strategyid:function(){return c.id},projectid:function(){return e.Project.selected._id}}}).result.then(function(){s.GetInfo()})}}]});