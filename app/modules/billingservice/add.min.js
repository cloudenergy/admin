"use strict";angular.module("app").component("billingAdd",{templateUrl:"app/modules/billingservice/add.html?rev=e6b3280f2a",controller:["$rootScope","$api","$state","SweetAlert","$uibModal","$scope",function(e,o,n,r,i,t){var s=this;s.hours=[];for(var a=0;a<24;a++)s.hours.push(a);s.onDuty=e.Project.selected.onduty.split(":")[0],s.offDuty=e.Project.selected.offduty.split(":")[0],s.times=[{HourFrom:s.onDuty,HourTo:s.offDuty,price:void 0},{HourFrom:s.offDuty,HourTo:s.onDuty,price:void 0}],s.addTime=function(){s.times.push({HourFrom:void 0,HourTo:void 0,price:void 0})},s.removeTime=function(e){s.times.splice(e,1)},s.setSelectChecked=function(){var e=document.getElementsByClassName("hourFrom"),o=document.getElementsByClassName("hourTo");angular.forEach(e,function(e,o){for(var n=0;n<e.options.length;n++)if(String(e.options[n].innerHTML)==String(s.times[o].HourFrom)){e.options[n].selected=!0;break}}),angular.forEach(o,function(e,o){for(var n=0;n<e.options.length;n++)if(String(e.options[n].innerHTML)==String(s.times[o].HourTo)){e.options[n].selected=!0;break}})},s.submit=function(){var i=document.getElementsByClassName("hourFrom"),t=document.getElementsByClassName("hourTo"),a={},c=!0;return angular.forEach(i,function(e){Number(e.value)||0==e.value||(c=!1)}),angular.forEach(t,function(e){Number(e.value)||0==e.value||(c=!1)}),c?s.SelectedSensorsIDS&&s.SelectedSensorsIDS.length?(s.advanced?(a.timequantumprice=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],angular.forEach(s.times,function(e){if(Number(e.HourFrom)<Number(e.HourTo))for(var o=Number(e.HourFrom);o<Number(e.HourTo);o++)a.timequantumprice[o]=e.price;else for(var o=0;o<24;o++)void 0===a.timequantumprice[o]&&(a.timequantumprice[o]=e.price)}),angular.forEach(a.timequantumprice,function(e){void 0===e&&(e=0)})):a.fixprice=s.fixprice,void o.billingservice.add({title:s.serviceTitle,projectid:e.Project.selected._id,channels:s.SelectedSensorsIDS,rules:a},function(){r.success("保存成功"),n.go("admin.billingservice.info")},r.error)):(r.warning("请选择计费仪表"),!1):(r.warning("请选择日期"),!1)},s.OnSelectSensor=function(o){o.preventDefault(),i.open({templateUrl:"modal-channelselectAdd.html",controller:"ChannelSelectAdd",size:"lg",resolve:{ProjectID:function(){return e.Project.selected._id},SelectedSensors:function(){return t.SelectSensors||[]},SelectedSensorsIDS:function(){return s.SelectedSensorsIDS}}}).result.then(function(e){s.SelectSensors=e.SelectedSensors,s.SelectedSensorsIDS=e.SelectedSensorsIDS},function(){})}}]}),angular.module("app").controller("ChannelSelectAdd",["$scope","$rootScope","$uibModalInstance","$api","ProjectID","SelectedSensors","SelectedSensorsIDS","SweetAlert",function(e,o,n,r,i,t,s,a){var c;e.currentPage=1,e.project=i,e.popPageSize=8,e.Ok=function(){s=[],angular.forEach(t,function(e){~s.indexOf(e.id)||s.push(e.id)}),n.close({SelectedSensors:t,SelectedSensorsIDS:s})},e.Cancel=function(){n.dismiss("cancel")},e.SwitchSensor=function(o,n){o.preventDefault(),t=[],n.isEnable=!n.isEnable,angular.forEach(e.allSensor,function(o,n){angular.forEach(e.viewOfSensors,function(e){o.id==e.id&&(o.isEnable=e.isEnable)}),1==o.isEnable&&t.push(o)})},e.onSearchSensor=function(o){o.preventDefault(),e.UpdateViewOfSensors(e.sensorSearchKey)},e.OnSelectAll=function(o){o.preventDefault(),angular.forEach(e.viewOfSensors,function(e){e.isEnable=!0,t.push(e)})},e.allSensor=[],e.UpdateViewOfSensors=function(o){r.billingservice.equipments({projectid:i,pagesize:8,key:o,pageindex:e.pageindex},function(o){c=o.result.detail,e.pageindex=o.result.paging.pageindex,e.pagesize=o.result.paging.pagesize,e.pagecount=o.result.paging.count,angular.forEach(c,function(o){o.isEnable=!1,e.allSensor.push(o)}),e.viewOfSensors=c,angular.forEach(e.viewOfSensors,function(o){angular.forEach(e.allSensor,function(e){o.id==e.id&&(o.isEnable=e.isEnable)})})},function(){a.error("未找到该仪表")})},e.$watch("pageindex",function(){e.UpdateViewOfSensors(e.sensorSearchKey)})}]);