"use strict";angular.module("app").component("billingAdd",{templateUrl:"app/modules/billingservice/add.html?rev=0dee9daa8c",controller:["$rootScope","$api","$state","UI","$uibModal","$scope",function(e,o,n,r,t,i){var s=this;s.hours=[];for(var c=0;c<24;c++)s.hours.push(c);s.onDuty=e.Project.selected.onduty.split(":")[0],s.offDuty=e.Project.selected.offduty.split(":")[0],s.times=[{HourFrom:s.onDuty,HourTo:s.offDuty,price:void 0},{HourFrom:s.offDuty,HourTo:s.onDuty,price:void 0}],s.addTime=function(){s.times.push({HourFrom:void 0,HourTo:void 0,price:void 0})},s.removeTime=function(e){s.times.splice(e,1)},s.setSelectChecked=function(){var e=document.getElementsByClassName("hourFrom"),o=document.getElementsByClassName("hourTo");angular.forEach(e,function(e,o){for(var n=0;n<e.options.length;n++)if(String(e.options[n].innerHTML)==String(s.times[o].HourFrom)){e.options[n].selected=!0;break}}),angular.forEach(o,function(e,o){for(var n=0;n<e.options.length;n++)if(String(e.options[n].innerHTML)==String(s.times[o].HourTo)){e.options[n].selected=!0;break}})},s.submit=function(){var t=document.getElementsByClassName("hourFrom"),i=document.getElementsByClassName("hourTo"),c={},u=!0;return angular.forEach(t,function(e){Number(e.value)||0==e.value||(u=!1)}),angular.forEach(i,function(e){Number(e.value)||0==e.value||(u=!1)}),u?s.SelectedSensorsIDS&&s.SelectedSensorsIDS.length?(s.advanced?(c.timequantumprice=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],angular.forEach(s.times,function(e){if(Number(e.HourFrom)<Number(e.HourTo))for(var o=Number(e.HourFrom);o<Number(e.HourTo);o++)c.timequantumprice[o]=e.price;else for(var o=0;o<24;o++)void 0===c.timequantumprice[o]&&(c.timequantumprice[o]=e.price)}),angular.forEach(c.timequantumprice,function(e){void 0===e&&(e=0)})):c.fixprice=s.fixprice,void o.billingservice.add({title:s.serviceTitle,projectid:e.Project.selected._id,channels:s.SelectedSensorsIDS,rules:c},function(){r.AlertSuccess("保存成功"),n.go("admin.billingservice.info")},r.AlertError)):(r.AlertWarning("请选择计费仪表"),!1):(r.AlertWarning("请选择日期"),!1)},s.OnSelectSensor=function(o){o.preventDefault(),t.open({templateUrl:"modal-channelselectAdd.html",controller:"ChannelSelectAdd",size:"lg",resolve:{ProjectID:function(){return e.Project.selected._id},SelectedSensors:function(){return i.SelectSensors||[]},SelectedSensorsIDS:function(){return s.SelectedSensorsIDS}}}).result.then(function(e){s.SelectSensors=e.SelectedSensors,s.SelectedSensorsIDS=e.SelectedSensorsIDS},function(){})}}]}),angular.module("app").controller("ChannelSelectAdd",["$scope","$rootScope","$uibModalInstance","$api","ProjectID","SelectedSensors","SelectedSensorsIDS",function(e,o,n,r,t,i,s){var c;e.currentPage=1,e.project=t,e.popPageSize=8,e.Ok=function(){s=[],angular.forEach(i,function(e){s.push(e.id)}),n.close({SelectedSensors:i,SelectedSensorsIDS:s})},e.Cancel=function(){n.dismiss("cancel")},e.SwitchSensor=function(o,n){o.preventDefault(),i=[],n.isEnable=!n.isEnable,angular.forEach(e.viewOfSensors,function(e,o){1==e.isEnable&&i.push(e)})},e.onSearchSensor=function(o){o.preventDefault(),e.UpdateViewOfSensors(e.sensorSearchKey)},e.OnSelectAll=function(o){o.preventDefault(),angular.forEach(e.viewOfSensors,function(e){e.isEnable=!0,i.push(e)})},e.UpdateViewOfSensors=function(o){e.viewOfSensors=[],o?_.each(c,function(n){n.title.match(o)?e.viewOfSensors.push(n):n.addrid&&n.addrid.match(o)&&e.viewOfSensors.push(n)}):e.viewOfSensors=_.union(e.viewOfSensors,c),angular.forEach(e.viewOfSensors,function(e){angular.forEach(s,function(o){o==e.id&&(e.isEnable=!0)})})},r.billingservice.equipments({projectid:t},function(o){c=o.result.detail,e.UpdateViewOfSensors()}.bind(this),function(){c=[],e.UpdateViewOfSensors()})}]);