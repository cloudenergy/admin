"use strict";angular.module("app").component("billingAdd",{templateUrl:"app/modules/billingservice/add.html?rev=c7492e547d",controller:["$rootScope","$api","$state","UI","$uibModal","$scope",function(e,n,o,t,i,r){var s=this;s.months=["01","02","03","04","05","06","07","08","09","10","11","12"],s.days=[];for(var c=1;c<=31;c++)if(c<10){var a="0"+String(c);s.days.push(a)}else s.days.push(String(c));s.weeks=[{index:1,title:"一"},{index:2,title:"二"},{index:3,title:"三"},{index:4,title:"四"},{index:5,title:"五"},{index:6,title:"六"},{index:7,title:"日"}],s.week=!0,s.hours=[];for(var c=0;c<24;c++)s.hours.push(c);s.times=[{HourFrom:"8",HourTo:"22",price:void 0},{HourFrom:"22",HourTo:"8",price:void 0}],s.addTime=function(){s.times.push({HourFrom:void 0,HourTo:void 0,price:void 0})},s.removeTime=function(e){s.times.splice(e,1)},s.date=[{month:void 0,day:void 0}],s.addDate=function(){s.date.push({month:void 0,day:void 0})},s.removeDate=function(e){s.date.splice(e,1)},s.SelectWeek=function(e,n){e.preventDefault(),s.selectWeeks&&s.selectWeeks.length||(s.selectWeeks=[0,0,0,0,0,0,0]),s.selectWeeks[n]?s.selectWeeks[n]=0:s.selectWeeks[n]=n+1},s.setSelectChecked=function(){var e=document.getElementsByClassName("hourFrom"),n=document.getElementsByClassName("hourTo"),o=document.getElementsByClassName("month"),t=document.getElementsByClassName("day");angular.forEach(e,function(e,n){for(var o=0;o<e.options.length;o++)if(String(e.options[o].innerHTML)==String(s.times[n].HourFrom)){e.options[o].selected=!0;break}}),angular.forEach(n,function(e,n){for(var o=0;o<e.options.length;o++)if(String(e.options[o].innerHTML)==String(s.times[n].HourTo)){e.options[o].selected=!0;break}}),angular.forEach(o,function(e,n){for(var o=0;o<e.options.length;o++)if(String(e.options[o].innerHTML)==String(s.date[n].month)){e.options[o].selected=!0;break}}),angular.forEach(t,function(e,n){for(var o=0;o<e.options.length;o++)if(String(e.options[o].innerHTML)==String(s.date[n].day)){e.options[o].selected=!0;break}})},s.submit=function(){var i={};s.advanced&&s.day&&(i.day=[],angular.forEach(s.date,function(e){var n=String(e.month)+String(e.day);i.day.push(n)})),s.advanced&&s.week&&(i.week=s.selectWeeks),s.timePrice&&(i.timequantumprice=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],angular.forEach(s.times,function(e){if(Number(e.HourFrom)<Number(e.HourTo))for(var n=Number(e.HourFrom);n<Number(e.HourTo);n++)i.timequantumprice[n]=e.price;else for(var n=0;n<24;n++)void 0===i.timequantumprice[n]&&(i.timequantumprice[n]=e.price)}),angular.forEach(i.timequantumprice,function(e){void 0===e&&(e=0)})),s.timePrice||(i.fixprice=s.fixprice),r.OnSelectSensor=function(e){e.preventDefault()},n.billingservice.add({title:s.serviceTitle,projectid:e.Project.selected._id,channels:s.SelectedSensorsIDS,rules:i},function(){t.AlertSuccess("保存成功"),o.go("admin.billingservice.info")},t.AlertError)},s.OnSelectSensor=function(n){n.preventDefault(),i.open({templateUrl:"modal-channelselect.html",controller:"ChannelSelect",size:"lg",resolve:{ProjectID:function(){return e.Project.selected._id},SelectedSensors:function(){return r.SelectSensors||[]},SelectedSensorsIDS:function(){return s.SelectedSensorsIDS}}}).result.then(function(e){s.SelectSensors=e.SelectedSensors,s.SelectedSensorsIDS=e.SelectedSensorsIDS},function(){})}}]}),angular.module("app").controller("ChannelSelect",["$scope","$rootScope","$uibModalInstance","$api","ProjectID","SelectedSensors","SelectedSensorsIDS",function(e,n,o,t,i,r,s){var c;e.currentPage=1,e.project=i,e.popPageSize=8,e.Ok=function(){s=[],angular.forEach(r,function(e){s.push(e._id)}),o.close({SelectedSensors:r,SelectedSensorsIDS:s})},e.Cancel=function(){o.dismiss("cancel")},e.SwitchSensor=function(n,o){n.preventDefault(),r=[],o.isEnable=!o.isEnable,angular.forEach(e.viewOfSensors,function(e,n){1==e.isEnable&&r.push(e)})},e.onSearchSensor=function(n){n.preventDefault(),e.UpdateViewOfSensors(e.sensorSearchKey)},e.OnSelectAll=function(n){n.preventDefault(),angular.forEach(e.viewOfSensors,function(e){e.isEnable=!0,r.push(e)})},e.UpdateViewOfSensors=function(n){e.viewOfSensors=[],n?_.each(c,function(o){o.title.match(n)?e.viewOfSensors.push(o):o.addrid&&o.addrid.match(n)&&e.viewOfSensors.push(o)}):e.viewOfSensors=_.union(e.viewOfSensors,c),angular.forEach(e.viewOfSensors,function(e){angular.forEach(s,function(n){n==e._id&&(e.isEnable=!0)})})},t.sensorchannel.info({project:i},function(n){c=n.result,e.UpdateViewOfSensors()}.bind(this))}]);