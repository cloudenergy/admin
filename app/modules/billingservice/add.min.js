"use strict";angular.module("app").component("billingAdd",{templateUrl:"app/modules/billingservice/add.html?rev=95181b9a68",controller:["$rootScope","$api","$state","SweetAlert","$uibModal","$scope",function(e,o,n,t,r,i){var c=this;c.hours=[];for(var s=0;s<24;s++)c.hours.push(s);c.onDuty=e.Project.selected.onduty.split(":")[0],c.offDuty=e.Project.selected.offduty.split(":")[0],c.times=[{HourFrom:c.onDuty,HourTo:c.offDuty,price:void 0},{HourFrom:c.offDuty,HourTo:c.onDuty,price:void 0}],c.addTime=function(){c.times.push({HourFrom:void 0,HourTo:void 0,price:void 0})},c.removeTime=function(e){c.times.splice(e,1)},c.setSelectChecked=function(){var e=document.getElementsByClassName("hourFrom"),o=document.getElementsByClassName("hourTo");angular.forEach(e,function(e,o){for(var n=0;n<e.options.length;n++)if(String(e.options[n].innerHTML)==String(c.times[o].HourFrom)){e.options[n].selected=!0;break}}),angular.forEach(o,function(e,o){for(var n=0;n<e.options.length;n++)if(String(e.options[n].innerHTML)==String(c.times[o].HourTo)){e.options[n].selected=!0;break}})},c.submit=function(){var r=document.getElementsByClassName("hourFrom"),i=document.getElementsByClassName("hourTo"),s={},u=!0;return angular.forEach(r,function(e){Number(e.value)||0==e.value||(u=!1)}),angular.forEach(i,function(e){Number(e.value)||0==e.value||(u=!1)}),u?c.SelectedSensorsIDS&&c.SelectedSensorsIDS.length?(c.advanced?(s.timequantumprice=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],angular.forEach(c.times,function(e){if(Number(e.HourFrom)<Number(e.HourTo))for(var o=Number(e.HourFrom);o<Number(e.HourTo);o++)s.timequantumprice[o]=e.price;else for(var o=0;o<24;o++)void 0===s.timequantumprice[o]&&(s.timequantumprice[o]=e.price)}),angular.forEach(s.timequantumprice,function(e){void 0===e&&(e=0)})):s.fixprice=c.fixprice,void o.billingservice.add({title:c.serviceTitle,projectid:e.Project.selected._id,channels:c.SelectedSensorsIDS,rules:s},function(){t.success("保存成功"),n.go("admin.billingservice.info")},t.error)):(t.warning("请选择计费仪表"),!1):(t.warning("请选择日期"),!1)},c.OnSelectSensor=function(o){o.preventDefault(),r.open({templateUrl:"modal-channelselectAdd.html",controller:"ChannelSelectAdd",size:"lg",resolve:{ProjectID:function(){return e.Project.selected._id},SelectedSensors:function(){return i.SelectSensors||[]},SelectedSensorsIDS:function(){return c.SelectedSensorsIDS}}}).result.then(function(e){c.SelectSensors=e,c.SelectedSensorsIDS=[],angular.forEach(c.SelectSensors,function(e){c.SelectedSensorsIDS.push(e.id)})},function(){})}}]}),angular.module("app").controller("ChannelSelectAdd",["$scope","$rootScope","$uibModalInstance","$api","ProjectID","SelectedSensors","SelectedSensorsIDS","SweetAlert",function(e,o,n,t,r,i,c,s){var u;e.currentPage=1,e.project=r,e.popPageSize=8,e.Ok=function(){angular.forEach(u,function(e){e.isEnable&&i.push(e)}),n.close(i)},e.Cancel=function(){n.dismiss("cancel")},e.SwitchSensor=function(e,o){e.preventDefault(),o.isEnable=!o.isEnable},e.onSearchSensor=function(o){o.preventDefault(),e.UpdateViewOfSensors(e.sensorSearchKey)},e.OnSelectAll=function(o){o.preventDefault(),angular.forEach(e.viewOfSensors,function(e){e.isEnable=!0})},e.$watch("devicetype.selected",function(o){e.viewOfSensors=[],angular.forEach(u,function(n){n.devicetype.match(o.id)&&e.viewOfSensors.push(n)})}),e.UpdateViewOfSensors=function(o){e.viewOfSensors=[],o?angular.forEach(u,function(n){n.title.match(o)||n.addrid.match(o)?e.viewOfSensors.push(n):n.channel&&n.channel.match(o)&&e.viewOfSensors.push(n)}):e.viewOfSensors=_.union(e.viewOfSensors,u)},t.billingservice.equipments({project:r,SHOWALL:!0},function(o){u=o.result,e.UpdateViewOfSensors()}.bind(this)),t.device.type({project:r},function(o){e.devicetype=o.result})}]);