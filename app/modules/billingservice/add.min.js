"use strict";angular.module("app").component("billingAdd",{templateUrl:"app/modules/billingservice/add.html?rev=d7725f7bd4",controller:["$rootScope","$api","$state","SweetAlert","$uibModal",function(t,n,u,c,e){var d=this;d.SelectedSensorsIDS=[],d.hours=[];for(var o=0;o<24;o++)d.hours.push(o);d.onDuty=Number(t.Project.selected.onduty.split(":")[0]),d.offDuty=Number(t.Project.selected.offduty.split(":")[0]),d.times=[{HourFrom:d.onDuty,HourTo:d.offDuty,price:void 0},{HourFrom:d.offDuty,HourTo:d.onDuty,price:void 0}],d.addTime=function(){d.times.push({HourFrom:void 0,HourTo:void 0,price:void 0})},d.removeTime=function(e){d.times.splice(e,1)},d.setSelectChecked=function(){var e=document.getElementsByClassName("hourFrom"),o=document.getElementsByClassName("hourTo");angular.forEach(e,function(e,o){for(var i=0;i<e.options.length;i++)if(String(e.options[i].innerHTML)==String(d.times[o].HourFrom)){e.options[i].selected=!0;break}}),angular.forEach(o,function(e,o){for(var i=0;i<e.options.length;i++)if(String(e.options[i].innerHTML)==String(d.times[o].HourTo)){e.options[i].selected=!0;break}})},d.submit=function(){var e=document.getElementsByClassName("hourFrom"),o=document.getElementsByClassName("hourTo"),i={},r=!0;return angular.forEach(e,function(e){Number(e.value)||0==e.value||(r=!1)}),angular.forEach(o,function(e){Number(e.value)||0==e.value||(r=!1)}),r?d.SelectedSensorsIDS.length?(d.advanced?(i.timequantumprice=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],angular.forEach(d.times,function(e){if(Number(e.HourFrom)<Number(e.HourTo))for(var o=Number(e.HourFrom);o<Number(e.HourTo);o++)i.timequantumprice[o]=e.price;else for(o=0;o<24;o++)void 0===i.timequantumprice[o]&&(i.timequantumprice[o]=e.price)}),angular.forEach(i.timequantumprice,function(e){void 0===e&&(e=0)})):i.fixprice=d.fixprice,void n.billingservice.add({title:d.serviceTitle,projectid:t.Project.selected._id,channels:d.SelectedSensorsIDS,rules:i},function(){c.success("保存成功"),u.go("admin.billingservice.info")},c.error)):(c.info("请选择计费仪表"),!1):(c.info("请选择日期"),!1)},d.OnSelectSensor=function(){e.open({component:"billingserviceSensorSelect",size:"lg",backdrop:"static",resolve:{projectid:function(){return t.Project.selected._id},addItemsIDs:function(){return d.SelectedSensorsIDS}}}).result.then(function(e){d.SelectedSensorsIDS=e.addItemsIDs})}}]});