"use strict";angular.module("app").component("billingAdd",{templateUrl:"app/modules/billingservice/add.html?rev=6067da5ac2",controller:["$rootScope","$api","$state","SweetAlert","$uibModal",function(e,o,i,r,t){var n=this;n.SelectedSensorsIDS=[],n.hours=[];for(var u=0;u<24;u++)n.hours.push(u);n.onDuty=e.Project.selected.onduty.split(":")[0],n.offDuty=e.Project.selected.offduty.split(":")[0],n.times=[{HourFrom:n.onDuty,HourTo:n.offDuty,price:void 0},{HourFrom:n.offDuty,HourTo:n.onDuty,price:void 0}],n.addTime=function(){n.times.push({HourFrom:void 0,HourTo:void 0,price:void 0})},n.removeTime=function(e){n.times.splice(e,1)},n.setSelectChecked=function(){var e=document.getElementsByClassName("hourFrom"),o=document.getElementsByClassName("hourTo");angular.forEach(e,function(e,o){for(var i=0;i<e.options.length;i++)if(String(e.options[i].innerHTML)==String(n.times[o].HourFrom)){e.options[i].selected=!0;break}}),angular.forEach(o,function(e,o){for(var i=0;i<e.options.length;i++)if(String(e.options[i].innerHTML)==String(n.times[o].HourTo)){e.options[i].selected=!0;break}})},n.submit=function(){var t=document.getElementsByClassName("hourFrom"),u=document.getElementsByClassName("hourTo"),c={},s=!0;return angular.forEach(t,function(e){Number(e.value)||0==e.value||(s=!1)}),angular.forEach(u,function(e){Number(e.value)||0==e.value||(s=!1)}),s?n.SelectedSensorsIDS.length?(n.advanced?(c.timequantumprice=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],angular.forEach(n.times,function(e){if(Number(e.HourFrom)<Number(e.HourTo))for(o=Number(e.HourFrom);o<Number(e.HourTo);o++)c.timequantumprice[o]=e.price;else for(var o=0;o<24;o++)void 0===c.timequantumprice[o]&&(c.timequantumprice[o]=e.price)}),angular.forEach(c.timequantumprice,function(e){void 0===e&&(e=0)})):c.fixprice=n.fixprice,void o.billingservice.add({title:n.serviceTitle,projectid:e.Project.selected._id,channels:n.SelectedSensorsIDS,rules:c},function(){r.success("保存成功"),i.go("admin.billingservice.info")},r.error)):(r.info("请选择计费仪表"),!1):(r.info("请选择日期"),!1)},n.OnSelectSensor=function(){t.open({component:"billingserviceSensorSelect",size:"lg",backdrop:"static",resolve:{projectid:function(){return e.Project.selected._id},addItemsIDs:function(){return n.SelectedSensorsIDS}}}).result.then(function(e){n.SelectedSensorsIDS=e.addItemsIDs})}}]});