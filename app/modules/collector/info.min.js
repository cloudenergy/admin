"use strict";angular.module("app").controller("CollectorIndex",["$rootScope","$scope","$api","$uibModal","SweetAlert",function(i,s,n,t,a){s.currentPage=1,s.askingRemoveID=void 0,s.DoRemove=function(e,o,n){e.preventDefault();var l=s;t.open({size:"md",templateUrl:"collectorDelete.html",controller:["$scope","$uibModalInstance","$api",function(e,t,c){e.cancel=function(){t.dismiss()},e.ok=function(){t.dismiss(),c.collector.delete({tag:o,projectid:i.Project.selected._id,ctrlcode:(new window.Hashes.SHA1).hex(e.ctrlcode).toUpperCase()},function(){l.items.detail.splice(n,1)},a.error)}}]})},s.AskForRemove=function(e,t){e.preventDefault(),s.askingRemoveID=t},s.CancelRemove=function(e){e.preventDefault(),s.askingRemoveID=void 0},s.switchStatus=function(c,e){e.preventDefault(),t.open({templateUrl:"modal-collectorStatus.html",size:"md",controller:["$scope","$uibModalInstance",function(e,t){e.item=angular.copy(c),e.ok=function(){n.collector.status({id:c.id,projectid:i.Project.selected._id,status:"ONLINE"==c.status?"DEBUG":"ONLINE"},function(){c.status="ONLINE"==e.item.status?"DEBUG":"ONLINE",t.dismiss("cancel")},function(){t.dismiss("cancel")})},e.cancel=function(){t.dismiss("cancel")}}]})},s.multiCheck=function(e){"all"===e?(s.multiCheck.all&&(s.showButton=!0),s.multiCheck.all||(s.showButton=!1),angular.forEach(s.items.detail,function(e){e.isSelected=s.multiCheck.all})):(s.multiCheck.all=!0,s.showButton=!1,angular.forEach(s.items.detail,function(e){e.isSelected||delete s.multiCheck.all,e.isSelected&&(s.showButton=!0)}))},s.multiIds=function(){var t=[];return angular.forEach(s.items.detail,function(e){e.isSelected&&t.push(e.id)}),t},s.switchAll=function(c,e){e.preventDefault();var o=s;t.open({templateUrl:"modal-collectorStatus.html",size:"md",controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){n.collector.status({id:o.multiIds(),projectid:i.Project.selected._id,status:c},function(){n.collector.info({project:i.Project.selected._id},function(e){delete o.multiCheck.all,o.items=e.result,t.dismiss("cancel")})},function(){t.dismiss("cancel")})},e.cancel=function(){t.dismiss("cancel")}}]})},s.popIsOpen=function(){angular.forEach(s.items.detail,function(e){delete e.titleIsOpen})},s.popover={url:{title:"titleChange.html"},title:{title:"管理器名称修改"},ok:function(e,t,c){e[t+"IsOpen"]=!1,s.item=angular.copy(e),s.item[t]=c[t],n.collector.update(s.item,function(){e[t]=c[t],a.success("更新成功")},a.error)},cancel:function(e,t){e[t+"IsOpen"]=!1}},s.$watch("currentPage",function(){n.collector.info({project:i.Project.selected._id,pageindex:s.currentPage,pagesize:10},function(e){s.items=e.result},function(){delete s.items})})}]);