"use strict";angular.module("app").controller("CollectorIndex",["$rootScope","$scope","$api","$uibModal","SweetAlert",function(e,t,c,o,n){t.currentPage=1,t.askingRemoveID=void 0,t.DoRemove=function(c,l,i){c.preventDefault();var s=t;o.open({size:"md",templateUrl:"collectorDelete.html",controller:["$scope","$uibModalInstance","$api",function(t,c,o){t.cancel=function(){c.dismiss()},t.ok=function(){c.dismiss(),o.collector.delete({tag:l,projectid:e.Project.selected._id,ctrlcode:(new window.Hashes.SHA1).hex(t.ctrlcode).toUpperCase()},function(){s.items.detail.splice(i,1)},n.error)}}]})},t.AskForRemove=function(e,c){e.preventDefault(),t.askingRemoveID=c},t.CancelRemove=function(e){e.preventDefault(),t.askingRemoveID=void 0},t.switchStatus=function(t,n){n.preventDefault(),o.open({templateUrl:"modal-collectorStatus.html",size:"md",controller:["$scope","$uibModalInstance",function(o,n){o.item=angular.copy(t),o.ok=function(){c.collector.status({id:t.id,projectid:e.Project.selected._id,status:"ONLINE"==t.status&&"DEBUG"||"ONLINE"},function(){t.status="ONLINE"==o.item.status&&"DEBUG"||"ONLINE",n.dismiss("cancel")},function(){n.dismiss("cancel")})},o.cancel=function(){n.dismiss("cancel")}}]})},t.multiCheck=function(e){"all"===e?(t.multiCheck.all&&(t.showButton=!0),!t.multiCheck.all&&(t.showButton=!1),angular.forEach(t.items.detail,function(e){e.isSelected=t.multiCheck.all})):(t.multiCheck.all=!0,t.showButton=!1,angular.forEach(t.items.detail,function(e){e.isSelected||delete t.multiCheck.all,e.isSelected&&(t.showButton=!0)}))},t.multiIds=function(){var e=[];return angular.forEach(t.items.detail,function(t){t.isSelected&&e.push(t.id)}),e},t.switchAll=function(n,l){l.preventDefault();var i=t;o.open({templateUrl:"modal-collectorStatus.html",size:"md",controller:["$scope","$uibModalInstance",function(t,o){t.ok=function(){c.collector.status({id:i.multiIds(),projectid:e.Project.selected._id,status:n},function(){c.collector.info({project:e.Project.selected._id},function(e){delete i.multiCheck.all,i.items=e.result,o.dismiss("cancel")})},function(){o.dismiss("cancel")})},t.cancel=function(){o.dismiss("cancel")}}]})},t.popIsOpen=function(){angular.forEach(t.items.detail,function(e){delete e.titleIsOpen})},t.popover={url:{title:"titleChange.html"},title:{title:"管理器名称修改"},ok:function(e,o,l){e[o+"IsOpen"]=!1,t.item=angular.copy(e),t.item[o]=l[o],c.collector.update(t.item,function(){e[o]=l[o],n.success("更新成功")},n.error)},cancel:function(e,t){e[t+"IsOpen"]=!1}},t.$watch("currentPage",function(){c.collector.info({project:e.Project.selected._id,pageindex:t.currentPage,pagesize:10},function(e){t.items=e.result},function(){delete t.items})})}]);