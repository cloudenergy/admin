"use strict";angular.module("app").controller("departmentcreate",["$rootScope","$scope","$state","$uibModal","$api","SweetAlert",function(e,r,t,n,o,u){r.ondutyHour=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],r.ondutyHour.selected="08",r.ondutyMinute=["00","10","20","30","40","50"],r.ondutyMinute.selected="00",r.offdutyHour=angular.copy(r.ondutyHour),r.offdutyHour.selected="17",r.offdutyMinute=angular.copy(r.ondutyMinute),r.offdutyMinute.selected="00",r.SelectSensors,r.department={character:"NONE"};var c=e.Project.selected._id;r.warning={},r.submit=function(e){r.department.account<10?u.info("用户名不能低于10位"):r.department.password==r.repassword?r.SelectSensors&&r.SelectSensors.length&&!r.department.account?u.info("请选择所属账户"):r.department.password?(r.department.resource={project:[c],sensor:[]},_.each(r.SelectSensors,function(e){"*"==e._id?r.department.resource.sensor="*":r.department.resource.sensor.push(c+"."+e._id)}),r.department.onduty=r.ondutyHour.selected+":"+r.ondutyMinute.selected,r.department.offduty=r.offdutyHour.selected+":"+r.offdutyMinute.selected,r.department.message=Object.keys(r.warning).filter(function(e){return r.warning[e]?e:""}).join(","),r.department.project=c,r.department.alerthreshold=r.department.alerthreshold&&r.department.alerthreshold||0,o.department.add(r.department,function(){u.success("保存成功"),t.go("admin.department.info")},function(e){u.error("用户名长度过短"===e.message?"登录帐号长度过短":e.message)})):u.info("请设置密码"):u.info("两次输入的密码不一致")},r.OnSelectSensor=function(e){e.preventDefault(),n.open({templateUrl:"modal-channelselect.html",controller:"ChannelSelect",size:"lg",resolve:{ProjectID:function(){return c},SelectedSensors:function(){return r.SelectSensors||[]}}}).result.then(function(e){r.SelectSensors=e},function(){})},r.OnSelectCharacter=function(e,t){e.preventDefault(),r.department.character=t},r.OnSaveAlerthreshold=function(){o.billingaccount.update({account:e.Account.billingAccount._id,alerthreshold:e.Account.billingAccount.alerthreshold})},o.project.info({id:c},function(e){if(r.epayment=e.result.epayment,e.result.onduty){var t=moment(e.result.onduty,"HH:mm");r.ondutyHour.selected=t.format("HH"),r.ondutyMinute.selected=t.format("mm")}if(e.result.offduty){var n=moment(e.result.offduty,"HH:mm");r.offdutyHour.selected=n.format("HH"),r.offdutyMinute.selected=n.format("mm")}})}]);