"use strict";angular.module("app").controller("departmentcreate",["$rootScope","$scope","$state","$uibModal","$api","UI",function(e,t,r,n,o,a){t.ondutyHour=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],t.ondutyMinute=["00","10","20","30","40","50"],t.offdutyHour=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],t.offdutyMinute=["00","10","20","30","40","50"],t.SelectSensors,t.department={character:"NONE"};var c=e.Project.selected._id;t.warning={},t.submit=function(e){return t.department.account<10?void a.AlertWarning("用户名不能低于10位"):t.department.password!=t.repassword?void a.AlertWarning("两次输入的密码不一致"):t.SelectSensors&&t.SelectSensors.length&&!t.department.account?void a.AlertWarning("请选择所属账户"):t.department.password?(t.department.resource={project:[c],sensor:[]},_.each(t.SelectSensors,function(e){"*"==e._id?t.department.resource.sensor="*":t.department.resource.sensor.push(c+"."+e._id)}),t.department.onduty=t.ondutyHour.selected+":"+t.ondutyMinute.selected,t.department.offduty=t.offdutyHour.selected+":"+t.offdutyMinute.selected,t.department.message=Object.keys(t.warning).filter(function(e){return t.warning[e]?e:""}).join(","),t.department.project=c,t.department.rechargeable=t.department.rechargeable&&t.department.rechargeable||!1,t.department.alerthreshold=t.department.alerthreshold&&t.department.alerthreshold||0,void o.department.add(t.department,function(){a.AlertSuccess("保存成功"),r.go("admin.department.info")},function(e){a.AlertError("用户名长度过短"===e.message&&"登录帐号长度过短"||e.message)})):void a.AlertWarning("请设置密码")},t.OnSelectSensor=function(e){e.preventDefault();var r=n.open({templateUrl:"modal-channelselect.html",controller:"ChannelSelect",size:"lg",resolve:{ProjectID:function(){return c},SelectedSensors:function(){return t.SelectSensors||[]}}});r.result.then(function(e){t.SelectSensors=e},function(){})},t.OnSelectCharacter=function(e,r){e.preventDefault(),t.department.character=r},t.OnSaveAlerthreshold=function(){o.billingaccount.update({account:e.Account.billingAccount._id,alerthreshold:e.Account.billingAccount.alerthreshold})},o.project.info({id:c},function(e){if(e.result.onduty){var r=moment(e.result.onduty,"H:mm");t.ondutyHour.selected=r.format("H"),t.ondutyMinute.selected=r.format("mm")}if(e.result.offduty){var n=moment(e.result.offduty,"H:mm");t.offdutyHour.selected=n.format("H"),t.offdutyMinute.selected=n.format("mm")}})}]);