"use strict";angular.module("app").component("customerIndex",{templateUrl:"app/modules/customer/index.html?rev=5718ba7368",controller:["$rootScope","$q","$api","$uibModal","SweetAlert",function(t,n,e,i,o){var r=this,d=function(t,n,e){var i=[];return n&&(angular.forEach(n,function(n){n.key&&(n.addrid=n.key.substring(12,24)),r.listOrigin&&angular.forEach(r.listOrigin[0].nodes,function(t){t.showChildren&&(t.id==n.id&&(n.showChildren=t.showChildren),t.nodes&&angular.forEach(t.nodes,function(t){t.showGrandchildren&&t.id==n.id&&(n.showGrandchildren=t.showGrandchildren)}))}),n.originid=n.id,n.origintitle=n.title,n.id=n.id,n.title=n.title,n.acreage=n.acreage||0,n.level=e,n.nodes=d(n,n.child,e+1),n.parent=t,i.push(n)}),i.sort(function(t,n){return t.index>n.index?1:-1})),i};r.$onInit=function(){return e.customer.info({project:t.Project.selected._id},function(t){r.listData=[{level:0,type:"NODE",title:"树形结构",nodes:d(null,t.result,1)}]},function(){r.listData=[{level:0,type:"NODE",title:"树形结构",nodes:[]}]}).$promise},r.addnode=function(t,n){"root"==t?r.listData[0].nodes.push({key:"",type:"NODE",title:""}):n.nodes.push({key:"",type:"NODE",title:"",parent:n})},r.save=function(n,i,d,l){if(!i.title)return o.info("请输入名称"),!1;e.customer.update({node:{id:i.id||void 0,title:i.title,type:l,parent:i.parent&&i.parent.id||void 0},method:d,project:t.Project.selected._id},function(t){r.listOrigin=angular.copy(r.listData),r.$onInit(),o.success(i.id?"更新成功":"添加成功")},function(){r.$onInit(),o.warning(i.id?"更新失败":"添加失败")})},r.add=function(n,i,d){if(console.log(n),!n.title)return o.info("请输入名称"),!1;e.customer.update({node:{title:n.title,type:"DEV",key:n.did,parent:d},method:"ADD",project:t.Project.selected._id},function(t){r.listOrigin=angular.copy(r.listData),r.$onInit(),console.log(r.listOrigin[0].nodes),o.success(n.id?"更新成功":"添加成功")},function(){r.$onInit(),o.warning(n.id?"更新失败":"添加失败")})},r.cancel=function(t,n){t.splice(n,1),r.listOrigin=angular.copy(r.listData),r.$onInit()},r.delete=function(n,i){e.customer.update({node:{id:n.id},method:"REMOVE",project:t.Project.selected._id},function(){r.listOrigin=angular.copy(r.listData),r.$onInit()},function(){r.$onInit(),o.warning("删除失败")})},r.empty=function(t){if(null==t||angular.equals({},t))return!0},r.changeSensor=function(n){i.open({backdrop:"static",component:"sensor",size:"lg",resolve:{projectid:function(){return t.Project.selected._id},selected:function(){return angular.equals(n.child,{})&&n||n.child}}}).result.then(function(i){r.addsensor=function(){i.length<=0&&e.customer.update({node:{id:n.id||void 0,key:n.key,title:n.title,type:"DEV",parent:n.parent&&n.parent.id||void 0},method:"UPDATE",project:t.Project.selected._id},function(t){r.listOrigin=angular.copy(r.listData),r.$onInit(),o.success(n.id?"更新成功":"添加成功")},function(){r.listOrigin=angular.copy(r.listData),r.$onInit(),o.warning(n.id?"更新失败":"添加失败")})},i.length>0&&angular.forEach(i,function(t){r.add(t,t.title,n.id)}),n.key=i,n.id&&r.addsensor(),!n.id&&r.save("child",n,"ADD","DEV")})}}]});