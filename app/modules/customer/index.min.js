"use strict";angular.module("app").component("customerIndex",{templateUrl:"app/modules/customer/index.html?rev=54a6d1255b",controller:["$rootScope","$q","$api","$uibModal","SweetAlert",function(t,e,n,i,o){var r=this,d=function(t,e,n){var i=[];return e&&(angular.forEach(e,function(e){r.listOrigin&&angular.forEach(r.listOrigin[0].nodes,function(t){t.showChildren&&(t.id==e.id&&(e.showChildren=t.showChildren),t.nodes&&angular.forEach(t.nodes,function(t){t.showGrandchildren&&t.id==e.id&&(e.showGrandchildren=t.showGrandchildren)}))}),e.originid=e.id,e.origintitle=e.title,e.id=e.id,e.title=e.title,e.acreage=e.acreage||0,e.level=n,e.nodes=d(e,e.child,n+1),e.parent=t,i.push(e)}),i.sort(function(t,e){return t.index>e.index?1:-1})),i};r.$onInit=function(){return n.customer.info({project:t.Project.selected._id},function(t){r.listData=[{level:0,type:"NODE",title:"树形结构",nodes:d(null,t.result,1)}]},function(){r.listData=[{level:0,type:"NODE",title:"树形结构",nodes:[]}]}).$promise},r.addnode=function(t,e){"root"==t?r.listData[0].nodes.push({key:"",type:"NODE",title:""}):e.nodes.push({key:"",type:"NODE",title:"",parent:e})},r.save=function(e,i,d,c){if(!i.title)return o.info("请输入名称"),!1;n.customer.update({node:{id:i.id||void 0,title:i.title,type:c,parent:i.parent&&i.parent.id||void 0},method:d,project:t.Project.selected._id},function(t){r.listOrigin=angular.copy(r.listData),r.$onInit(),o.success(i.id?"更新成功":"添加成功")},function(){r.$onInit(),o.warning(i.id?"更新失败":"添加失败")})},r.cancel=function(t,e){t.splice(e,1),r.listOrigin=angular.copy(r.listData),r.$onInit()},r.delete=function(e,i){n.customer.update({node:{id:e.id},method:"REMOVE",project:t.Project.selected._id},function(){r.listOrigin=angular.copy(r.listData),r.$onInit(),o.success("删除成功")},function(){r.$onInit(),o.warning("删除失败")})},r.changeSensor=function(e){i.open({backdrop:"static",component:"sensor",size:"lg",resolve:{projectid:function(){return t.Project.selected._id},selected:function(){return e.key}}}).result.then(function(i){r.addsensor=function(){n.customer.update({node:{id:e.id||void 0,title:e.title,type:"DEV",parent:e.parent&&e.parent.id||void 0},method:"UPDATE",project:t.Project.selected._id},function(t){r.listOrigin=angular.copy(r.listData),r.$onInit(),o.success(e.id?"更新成功":"添加成功")},function(){r.listOrigin=angular.copy(r.listData),r.$onInit(),o.warning(e.id?"更新失败":"添加失败")})},e.key=i,e.id&&r.addsensor(),!e.id&&r.save("child",e,"ADD","DEV")})}}]});