"use strict";angular.module("app").controller("SensorEdit",["$scope","$stateParams","$state","$api","SweetAlert",function(t,e,s,i,r){var o;t.submit=function(e){var n=angular.copy(t.sensor);n.building=t.sensor.building&&t.sensor.building.id,o?(n.energy=function(e){var n=e.split("|");return _.isArray(n)&&n[0]||e}(o.id),n.energyPath=o.id):(n.energy="",n.energyPath=""),i.sensorchannel.update(n,function(){s.go("admin.sensor.info")},r.error)},i.sensorchannel.info({id:e.id},function(e){t.sensor=e.result[0],i.energy.info({project:t.sensor.project},function(e){var n,s=e.result.energy;t.viewOfEnergy=[{nodes:function n(s,e,t){if(!e)return;var i=[];_.each(e,function(e){e.childrens?e.ischild=!1:e.ischild=!0,e.parent=s,e.level=t,e.nodes=n(e,e.childrens,t+1),i.push(e)});i.sort(function(e,n){return e.title>n.title?1:-1});return i}(null,e.result.energy,1),title:"能耗分类",level:0}],t.sensor.energyPath&&_.each(t.sensor.energyPath.split("|"),function(e){s&&(n?n+="|"+e:n=e,(s=s[n])&&(s&&!s.childrens?(s.isSelect=!0,o=s):s=s.childrens))}),i.building.info({id:t.sensor.building},function(e){t.building=e.result,t.building&&(t.sensor.building=t.building)})},function(){t.viewOfEnergy=[{nodes:[],title:"能耗分类",level:0}]})}),t.onChoice=function(e){e.isSelect=!e.isSelect;var s=function(e,n){e&&e.nodes&&e.nodes.length&&(_.each(e.nodes,function(e){s(e,n),e.isSelect=n}),e.isSelect=n)};s(e,e.isSelect)},t.onEnergyChoice=function(e){e.nodes||(o&&(o.isSelect=!1),(o=e).isSelect=!0)},t.OnCollapsePayStatus=function(){t.sensor.paystatus&&"NONE"!=t.sensor.paystatus?t.sensor.paystatus="NONE":t.sensor.paystatus="BYSELF"},t.OnSelectPayMode=function(e,n){e.preventDefault(),t.sensor.paystatus=n}}]);