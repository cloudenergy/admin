"use strict";angular.module("app").controller("sensorAttribute",["$scope","$uibModalInstance","$q","$api","SensorSUID","ProjectID",function(e,r,i,t,n,c){function o(){return e.drivercompanySelected&&e.driverNameSelected&&e.driverVersionSelected?e.drivercompanySelected+"/"+e.driverNameSelected+"/"+e.driverVersionSelected:""}function s(r,i){var c={command:"EMC_VIEW_ADAPTDEVICE",sid:n,driver:r};t.control.send(c,function(r){e.AdaptDevice=[],_.each(r.result,function(r){e.AdaptDevice.push(r)}),i?e.adaptDeviceSelected=i:e.AdaptDevice.length&&(e.adaptDeviceSelected=e.AdaptDevice[0].code)})}e.Ok=function(){var i=o();if(!i.length)return void r.close();var s={_id:n,driver:i,project:c,ext:e.SensorAttrib.ext||{}};s.ext.adaptdevice=e.adaptDeviceSelected||"",!e.else&&t.sensorattrib.update(s,function(){r.close()}),e.else&&r.close()},e.Cancel=function(){r.dismiss("cancel")},e.$watch("drivercompanySelected",function(r){if(r){if(e.DriverNames=e.Drivers[r].driver,!e.DriverNames)return;e.DriverName=[],_.map(e.DriverNames,function(r,i){e.DriverName.push({id:i})})}}),e.$watch("driverNameSelected",function(r){if(r){if(e.DriverVersions=e.DriverNames[r].driver,!e.DriverVersions)return;e.DriverVersion=[],_.map(e.DriverVersions,function(r,i){e.DriverVersion.push({id:i})})}}),e.$watch("driverVersionSelected",function(e){if(e){var r=o();if(!r.length)return;s(r)}}),i.all([t.driver.enum().$promise,t.sensorattrib.info({sensor:n}).$promise]).then(function(r){if(e.Drivers=r[0].result,e.DriverCompany=[],_.map(e.Drivers,function(r,i){e.DriverCompany.push({id:i})}),e.SensorAttrib=r[1].result,e.SensorAttrib){if(e.SensorAttrib.driver){var i=e.SensorAttrib.driver.split("/");e.drivercompanySelected=i[0],e.driverNameSelected=i[1],e.driverVersionSelected=i[2]}var t=null;t=e.SensorAttrib.ext&&e.SensorAttrib.ext.adaptdevice,s(e.SensorAttrib.driver,t)}})}]);