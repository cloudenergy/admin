"use strict";angular.module("app").controller("SensorCreate",["$scope","$state","$stateParams","$api","Auth","UI",function(e,n,i,s,t,o){t.Check(function(){function t(e){var n=e.split("|");return _.isArray(n)?n[0]||e:e}function r(e,n,i){if(n){var s=[];return _.each(n,function(n){n.childrens?n.ischild=!1:n.ischild=!0,n.parent=e,n.level=i,n.nodes=r(n,n.childrens,i+1),s.push(n)}),s.sort(function(e,n){return e.title>n.title?1:-1}),s}}e.sensor={mask:!1,comi:"d*1"},e.buildingID=i.building;var c;e.submit=function(i){var r=angular.copy(e.sensor);return c?(r.project=e.sensor.project,r.building=e.buildingID,c&&(r.energy=t(c.id),r.energyPath=c.id),void s.sensor.info({sids:[r.sid]},function(){o.AlertWarning("标识已经存在")},function(){s.sensorchannel.add(r,function(){n.go("admin.sensor.info")},function(e){o.AlertError(e.message)})})):void o.AlertWarning("请选择传感器能耗类型")},s.building.info({id:e.buildingID,project:e.Project.selected._id},function(n){e.building=n.result,e.building&&(e.sensor.building=e.building),s.energy.info({project:e.Project.selected._id},function(n){e.viewOfEnergy=[{nodes:r(null,n.result.energy,1),title:"能耗分类",level:0}]},function(){e.viewOfEnergy=[{nodes:[],title:"能耗分类",level:0}]})},function(n){e.alertError(n.message)}),e.addSocity=function(n){e.socities=_.reject(e.socities,function(e){return e._id==n._id}),e.sensorsocities.push(n)},e.removeSocity=function(n){e.sensorsocities=_.reject(e.sensorsocities,function(e){return e._id==n._id}),e.socities.push(n)},e.SwitchSocity=function(e,n){e.preventDefault(),n.isEnable=!n.isEnable,n.isEnable?n.isEnable=!1:n.isEnable=!0},e.sensorsocities=[],e.onChoice=function(e){e.isSelect=!e.isSelect;var n=function(e,i){e&&e.nodes&&e.nodes.length&&(_.each(e.nodes,function(e){n(e,i),e.isSelect=i}),e.isSelect=i)};n(e,e.isSelect)},e.onEnergyChoice=function(e){e.nodes||(c&&(c.isSelect=!1),c=e,c.isSelect=!0)},e.OnCollapsePayStatus=function(){e.sensor.paystatus&&"NONE"!=e.sensor.paystatus?e.sensor.paystatus="NONE":e.sensor.paystatus="BYSELF"},e.OnSelectPayMode=function(n,i){n.preventDefault(),e.sensor.paystatus=i}})}]);