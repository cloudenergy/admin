"use strict";angular.module("app").component("webappIndex",{templateUrl:"app/modules/webapp/index.html?rev=ce55c9ac67",controller:["$rootScope","$q","$ocLazyLoad","$uibModal","$api","SweetAlert","Upload","base64",function(e,t,o,n,a,l,i,c){var d=this,r={icons:"//at.alicdn.com/t/font_kzvt29flmsyeewmi.css",slide:[{fixed:1,key:"slide1.jpg",sort:1},{fixed:1,key:"slide2.jpg",sort:2},{fixed:1,key:"slide3.jpg",sort:3}],basic:[{state:"app.device",icon:"icon-addon addon-control",iconColor:"#4caf50",label:"仪表控制",sort:1},{state:"app.fee",icon:"icon-addon addon-order",iconColor:"#673ab7",label:"消耗帐单",sort:2},{state:"app.recharge",icon:"icon-addon addon-recharge",iconColor:"#ff5722",label:"账户充值",sort:3},{state:"app.account",icon:"icon-addon addon-my",iconColor:"#03a9f4",label:"我的信息",sort:4}],third:[{target:"https://city.weixin.qq.com/wx/home2?exportkey=AcVdsGyKWwCSe2VTci2hiWY%3D&pass_ticket=aGIXZ0N19FJYGfZJKDhgW%2BLyHoGa734lilzj70DYfwXa4SOBOTyXkuc19H0LLj8u",icon:"icon-addon addon-cityservice",iconColor:"#999",label:"城市服务",sort:1},{target:"https://common.diditaxi.com.cn/general/webEntry?wx=true",icon:"icon-addon addon-didichuhang",iconColor:"#999",label:"滴滴出行",sort:2},{target:"http://wx.17u.cn/home/index.html?code=021v5Obw02GQgf1YKsaw0llobw0v5ObW&state=123",icon:"icon-addon addon-huoche",iconColor:"#999",label:"火车票机票",sort:3},{target:"http://x.elong.com/hotelwxqb/index/?code=0&cityid=1201",icon:"icon-addon addon-jiudian",iconColor:"#999",label:"酒店",sort:4},{target:"https://dop-open.daojia.com/template/h5/index?cityid=79&from=ios&hmsr=wxwallet&phone=&lng=&location=&lat=&serviceType=1000005&dopChannel=3&znsr=wxwallet_shouye_weixiu&comm_pf=skinforwxwallet.css",icon:"icon-addon addon-repair",iconColor:"#999",label:"维修服务",sort:5},{target:"http://m.nfsq.com.cn/h5/index.html",icon:"icon-addon addon-bottled-water",iconColor:"#999",label:"送水服务",sort:6},{target:"https://m.kuaidi100.com",icon:"icon-addon addon-express",iconColor:"#999",label:"快递服务",sort:7},{target:"http://dianhua.118114.cn:8088/yp114/index.do?channelno=211&type=0&cityName=%e6%9d%ad%e5%b7%9e",icon:"icon-addon addon-tele",iconColor:"#999",label:"电话服务",sort:8},{target:"http://i.meituan.com",icon:"icon-addon addon-catering",iconColor:"#999",label:"餐饮",sort:9},{target:"https://jzt.daojia.com/h5/thirdPartyBj/xiaoshigong",icon:"icon-addon addon-clean-keeping",iconColor:"#999",label:"保洁",sort:10},{target:"http://www.flowermm.net/product/2",icon:"icon-addon addon-flower",iconColor:"#999",label:"花卉",sort:11},{target:"http://m.loveoffice.com.cn",icon:"icon-addon addon-fitment",iconColor:"#999",label:"装修",sort:12},{target:"http://zjzzy.bama555.com/cate?id=5673e2ac45cac043",icon:"icon-addon addon-rent",iconColor:"#999",label:"租赁",sort:13},{target:"http://vmall.360kad.com/Category/all.shtml?utm_medium=refer&utm_source=publicno&utm_domain=quicksearch",icon:"icon-addon addon-medicine-chest",iconColor:"#999",label:"药店",sort:14},{target:"http://www.wmalle.com/webapp/merchant/brandList.do?accountId=40&response_type=code&scope=snsapi_userinfo&state=1",icon:"icon-addon addon-bussiness",iconColor:"#999",label:"办公商圈",sort:15},{target:"http://wq.jd.com/mcoss/mportal/show?tabid=12&tpl=12&PTAG=17053.1.1&utm_source=weixin&utm_medium=weixin&utm_campaign=t_1000072672_17053_001",icon:"icon-addon addon-market",iconColor:"#999",label:"超市",sort:16}]};angular.extend(d,{$onInit:function(){d.info()},templates:[{id:1,name:"默认（轮播图、主应用、第三方应用）",template:"index-tmpl-default.html"}],tabActive:"slide",loadCss:function(){o.load(d.template.icons)},info:function(){a.apptemplate.info({projectid:e.Project.selected._id},function(e){d.template=e.result.content&&angular.fromJson(e.result.content)||r,angular.forEach(d.templates,function(t){angular.equals(t.template,e.result.template)&&(d.templates.selected=t)})},function(){d.template=angular.copy(r),d.templates.selected=d.templates[0]}).$promise.finally(d.loadCss)},slide:{upload:function(){var e=[];angular.forEach(d.template.slide,function(o){if(angular.isUndefined(o.key)&&angular.isUndefined(o.$upload)){o.$upload=1;var n=t.defer();e.push(n.promise),i.base64DataUrl(o).then(function(e){o.__proto__.$base64=1,a.interaction.uploadtoken({file:(new Date).getTime()+"_"+o.name},function(t){a.qiniu.upload({base64:c.encode(t.result.file),token:t.result.token},{file:e.split("data:image/jpeg;base64,")[1]},function(e){o.key=e.key,angular.forEach(o,function(e,t){/^\$/.test(t)&&delete o[t]}),n.resolve(e)},n.reject)},n.reject)},n.reject)}}),t.all(e).then(d.update)},delete:function(e,t){l.swal({title:"确定删除该图片吗？",type:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确认"}).then(function(){e.fixed?(d.template.slide.splice(t,1),d.update()):a.interaction.remove({file:e.key},function(){d.template.slide.splice(t,1),d.update()})})}},modalApp:function(e,t,o){d.template[t]=d.template[t]||[],n.open({templateUrl:"app/modules/webapp/modal.html?rev=191c7d4a9e",controllerAs:"$ctrl",controller:["$uibModalInstance",function(e){angular.extend(this,{isAdd:!o,app:o?angular.copy(o):{},basic:"basic"===t,submit:e.close,cancel:e.dismiss})}]}).result.then(function(e){o?angular.extend(o,e):d.template[t].push(e),d.update()})},update:function(){a.apptemplate.update({projectid:e.Project.selected._id,template:d.templates.selected.template,content:angular.toJson(d.template)}).$promise.finally(d.loadCss)},remove:function(e,t){angular.forEach(d.template[t],function(e){!e.delete&&this.push(e)},d.template[t]=[]),d.update()},clean:function(){l.swal({title:"确定要清空该项目的配置吗？",type:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"确认"}).then(function(){var o=[];angular.forEach(d.template.slide,function(e){!e.fixed&&o.push(a.interaction.remove({file:e.key}).$promise)}),o.push(a.apptemplate.delete({projectid:e.Project.selected._id}).$promise),t.all(o).then(function(){d.template=angular.copy(r)},function(e){e.code?l.error(e):d.template=angular.copy(r)}).finally(d.loadCss)})}})}]});