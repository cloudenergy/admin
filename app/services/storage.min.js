"use strict";angular.module("app").service("$storage",["$cookies","$location",function(e,t){var n=this,o=t.$$host.split("."),i="__emapp_",r="com"==o[o.length-1]&&".gugecc.com"||".hzguge.com",a={uid:"",token:""},s=e.getAll(),c=new window.Hashes.SHA1,g=function(e,t){var n=[],o=[];return angular.forEach(e,function(e,t){n.push(t)}),n.sort(),angular.forEach(n,function(t){o.push(t+"="+encodeURIComponent(angular.isObject(e[t])?JSON.stringify(e[t]):e[t]))}),t+o.toString().replace(/,/g,"")+t};angular.extend(n,{get:function(t){return t=n.expired()?void 0:e.get(t)||sessionStorage[i+t]||localStorage[i+t],"undefined"===t?void 0:t},set:function(t,o,s){t&&Object.keys(t).length?(!s&&Object.keys(a).map(function(n){e.put(n,t[n],{path:"/",domain:r,expires:o&&moment().add(1,"M")._d||void 0})}),o?(n.expired(moment().add(1,"M").unix()),Object.keys(a).map(function(e){localStorage[i+e]=t[e]})):(sessionStorage[i+"expires"]="Session",Object.keys(a).map(function(e){sessionStorage[i+e]=t[e]}))):(delete localStorage[i+"expires"],delete sessionStorage[i+"expires"],Object.keys(a).map(function(t){delete localStorage[i+t],delete sessionStorage[i+t],e.remove(t,{path:"/",domain:r})}))},expired:function(t){if(!t||!moment(t,"X"))return!e.get("token")&&(!sessionStorage[i+"expires"]&&(!(t=localStorage[i+"expires"])||moment(t,"X").isBefore(moment())));localStorage[i+"expires"]=t},valid:function(){var e=!0;return Object.keys(a).map(function(t){n.get(t)||(e=!1)}),e},encrypt:function(e){if(n.valid()){var t=moment().unix();e.v=t,e.t=n.get("token"),e.sign=c.hex(g(e,c.hex(t.toString()))),e.p=n.get("uid"),delete e.t}return e}}),Object.keys(s).length&&n.set(s,!1,!0)}]);
