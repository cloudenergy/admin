<<<<<<< HEAD
"use strict";angular.module("app").service("User",["$rootScope","$q","$state","$api","$storage","MENUCONFIG",function(u,o,t,i,a,r){var n,s={};u.$watch("$root.Project.selected",function(e){n&&e&&(localStorage[n]=e._id,u.Rule&&u.User.$resource().then(function(){t.reload()}))}),angular.extend(u.User=this,{data:void 0,$account:function(e){var t=o.defer();return i.account.info(e||{id:a.get("uid")},function(e){e.result&&Object.keys(e.result).length?(angular.extend(s,u.Account=e.result),t.resolve(u.Account)):t.reject(e)},t.reject),t.promise},$project:function(e){var r=o.defer();return i.project.info(e||{},function(e){if(e.result&&Object.keys(e.result).length){n=a.get("uid")+"_root_project_selected",angular.forEach(u.Project=angular.isArray(e.result)?e.result:[e.result],function(e){u.Project[e._id]=e});var t=_.find(u.Project,function(e){return"577499e785ae16405764025f"===e._id})||u.Project[0];u.Project.selected=u.Project[localStorage[n]]||t,u.User.$resource().then(function(){r.resolve(u.Project)},r.reject)}else r.reject(e)},r.reject),r.promise},$resource:function(){return i.auth.resource({projectid:u.Project.selected._id},function(e){!function r(e,n,o){angular.forEach(e,function(e,t){"leaf"!==t&&(e.leaf?(n[t]=!0,u.Rule.$state[o.concat([t]).join(".")]=!0):(1<o.length&&(u.Rule.$state[o.concat([t]).join(".")]=!0),r(e,n[t]=n[t]||{},o.concat([t]))))})}(e.result,u.Rule={$state:{}},[]),angular.forEach(r,function(e){e.ignore||u.Rule.$state[e.state]?(this.push(e),this[e.state]=e):u.Rule.$state["admin.byitem.index"]&&'admin.byitem.index({type:"BYITEM"})'==e.state?(this.push(e),this[e.state]=e):u.Rule.$state["admin.bycategory.index"]&&'admin.bycategory.index({type:"BYCATEGORY"})'==e.state?(this.push(e),this[e.state]=e):u.Rule.$state["admin.byapart.index"]&&'admin.byapart.index({type:"BYAPART"})'==e.state?(this.push(e),this[e.state]=e):u.Rule.$state["admin.bybuilding.index"]&&'admin.bybuilding.index({type:"BYBUILDING"})'==e.state&&(this.push(e),this[e.state]=e)},u.Menu=[])}).$promise},$userinfo:function(){return o.all([u.User.$account(),u.User.$project()]).then(function(){u.User.data=s})},$login:function(e){e=e||{};var t=o.defer(),r=Object.keys(e).length,n=e.remember;return delete e.remember,i.auth.login(e,function(e){s=e.result,r&&a.set(s,n),u.User.$userinfo().then(function(){t.resolve(s)},function(e){a.set(null),t.reject(e)})},t.reject),t.promise},$logout:function(e){return i.auth.logout(e||{},function(){delete u.User.data,delete u.Project,delete u.Rule,delete u.Menu,a.set(null)}).$promise}})}]);
=======
"use strict";angular.module("app").service("User",["$rootScope","$q","$state","$api","$storage","MENUCONFIG",function(e,t,r,n,o,u){var i,a={};e.$watch("$root.Project.selected",function(t){i&&t&&(localStorage[i]=t._id,e.Rule&&e.User.$resource().then(function(){r.reload()}))}),angular.extend(e.User=this,{data:void 0,$account:function(r){var u=t.defer();return n.account.info(r||{id:o.get("uid")},function(t){t.result&&Object.keys(t.result).length?(angular.extend(a,e.Account=t.result),u.resolve(e.Account)):u.reject(t)},u.reject),u.promise},$project:function(r){var u=t.defer();return n.project.info(r||{},function(t){if(t.result&&Object.keys(t.result).length){i=o.get("uid")+"_root_project_selected",angular.forEach(e.Project=angular.isArray(t.result)?t.result:[t.result],function(t){e.Project[t._id]=t});var r=_.find(e.Project,function(e){return"577499e785ae16405764025f"===e._id})||e.Project[0];e.Project.selected=e.Project[localStorage[i]]||r,e.User.$resource().then(function(){u.resolve(e.Project)},u.reject)}else u.reject(t)},u.reject),u.promise},$resource:function(){return n.auth.resource({projectid:e.Project.selected._id},function(t){!function t(r,n,o){angular.forEach(r,function(r,u){"leaf"!==u&&(r.leaf?(n[u]=!0,e.Rule.$state[o.concat([u]).join(".")]=!0):(o.length>1&&(e.Rule.$state[o.concat([u]).join(".")]=!0),t(r,n[u]=n[u]||{},o.concat([u]))))})}(t.result,e.Rule={$state:{}},[]),angular.forEach(u,function(t){t.ignore||e.Rule.$state[t.state]?(this.push(t),this[t.state]=t):e.Rule.$state["admin.byitem.index"]&&'admin.byitem.index({type:"BYITEM"})'==t.state?(this.push(t),this[t.state]=t):e.Rule.$state["admin.bycategory.index"]&&'admin.bycategory.index({type:"BYCATEGORY"})'==t.state?(this.push(t),this[t.state]=t):e.Rule.$state["admin.byapart.index"]&&'admin.byapart.index({type:"BYAPART"})'==t.state?(this.push(t),this[t.state]=t):e.Rule.$state["admin.bybuilding.index"]&&'admin.bybuilding.index({type:"BYBUILDING"})'==t.state&&(this.push(t),this[t.state]=t)},e.Menu=[])}).$promise},$userinfo:function(){return t.all([e.User.$account(),e.User.$project()]).then(function(){e.User.data=a})},$login:function(r){r=r||{};var u=t.defer(),i=Object.keys(r).length,s=r.remember;return delete r.remember,n.auth.login(r,function(t){a=t.result,i&&o.set(a,s),e.User.$userinfo().then(function(){u.resolve(a)},function(e){o.set(null),u.reject(e)})},u.reject),u.promise},$logout:function(t){return n.auth.logout(t||{},function(){delete e.User.data,delete e.Project,delete e.Rule,delete e.Menu,o.set(null)}).$promise}})}]);
>>>>>>> 6e3d1a2aa57f97a11542dd09c3d02693cef0d7c3
