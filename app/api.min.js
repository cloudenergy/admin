"use strict";window.APIORIGIN=location.origin.replace("admin.","api.").replace("boss.","api."),angular.module("app").constant("APICONFIG",{auth:["auth",,{login:{},logout:{},resource:{}}],account:["account",,{add:{},delete:{},info:{},update:{}}],eca:["eca",,{info:{},update:{},analysis:{},refresh:{}}],character:["character",,{add:{},delete:{},info:{},update:{}}],control:["control",,{send:{},driverinfo:{}}],collector:["collector",,{add:{},delete:{},info:{},update:{},status:{}}],driver:["driver",,{enum:{}}],business:["business",,{accountbalance:{},pltfundflow:{},fundflow:{},monitor:{},dailyfundsummary:{},monthlyfundsummary:{},ordernodetail:{},projectfundflowstatistic:{},departmentconsumptiondetail:{},departmentconsumptionstatistic:{},departmentusage:{},recentchargelog:{},departments:{}}],channelaccount:["channelaccount",,{add:{},checking:{},delete:{},info:{}}],building:["building",,{add:{},delete:{},info:{},update:{}}],project:["project",,{add:{},delete:{},info:{},update:{},status:{},bindequipment:{},authorityInfo:{url:"project/authority/info"},authorityUpdate:{url:"project/authority/update"}}],withdraw:["withdraw",,{checking:{},details:{},info:{},apply:{},done:{},transferfailed:{}}],payment:["payment",,{channelinfo:{},charge:{},handlingcharge:{}}],bank:["bank",,{info:{}}],customer:["customer",,{info:{},update:{}}],sensor:["sensor",,{info:{},update:{},delete:{}}],sensorchannel:["sensorchannel",,{add:{},delete:{},info:{},syncdata:{},update:{}}],device:["device",,{type:{}}],department:["department",,{add:{},delete:{},info:{},reset:{},update:{},rent:{},surrender:{}}],export:["export",,{projectflow:{},projectdailybill:{},projectdailyreceipt:{},projectmonthlybill:{},projectmonthlyreceipt:{},consumptiondetail:{},departmentsinfo:{},equipments:{}}],energy:["energy",,{info:{},update:{}}],energycategory:["energycategory",,{add:{},delete:{},info:{},update:{}}],eventcategory:["eventcategory",,{add:{},delete:{}}],event:["event",,{info:{},update:{}}],billingaccount:["billingaccount",,{add:{},update:{}}],billingservice:["billingservice",,{add:{},delete:{},info:{},update:{},equipments:{}}],urlpath:["urlpath",,{delete:{},info:{},update:{}}],packageplan:["packageplan",,{add:{},delete:{},info:{},update:{}}],userpackage:["userpackage",,{add:{},info:{},delete:{}}],message:["message",,{remindrecharge:{},list:{url:"message/config/list"},update:{url:"message/config/update"}}],pltfinance:["pltfinance",,{billinginfo:{},billingupdate:{}}],apptemplate:["apptemplate",,{info:{},update:{},delete:{}}],apportionment:["apportionment",,{info:{},percent:{url:"apportionment/bind"}}],interaction:["interaction",,{uploadtoken:{},remove:{}}],moduleevent:["moduleevent",,{info:{},update:{}}],qiniu:["qiniu",,{upload:{url:window.APIORIGIN+"/putb64/-1/key/:base64",withCredentials:!1,transformRequest:function(e){return e.file},headers:{"Content-Type":"application/octet-stream",Authorization:function(e){if(e.params&&e.params.token){var t="UpToken "+e.params.token;return delete e.params.token,t}}}}}]}).config(["$qProvider","$httpProvider",function(e,t){e.errorOnUnhandledRejections(!1),t.interceptors.push(["$rootScope","$q","$location","$timeout",function(n,t,a,r){function i(e,t){t?(angular.isObject(e.params)&&(e._inprogress=e.params._inprogress,delete e.params._inprogress),angular.isObject(e.data)&&angular.isUndefined(e._inprogress)&&(e._inprogress=e.data._inprogress,delete e.data._inprogress),!1!==e._inprogress&&(e._inprogress=r(function(){n.HttpInProgress++,e._inprogress=n.HttpInProgress},60))):(!1!==e._inprogress&&(angular.isNumber(e._inprogress)?r(function(){n.HttpInProgress--},60):angular.isObject(e._inprogress)&&r.cancel(e._inprogress)),delete e._inprogress)}return n.HttpInProgress=0,{request:function(e){return i(e,!0),e},requestError:function(e){return t.reject(e)},response:function(e){return e.config&&i(e.config,!1),angular.isObject(e.data)&&(e.data.code||e.data.result&&angular.isObject(e.data.result)&&!Object.keys(e.data.result).length)?(/90000005|90000007/.test(e.data.code)&&a.url("/admin/login").replace(),t.reject(e.data)):e},responseError:function(e){return e.config&&i(e.config,!1),t.reject(e.data||{code:e.status})}}}])}]).service("$api",["$resource","$transitions","APICONFIG",function(n,e,t){function a(e,t){return/(^http:\/\/)|(^https:\/\/)/.test(e)&&e||[window.APIORIGIN+"/api/"+e,t?"/:_api_action":""].join("")}var r=[];e.onBefore({},function(){angular.forEach(r,function(e){e.$resolved||e.$cancelRequest()}),r=[]}),angular.forEach(t,function(e,t){angular.isArray(e)&&e[0]&&(e[0]=a(e[0],!!e[2]),e[3]=angular.extend({cancellable:!0},e[3]),angular.forEach(e[2],function(e,t){e.url=e.url&&a(e.url)||void 0,e.method=e.method||"POST",e.params=e.params||{},e.params._api_action=e.url?void 0:t,e.withCredentials=!angular.isDefined(e.withCredentials)||e.withCredentials}),angular.forEach(this[t]=n.apply(n,e),function(n,e){this[e]=function(){var e,t;return angular.forEach([arguments[0],arguments[1]],function(e){angular.isObject(e)&&angular.isDefined(e._cancellable)&&(t=e._cancellable,delete e._cancellable)}),e=n.apply(this,arguments),!1===t&&delete e.$cancelRequest,e.$cancelRequest&&r.push(e),e}},this[t]))},this)}]);