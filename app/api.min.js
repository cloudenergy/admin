"use strict";window.APIORIGIN=location.origin.replace("admin.","api."),angular.module("app").constant("APICONFIG",{auth:["auth",,{login:{},logout:{},resource:{}}],account:["account",,{add:{},delete:{},info:{},update:{}}],eca:["eca",,{info:{},update:{},analysis:{},refresh:{}}],character:["character",,{add:{},delete:{},info:{},update:{}}],control:["control",,{send:{},driverinfo:{}}],collector:["collector",,{add:{},delete:{},info:{},update:{},status:{}}],driver:["driver",,{enum:{}}],business:["business",,{accountbalance:{},pltfundflow:{},fundflow:{},monitor:{},dailyfundsummary:{},monthlyfundsummary:{},ordernodetail:{},projectfundflowstatistic:{},departmentconsumptiondetail:{},departmentconsumptionstatistic:{},departmentusage:{},recentchargelog:{}}],channelaccount:["channelaccount",,{add:{},checking:{},delete:{},info:{}}],building:["building",,{add:{},delete:{},info:{},update:{}}],project:["project",,{add:{},delete:{},info:{},update:{},status:{},authorityInfo:{url:"project/authority/info"},authorityUpdate:{url:"project/authority/update"}}],withdraw:["withdraw",,{checking:{},details:{},info:{},apply:{},done:{},transferfailed:{}}],payment:["payment",,{channelinfo:{},charge:{},handlingcharge:{}}],bank:["bank",,{info:{}}],customer:["customer",,{info:{},update:{}}],sensor:["sensor",,{info:{},update:{}}],sensorchannel:["sensorchannel",,{add:{},delete:{},info:{},syncdata:{},update:{}}],device:["device",,{type:{}}],department:["department",,{add:{},delete:{},info:{},reset:{},update:{},rent:{},surrender:{}}],export:["export",,{projectflow:{},projectdailybill:{},projectdailyreceipt:{},projectmonthlybill:{},projectmonthlyreceipt:{},consumptiondetail:{},departmentsinfo:{},equipments:{}}],energy:["energy",,{info:{},update:{}}],energycategory:["energycategory",,{add:{},delete:{},info:{},update:{}}],eventcategory:["eventcategory",,{add:{},delete:{}}],event:["event",,{info:{},update:{}}],billingaccount:["billingaccount",,{add:{},update:{}}],billingservice:["billingservice",,{add:{},delete:{},info:{},update:{},equipments:{}}],urlpath:["urlpath",,{delete:{},info:{},update:{}}],packageplan:["packageplan",,{add:{},delete:{},info:{},update:{}}],userpackage:["userpackage",,{add:{},info:{},delete:{}}],message:["message",,{remindrecharge:{},list:{url:"message/config/list"},update:{url:"message/config/update"}}],pltfinance:["pltfinance",,{billinginfo:{},billingupdate:{}}],apptemplate:["apptemplate",,{info:{},update:{},delete:{}}],apportionment:["apportionment",,{info:{},percent:{url:"apportionment/bind"}}],interaction:["interaction",,{uploadtoken:{},remove:{}}],qiniu:["qiniu",,{upload:{url:window.APIORIGIN+"/putb64/-1/key/:base64",withCredentials:!1,transformRequest:function(e){return e.file},headers:{"Content-Type":"application/octet-stream",Authorization:function(e){if(e.params&&e.params.token){var t="UpToken "+e.params.token;return delete e.params.token,t}}}}}]}).config(["$qProvider","$httpProvider",function(e,t){e.errorOnUnhandledRejections(!1),t.interceptors.push(["$rootScope","$q","$location","$timeout",function(e,t,n,a){function r(t,n){n?(angular.isObject(t.params)&&(t._inprogress=t.params._inprogress,delete t.params._inprogress),angular.isObject(t.data)&&angular.isUndefined(t._inprogress)&&(t._inprogress=t.data._inprogress,delete t.data._inprogress),!1!==t._inprogress&&(t._inprogress=a(function(){e.HttpInProgress++,t._inprogress=e.HttpInProgress},60))):(!1!==t._inprogress&&(angular.isNumber(t._inprogress)?a(function(){e.HttpInProgress--},60):angular.isObject(t._inprogress)&&a.cancel(t._inprogress)),delete t._inprogress)}return e.HttpInProgress=0,{request:function(e){return r(e,!0),e},requestError:function(e){return t.reject(e)},response:function(e){return e.config&&r(e.config,!1),angular.isObject(e.data)&&(e.data.code||e.data.result&&angular.isObject(e.data.result)&&!Object.keys(e.data.result).length)?(/90000005|90000007/.test(e.data.code)&&n.url("/admin/login").replace(),t.reject(e.data)):e},responseError:function(e){return e.config&&r(e.config,!1),t.reject(e.data||{code:e.status})}}}])}]).service("$api",["$resource","$transitions","APICONFIG",function(e,t,n){var a=function(e,t){return/(^http:\/\/)|(^https:\/\/)/.test(e)&&e||[window.APIORIGIN+"/api/"+e,t&&"/:_api_action"||""].join("")},r=[];t.onBefore({},function(){angular.forEach(r,function(e){!e.$resolved&&e.$cancelRequest()}),r=[]}),angular.forEach(n,function(t,n){angular.isArray(t)&&t[0]&&(t[0]=a(t[0],!!t[2]),t[3]=angular.extend({cancellable:!0},t[3]),angular.forEach(t[2],function(e,t){e.url=e.url&&a(e.url)||void 0,e.method=e.method||"POST",e.params=e.params||{},e.params._api_action=e.url?void 0:t,e.withCredentials=!angular.isDefined(e.withCredentials)||e.withCredentials}),angular.forEach(this[n]=e.apply(e,t),function(e,t){this[t]=function(){var t,n;return angular.forEach([arguments[0],arguments[1]],function(e){angular.isObject(e)&&angular.isDefined(e._cancellable)&&(n=e._cancellable,delete e._cancellable)}),t=e.apply(this,arguments),!1===n&&delete t.$cancelRequest,t.$cancelRequest&&r.push(t),t}},this[n]))},this)}]);